"use strict";(self.webpackChunk_nand2tetris_web=self.webpackChunk_nand2tetris_web||[]).push([[34],{1496:(e,s,t)=>{t.r(s),t.d(s,{default:()=>T});var n=t(1391),a=t(8256),i=t(8878),r=t(7437),o=t(64),l=t(4668),d=t(9646),c=t(7022),u=t(910),m=t(8849),h=t(1091),f=t(270),v=t(5087),p=t(8029),_=t(6073),x=t(3600),S=t(2675),g=t(5168),R=t(9267),j=t(782);const E={[f.X.SYS_WAIT_DURATION_NOT_POSITIVE]:a.Ru._({id:"9dwWEz"}),[f.X.ARRAY_SIZE_NOT_POSITIVE]:a.Ru._({id:"zh5lcC"}),[f.X.DIVIDE_BY_ZERO]:a.Ru._({id:"iGq+of"}),[f.X.SQRT_NEG]:a.Ru._({id:"RsyXWz"}),[f.X.ALLOC_SIZE_NOT_POSITIVE]:a.Ru._({id:"Pza0F/"}),[f.X.HEAP_OVERFLOW]:a.Ru._({id:"EqbNAN"}),[f.X.ILLEGAL_PIXEL_COORD]:a.Ru._({id:"Lo+J/U"}),[f.X.ILLEGAL_LINE_COORD]:a.Ru._({id:"y4CC1u"}),[f.X.ILLEGAL_RECT_COORD]:a.Ru._({id:"5tI3XX"}),[f.X.ILLEGAL_CENTER_COORD]:a.Ru._({id:"SLzG45"}),[f.X.ILLEGAL_RADIUS]:a.Ru._({id:"ijwovO"}),[f.X.STRING_LENGTH_NEG]:a.Ru._({id:"etZuY4"}),[f.X.GET_CHAR_INDEX_OUT_OF_BOUNDS]:a.Ru._({id:"GbPVvk"}),[f.X.SET_CHAR_INDEX_OUT_OF_BOUNDS]:a.Ru._({id:"IgLZZI"}),[f.X.STRING_FULL]:a.Ru._({id:"CACwfm"}),[f.X.STRING_EMPTY]:a.Ru._({id:"RE1zuN"}),[f.X.STRING_INSUFFICIENT_CAPACITY]:a.Ru._({id:"fkP0ib"}),[f.X.ILLEGAL_CURSOR_LOCATION]:a.Ru._({id:"EQU4AC"})},T=()=>{const{filePicker:e}=(0,i.useContext)(p.BR),{setTool:s,stores:t}=(0,i.useContext)(x.NQ),{state:a,actions:v,dispatch:T}=t.vm,{setStatus:C,fs:I}=(0,i.useContext)(u.L),[N,O]=(0,d.b)(a.files.tst),[y,P]=(0,d.b)(a.files.out),[w,X]=(0,d.b)(a.files.cmp),[k,F]=(0,i.useState)();(0,i.useEffect)((()=>{s("vm")}),[s]),(0,i.useEffect)((()=>{k&&(v.loadTest(k,N),v.reset())}),[N,k]),(0,i.useEffect)((()=>{void 0!==a.controls.exitCode&&C(0==a.controls.exitCode?"Program halted":`Program exited with error code ${a.controls.exitCode}${(0,f.U)(a.controls.exitCode)?`: ${E[a.controls.exitCode]}`:""}`)}),[a.controls.exitCode]);const b=(0,i.useRef)(),G=(0,i.useRef)(),[M,$]=(0,i.useState)(!1);(0,i.useEffect)((()=>(b.current=new class extends h.M{async tick(){return v.step()}finishFrame(){T.current({action:"update"})}reset(){C("Reset"),v.reset()}toggle(){v.setPaused(!this.running),T.current({action:"update"})}},G.current=new class extends h.M{async tick(){return v.testStep()}finishFrame(){T.current({action:"update"})}reset(){C("Reset"),v.reset()}toggle(){v.setPaused(!this.running),T.current({action:"update"})}},$(!0),()=>{var e,s;null===(e=b.current)||void 0===e||e.stop(),null===(s=G.current)||void 0===s||s.stop()})),[v,T]);const D=async e=>{let s="";if(e.includes("."))s=e.replace(".vm","VME.tst");else{var t;s=`${e}/${null===(t=(await I.scandir(e)).find((e=>e.isFile()&&e.name.endsWith("VME.tst"))))||void 0===t?void 0:t.name}`}const n=await I.readFile(s);v.loadTest(s,n)},U=(e,s)=>{T.current({action:"updateConfig",payload:s?{testSpeed:e}:{speed:e}}),v.setAnimate(e<=2)},V=(0,i.useRef)();return(0,j.jsxs)("div",{className:"Page VmPage grid "+(0==a.config.screenScale?"no-screen":2==a.config.screenScale?"large-screen":"normal"),children:[(0,j.jsx)(g.Z,{className:"program",isEditorPanel:!0,header:(0,j.jsxs)(j.Fragment,{children:[(0,j.jsx)("div",{className:"flex-0",style:{whiteSpace:"nowrap"},children:(0,j.jsx)(n.x6,{id:"1qK+lw"})}),(0,j.jsx)("div",{className:"flex-1",children:M&&b.current&&(0,j.jsx)(c.T,{prefix:(0,j.jsx)("button",{className:"flex-0",onClick:async()=>{const s=await e.selectAllowLocal({suffix:"vm",allowFolders:!0});let t=[],n="";if((0,_.uf)(s)){if(s.isDir){for(const e of(await I.scandir(s.path)).filter((e=>e.isFile()&&e.name.endsWith(".vm"))))t.push({name:e.name.replace(".vm",""),content:await I.readFile(`${s}/${e.name}`)});n=`${s.path.split("/").pop()} / *.vm`}else{var a;t.push({name:s.path.replace(".vm",""),content:await I.readFile(s.path)}),n=null!==(a=s.path.split("/").pop())&&void 0!==a?a:""}D(s.path)}else t=Array.isArray(s)?s.filter((e=>e.name.endsWith(".vm"))):[s];0!=t.length&&(T.current({action:"setTitle",payload:n}),v.loadVm(t),v.reset(),C(""))},"data-tooltip":"Load files","data-placement":"bottom",children:"\ud83d\udcc2"}),runner:b.current,disabled:!a.controls.valid,speed:a.config.speed,onSpeedChange:e=>U(e,!1)})})]}),children:(0,j.jsx)(S.K,{value:a.files.vm,onChange:e=>{v.setVm(e)},language:"vm",highlight:a.controls.valid&&a.vm.showHighlight?a.vm.highlight:void 0,error:a.controls.error})}),(0,j.jsx)(g.Z,{className:"vm",header:(0,j.jsx)(n.x6,{id:"2BSTzk"}),children:a.controls.valid&&a.vm.Stack.length>0&&(0,j.jsxs)(j.Fragment,{children:[(0,j.jsx)(L,{statics:a.vm.Statics,temp:a.vm.Temp,frame:a.vm.Stack[0]}),(0,j.jsx)(A,{stack:a.vm.Stack,addedSysInit:a.vm.AddedSysInit})]})}),(0,j.jsxs)(g.Z,{className:"display",style:{gridArea:"display"},children:[(0,j.jsx)(l.f,{memory:a.vm.Screen,showScaleControls:!0,scale:a.config.screenScale,onScale:e=>{T.current({action:"updateConfig",payload:{screenScale:e}})}}),(0,j.jsx)(r.s,{keyboard:a.vm.Keyboard})]}),(0,j.jsx)(o.Ay,{ref:V,name:"RAM",memory:a.vm.RAM,initialAddr:256,format:a.config.ram1Format,onSetFormat:e=>{T.current({action:"updateConfig",payload:{ram1Format:e}})},showClear:!1}),(0,j.jsx)(o.Ay,{name:"RAM",className:"Stack",memory:a.vm.RAM,format:a.config.ram2Format,onSetFormat:e=>{T.current({action:"updateConfig",payload:{ram2Format:e}})},cellLabels:["SP:","LCL:","ARG:","THIS:","THAT:","TEMP0:","TEMP1:","TEMP2:","TEMP3:","TEMP4:","TEMP5:","TEMP6:","TEMP7:","R13:","R14:","R15:"],onChange:()=>{var e;null===(e=V.current)||void 0===e||e.rerender()}}),M&&(0,j.jsx)(R.B,{runner:G,tst:[N,O,a.test.highlight],out:[y,P],cmp:[w,X],setPath:F,showClear:!0,defaultTst:m.$,speed:a.config.testSpeed,onSpeedChange:e=>U(e,!0),disabled:!a.controls.valid})]})},C="Unknown function";function I(e,s){const t={};e=e.filter((e=>{var s;return(null===(s=e.fn)||void 0===s?void 0:s.name)!=v.IG}));for(const a of e)a.fn&&(t[a.fn.name]?t[a.fn.name]++:t[a.fn.name]=1);const n=e.slice().reverse().map((e=>{var t,n,a;return(null===(t=e.fn)||void 0===t?void 0:t.name)==v.h0.name?s?`${v.h0.name} (built-in)`:v.h0.name:null!==(n=null===(a=e.fn)||void 0===a?void 0:a.name)&&void 0!==n?n:C}));for(const a of Object.keys(t))if(1!=t[a]){t[a]=0;for(let e=0;e<n.length;e++)n[e]===a&&(n[e]=`${a}[${t[a]}]`,t[a]++)}return n}function A({stack:e,addedSysInit:s}){return(0,j.jsx)("section",{children:(0,j.jsxs)("p",{children:["Call-stack:",(0,j.jsx)("code",{children:I(e,s).join(" > ")})]})})}function L({statics:e,temp:s,frame:t}){var n,a,i,r,o,l,d;return(0,j.jsx)("section",{children:(0,j.jsxs)("main",{children:[(0,j.jsxs)("p",{children:["Stack:",(0,j.jsxs)("code",{children:["[",t.stack.values.join(", "),"]"]})]}),(null===(n=t.usedSegments)||void 0===n?void 0:n.has("local"))&&(0,j.jsxs)("p",{children:["local:",(0,j.jsxs)("code",{children:["[",t.locals.values.join(", "),"]"]})]}),(null===(a=t.usedSegments)||void 0===a?void 0:a.has("argument"))&&(0,j.jsxs)("p",{children:["argument:",(0,j.jsxs)("code",{children:["[",t.args.values.join(", "),"]"]})]}),(null===(i=t.usedSegments)||void 0===i?void 0:i.has("static"))&&(0,j.jsxs)("p",{children:["static:",(0,j.jsxs)("code",{children:["[",e.join(", "),"]"]})]}),(null===(r=t.usedSegments)||void 0===r?void 0:r.has("pointer"))&&(0,j.jsxs)("p",{children:["pointer:",(0,j.jsxs)("code",{children:["[",`${t.frame.THIS}, ${t.frame.THAT}`,"]"]})]}),(null===(o=t.usedSegments)||void 0===o?void 0:o.has("this"))&&(0,j.jsxs)("p",{children:["this:",(0,j.jsxs)("code",{children:["[",t.this.values.join(", "),"]"]})]}),(null===(l=t.usedSegments)||void 0===l?void 0:l.has("that"))&&(0,j.jsxs)("p",{children:["that:",(0,j.jsxs)("code",{children:["[",t.that.values.join(", "),"]"]})]}),(null===(d=t.usedSegments)||void 0===d?void 0:d.has("temp"))&&(0,j.jsxs)("p",{children:["temp:",(0,j.jsxs)("code",{children:["[",s.join(", "),"]"]})]})]})})}}}]);
"use strict";(globalThis.webpackChunk_nand2tetris_web=globalThis.webpackChunk_nand2tetris_web||[]).push([[34],{1496:(e,t,s)=>{s.r(t),s.d(t,{default:()=>E});var n=s(1391),a=s(8256),i=s(8878),r=s(7437),o=s(64),l=s(4668),d=s(9646),c=s(7022),u=s(910),m=s(8849),h=s(1091),f=s(270),v=s(5087),p=s(8029),_=s(6073),g=s(3344),x=s(2675),S=s(5168),R=s(9267),j=s(782);const T={[f.X.SYS_WAIT_DURATION_NOT_POSITIVE]:a.Ru._({id:"9dwWEz"}),[f.X.ARRAY_SIZE_NOT_POSITIVE]:a.Ru._({id:"zh5lcC"}),[f.X.DIVIDE_BY_ZERO]:a.Ru._({id:"iGq+of"}),[f.X.SQRT_NEG]:a.Ru._({id:"RsyXWz"}),[f.X.ALLOC_SIZE_NOT_POSITIVE]:a.Ru._({id:"Pza0F/"}),[f.X.HEAP_OVERFLOW]:a.Ru._({id:"EqbNAN"}),[f.X.ILLEGAL_PIXEL_COORD]:a.Ru._({id:"Lo+J/U"}),[f.X.ILLEGAL_LINE_COORD]:a.Ru._({id:"y4CC1u"}),[f.X.ILLEGAL_RECT_COORD]:a.Ru._({id:"5tI3XX"}),[f.X.ILLEGAL_CENTER_COORD]:a.Ru._({id:"SLzG45"}),[f.X.ILLEGAL_RADIUS]:a.Ru._({id:"ijwovO"}),[f.X.STRING_LENGTH_NEG]:a.Ru._({id:"etZuY4"}),[f.X.GET_CHAR_INDEX_OUT_OF_BOUNDS]:a.Ru._({id:"GbPVvk"}),[f.X.SET_CHAR_INDEX_OUT_OF_BOUNDS]:a.Ru._({id:"IgLZZI"}),[f.X.STRING_FULL]:a.Ru._({id:"CACwfm"}),[f.X.STRING_EMPTY]:a.Ru._({id:"RE1zuN"}),[f.X.STRING_INSUFFICIENT_CAPACITY]:a.Ru._({id:"fkP0ib"}),[f.X.ILLEGAL_CURSOR_LOCATION]:a.Ru._({id:"EQU4AC"})},E=()=>{const{filePicker:e}=(0,i.useContext)(p.BR),{setTool:t,stores:s}=(0,i.useContext)(g.NQ),{state:a,actions:v,dispatch:E}=s.vm,{setStatus:C,fs:I}=(0,i.useContext)(u.L),[N,y]=(0,d.b)(a.files.tst),[O,P]=(0,d.b)(a.files.out),[w,X]=(0,d.b)(a.files.cmp),[k,F]=(0,i.useState)();(0,i.useEffect)(()=>{t("vm")},[t]),(0,i.useEffect)(()=>{k&&(v.loadTest(k,N),v.reset())},[N,k]),(0,i.useEffect)(()=>{void 0!==a.controls.exitCode&&C(0==a.controls.exitCode?"Program halted":`Program exited with error code ${a.controls.exitCode}${(0,f.U)(a.controls.exitCode)?`: ${T[a.controls.exitCode]}`:""}`)},[a.controls.exitCode]);const b=(0,i.useRef)(),G=(0,i.useRef)(),[M,$]=(0,i.useState)(!1);(0,i.useEffect)(()=>(b.current=new class extends h.M{async tick(){return v.step()}finishFrame(){E.current({action:"update"})}reset(){C("Reset"),v.reset()}toggle(){v.setPaused(!this.running),E.current({action:"update"})}},G.current=new class extends h.M{async tick(){return v.testStep()}finishFrame(){E.current({action:"update"})}reset(){C("Reset"),v.reset()}toggle(){v.setPaused(!this.running),E.current({action:"update"})}},$(!0),()=>{var e,t;null===(e=b.current)||void 0===e||e.stop(),null===(t=G.current)||void 0===t||t.stop()}),[v,E]);const D=async e=>{let t="";if(e.includes("."))t=e.replace(".vm","VME.tst");else{var s;t=`${e}/${null===(s=(await I.scandir(e)).find(e=>e.isFile()&&e.name.endsWith("VME.tst")))||void 0===s?void 0:s.name}`}try{const e=await I.readFile(t);v.loadTest(t,e)}catch(n){}},U=(e,t)=>{E.current({action:"updateConfig",payload:t?{testSpeed:e}:{speed:e}}),v.setAnimate(e<=2)},V=(0,i.useRef)();return(0,j.jsxs)("div",{className:"Page VmPage grid "+(0==a.config.screenScale?"no-screen":2==a.config.screenScale?"large-screen":"normal"),children:[(0,j.jsx)(S.Z,{className:"program",isEditorPanel:!0,header:(0,j.jsxs)(j.Fragment,{children:[(0,j.jsx)("div",{className:"flex-0",style:{whiteSpace:"nowrap"},children:(0,j.jsx)(n.x6,{id:"1qK+lw"})}),(0,j.jsx)("div",{className:"flex-1",children:M&&b.current&&(0,j.jsx)(c.T,{prefix:(0,j.jsx)("button",{className:"flex-0",onClick:async()=>{const t=await e.selectAllowLocal({suffix:"vm",allowFolders:!0});let s=[],n="";if((0,_.uf)(t)){if(t.isDir){for(const e of(await I.scandir(t.path)).filter(e=>e.isFile()&&e.name.endsWith(".vm")))s.push({name:e.name.replace(".vm",""),content:await I.readFile(`${t.path}/${e.name}`)});n=`${t.path.split("/").pop()} / *.vm`}else{var a;s.push({name:t.path.replace(".vm",""),content:await I.readFile(t.path)}),n=null!==(a=t.path.split("/").pop())&&void 0!==a?a:""}D(t.path)}else s=Array.isArray(t)?t.filter(e=>e.name.endsWith(".vm")):[t];0!=s.length&&(E.current({action:"setTitle",payload:n}),v.loadVm(s),v.reset(),C(""))},"data-tooltip":"Load files","data-placement":"bottom",children:"\ud83d\udcc2"}),runner:b.current,disabled:!a.controls.valid,speed:a.config.speed,onSpeedChange:e=>U(e,!1)})})]}),children:(0,j.jsx)(x.K,{value:a.files.vm,onChange:e=>{v.setVm(e)},language:"vm",highlight:a.vm.showHighlight?a.vm.highlight:void 0,highlightType:a.controls.valid?"highlight":"error",error:a.controls.error})}),(0,j.jsx)(S.Z,{className:"vm",header:(0,j.jsx)(n.x6,{id:"2BSTzk"}),children:(0,j.jsxs)(j.Fragment,{children:[a.vm.Stack.length>0&&(0,j.jsx)(L,{statics:a.vm.Statics,temp:a.vm.Temp,frame:a.vm.Stack[0]}),(0,j.jsx)(A,{stack:a.vm.Stack,addedSysInit:a.vm.AddedSysInit})]})}),(0,j.jsxs)(S.Z,{className:"display",style:{gridArea:"display"},children:[(0,j.jsx)(l.f,{memory:a.vm.Screen,showScaleControls:!0,scale:a.config.screenScale,onScale:e=>{E.current({action:"updateConfig",payload:{screenScale:e}})}}),(0,j.jsx)(r.s,{keyboard:a.vm.Keyboard})]}),(0,j.jsx)(o.Ay,{ref:V,name:"RAM",memory:a.vm.RAM,initialAddr:256,format:a.config.ram1Format,onSetFormat:e=>{E.current({action:"updateConfig",payload:{ram1Format:e}})},showClear:!1}),(0,j.jsx)(o.Ay,{name:"RAM",className:"Stack",memory:a.vm.RAM,format:a.config.ram2Format,onSetFormat:e=>{E.current({action:"updateConfig",payload:{ram2Format:e}})},cellLabels:["SP:","LCL:","ARG:","THIS:","THAT:","TEMP0:","TEMP1:","TEMP2:","TEMP3:","TEMP4:","TEMP5:","TEMP6:","TEMP7:","R13:","R14:","R15:"],onChange:()=>{var e;null===(e=V.current)||void 0===e||e.rerender()}}),M&&(0,j.jsx)(R.B,{runner:G,tst:[N,y,a.test.highlight],out:[O,P],cmp:[w,X],setPath:F,showClear:!0,defaultTst:m.$,speed:a.config.testSpeed,onSpeedChange:e=>U(e,!0),disabled:!a.controls.valid})]})},C="Unknown function";function I(e,t){const s={};e=e.filter(e=>{var t;return(null===(t=e.fn)||void 0===t?void 0:t.name)!=v.IG});for(const a of e)a.fn&&(s[a.fn.name]?s[a.fn.name]++:s[a.fn.name]=1);const n=e.slice().reverse().map(e=>{var s,n,a;return(null===(s=e.fn)||void 0===s?void 0:s.name)==v.h0.name?t?`${v.h0.name} (built-in)`:v.h0.name:null!==(n=null===(a=e.fn)||void 0===a?void 0:a.name)&&void 0!==n?n:C});for(const a of Object.keys(s))if(1!=s[a]){s[a]=0;for(let e=0;e<n.length;e++)n[e]===a&&(n[e]=`${a}[${s[a]}]`,s[a]++)}return n}function A({stack:e,addedSysInit:t}){return(0,j.jsx)("section",{children:(0,j.jsxs)("p",{children:["Call-stack:",(0,j.jsx)("code",{children:I(e,t).join(" > ")})]})})}function L({statics:e,temp:t,frame:s}){var n,a,i,r,o,l,d;return(0,j.jsx)("section",{children:(0,j.jsxs)("main",{children:[(0,j.jsxs)("p",{children:["Stack:",(0,j.jsxs)("code",{children:["[",s.stack.values.join(", "),"]"]})]}),(null===(n=s.usedSegments)||void 0===n?void 0:n.has("local"))&&(0,j.jsxs)("p",{children:["local:",(0,j.jsxs)("code",{children:["[",s.locals.values.join(", "),"]"]})]}),(null===(a=s.usedSegments)||void 0===a?void 0:a.has("argument"))&&(0,j.jsxs)("p",{children:["argument:",(0,j.jsxs)("code",{children:["[",s.args.values.join(", "),"]"]})]}),(null===(i=s.usedSegments)||void 0===i?void 0:i.has("static"))&&(0,j.jsxs)("p",{children:["static:",(0,j.jsxs)("code",{children:["[",e.join(", "),"]"]})]}),(null===(r=s.usedSegments)||void 0===r?void 0:r.has("pointer"))&&(0,j.jsxs)("p",{children:["pointer:",(0,j.jsxs)("code",{children:["[",`${s.frame.THIS}, ${s.frame.THAT}`,"]"]})]}),(null===(o=s.usedSegments)||void 0===o?void 0:o.has("this"))&&(0,j.jsxs)("p",{children:["this:",(0,j.jsxs)("code",{children:["[",s.this.values.join(", "),"]"]})]}),(null===(l=s.usedSegments)||void 0===l?void 0:l.has("that"))&&(0,j.jsxs)("p",{children:["that:",(0,j.jsxs)("code",{children:["[",s.that.values.join(", "),"]"]})]}),(null===(d=s.usedSegments)||void 0===d?void 0:d.has("temp"))&&(0,j.jsxs)("p",{children:["temp:",(0,j.jsxs)("code",{children:["[",t.join(", "),"]"]})]})]})})}}}]);
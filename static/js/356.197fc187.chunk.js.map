{"version":3,"file":"static/js/356.197fc187.chunk.js","mappings":"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","sources":["../../components/src/difftable.tsx","../../simulator/src/chip/builder.ts","../../simulator/src/chip/builtins/computer/computer.tsx","../../simulator/src/chip/builtins/logic/and.ts","../../simulator/src/chip/builtins/logic/dmux.ts","../../simulator/src/chip/builtins/logic/mux.ts","../../simulator/src/chip/builtins/logic/nand.ts","../../simulator/src/chip/builtins/logic/not.ts","../../simulator/src/chip/builtins/logic/or.ts","../../simulator/src/chip/builtins/logic/xor.ts","../../simulator/src/chip/builtins/arithmetic/add_16.ts","../../simulator/src/chip/builtins/arithmetic/alu.tsx","../../simulator/src/chip/builtins/arithmetic/half_adder.ts","../../simulator/src/chip/builtins/arithmetic/full_adder.ts","../../simulator/src/chip/builtins/arithmetic/inc16.ts","../../simulator/src/chip/builtins/sequential/dff.ts","../../simulator/src/chip/builtins/index.ts","../../simulator/src/chip/builtins/sequential/bit.tsx","../../simulator/src/chip/builtins/sequential/ram.tsx","../../simulator/src/chip/chip.tsx","../../simulator/src/chip/clock.ts","../../simulator/src/cpu/alu.ts","../../simulator/src/cpu/cpu.ts","../../simulator/src/cpu/memory.ts","../../simulator/src/languages/grammars/asm.ohm.js","../../simulator/src/languages/asm.ts","../../simulator/src/fs.ts","../../simulator/src/languages/base.ts","../../simulator/src/languages/grammars/base.ohm.js","../../simulator/src/languages/grammars/cmp.ohm.js","../../simulator/src/languages/cmp.ts","../../simulator/src/languages/grammars/hdl.ohm.js","../../simulator/src/languages/hdl.ts","../../simulator/src/languages/grammars/tst.ohm.js","../../simulator/src/languages/tst.ts","../../simulator/src/output.ts","../../simulator/src/tst.ts","../../simulator/src/util/asm.ts","../../simulator/src/util/twos.ts"],"sourcesContent":["import { CMP } from \"@nand2tetris/simulator/languages/cmp.js\";\nimport { display } from \"@davidsouther/jiffies/lib/esm/display.js\";\nimport { range } from \"@davidsouther/jiffies/lib/esm/range.js\";\nimport { Err, isErr, Ok } from \"@davidsouther/jiffies/lib/esm/result.js\";\nimport { ReactElement } from \"react\";\n\nexport const DiffTable = ({\n  className = \"\",\n  out,\n  cmp,\n  zeroState,\n}: {\n  out: string;\n  cmp: string;\n  className?: string;\n  zeroState?: ReactElement;\n}) => {\n  const output = CMP.parse(out);\n  const compare = CMP.parse(cmp);\n\n  if (isErr(output)) {\n    return (\n      <details>\n        <summary>Failed to parse output</summary>\n        <pre>{display(Err(output))}</pre>\n        <code>\n          <pre>{out}</pre>\n        </code>\n      </details>\n    );\n  }\n\n  if (isErr(compare)) {\n    return (\n      <details>\n        <summary>Failed to parse compare</summary>\n        <code>\n          <pre>{display(Err(compare))}</pre>\n          <pre>{cmp}</pre>\n        </code>\n      </details>\n    );\n  }\n\n  const cmpData = Ok(compare);\n  const outData = Ok(output);\n  let failures = 0;\n  const table = range(0, Math.min(cmpData.length, outData.length)).map((i) => {\n    const cmpI = cmpData[i] ?? [];\n    const outI = outData[i] ?? [];\n    return range(0, Math.max(cmpI.length, outI.length))\n      .map((_, j) => [cmpI[j] ?? \"\", outI[j] ?? \"\"])\n      .map(([cmp, out]) => {\n        const cell = {\n          cmp: cmp ?? '\"',\n          out: out ?? '\"',\n          pass:\n            cmp?.trim().match(/^\\*+$/) !== null || out?.trim() === cmp?.trim(),\n        };\n        if (!cell.pass) {\n          failures += 1;\n        }\n        return cell;\n      });\n  });\n\n  return (\n    <div className={\"scroll-x \" + className}>\n      {failures > 0 && (\n        <p>\n          {failures} failure{failures === 1 ? \"\" : \"s\"}\n        </p>\n      )}\n      {table.length > 0 ? (\n        <table\n          style={{\n            fontFamily: \"var(--font-family-monospace)\",\n            marginBottom: \"none\",\n          }}\n        >\n          <tbody>\n            {table.map((row, i) => (\n              <tr key={i}>\n                {row.map(({ cmp, out, pass }, i) => (\n                  <DiffCell cmp={cmp} out={out} pass={pass} key={i} />\n                ))}\n              </tr>\n            ))}\n          </tbody>\n        </table>\n      ) : (\n        zeroState ?? <p>Execute test script to compare output.</p>\n      )}\n    </div>\n  );\n};\n\nconst DiffCell = ({\n  cmp,\n  out,\n  pass,\n}: {\n  cmp: string;\n  out: string;\n  pass: boolean;\n}) => {\n  return pass ? (\n    <>\n      <td>{cmp}</td>\n    </>\n  ) : (\n    <>\n      <td>\n        <ins>{cmp}</ins>\n        <br />\n        <del>{out}</del>\n      </td>\n    </>\n  );\n};\n","import { FileSystem } from \"@davidsouther/jiffies/lib/esm/fs.js\";\nimport {\n  Err,\n  isErr,\n  isOk,\n  Ok,\n  Result,\n} from \"@davidsouther/jiffies/lib/esm/result.js\";\nimport { HDL, HdlParse } from \"../languages/hdl.js\";\nimport { getBuiltinChip, hasBuiltinChip } from \"./builtins/index.js\";\nimport { Chip, Connection } from \"./chip.js\";\n\nfunction pinWidth(start: number, end: number | undefined): number | undefined {\n  if (end === undefined) {\n    return undefined;\n  }\n  if (end >= start) {\n    return end - start + 1;\n  }\n  if (start > 0 && end === 0) {\n    return 1;\n  }\n  throw new Error(`Bus specification has start > end (${start} > ${end})`);\n}\n\nexport async function parse(\n  code: string\n): Promise<Result<Chip, Error | { message: string; shortMessage: string }>> {\n  const parsed = HDL.parse(code.toString());\n  if (isErr(parsed)) return parsed;\n  return build(Ok(parsed));\n}\n\nexport async function loadChip(\n  name: string,\n  fs?: FileSystem\n): Promise<Result<Chip>> {\n  if (hasBuiltinChip(name) || fs === undefined) {\n    return getBuiltinChip(name);\n  }\n  try {\n    const file = await fs.readFile(`${name}.hdl`);\n    const maybeParsedHDL = HDL.parse(file);\n    const chip = isOk(maybeParsedHDL)\n      ? build(Ok(maybeParsedHDL), fs)\n      : Err(new Error(\"HDL Was not parsed\"));\n    return chip;\n  } catch (e) {\n    return Err(new Error(`Could not load chip ${name}.hdl` /*, { cause: e }*/));\n  }\n}\n\nexport async function build(\n  parts: HdlParse,\n  fs?: FileSystem\n): Promise<Result<Chip, Error>> {\n  if (parts.parts === \"BUILTIN\") {\n    return getBuiltinChip(parts.name.toString());\n  }\n\n  const buildChip = new Chip(\n    parts.ins.map(({ pin, width }) => ({ pin: pin.toString(), width })),\n    parts.outs.map(({ pin, width }) => ({ pin: pin.toString(), width })),\n    parts.name.toString(),\n    [],\n    parts.clocked\n  );\n\n  for (const part of parts.parts) {\n    const builtin = await loadChip(part.name.toString(), fs);\n    if (isErr(builtin)) return builtin;\n    const partChip = Ok(builtin);\n\n    const wires = part.wires.map<Connection>(({ lhs, rhs }) => ({\n      to: {\n        name: lhs.pin.toString(),\n        start: lhs.start ?? 0,\n        width: pinWidth(lhs.start ?? 0, lhs.end),\n      },\n      from: {\n        name: rhs.pin.toString(),\n        start: rhs.start ?? 0,\n        width: pinWidth(rhs.start ?? 0, rhs.end),\n      },\n    }));\n\n    try {\n      buildChip.wire(partChip, wires);\n    } catch (e) {\n      return Err(e as Error);\n    }\n  }\n\n  return Ok(buildChip);\n}\n","import { FileSystem } from \"@davidsouther/jiffies/lib/esm/fs.js\";\n// import { Screen as ScreenComponent } from \"../../../../app/components/chips/screen.js\";\n// import { Keyboard as KeyboardComponent } from \"../../../../app/components/chips/keyboard.js\";\n// import { RegisterComponent } from \"../../../../app/components/chips/register.js\";\n// import { ALUComponent } from \"../../../../app/components/chips/alu.js\";\n// import { Flags } from \"../../../cpu/alu.js\";\nimport { Chip, ClockedChip, ConstantBus, HIGH, LOW, Pin } from \"../../chip.js\";\nimport { RAM, RAM16K } from \"../sequential/ram.js\";\nimport {\n  CPUInput,\n  CPUState,\n  cpuTick,\n  cpuTock,\n  emptyState,\n} from \"../../../cpu/cpu.js\";\nimport { int10 } from \"../../../util/twos.js\";\nimport { load } from \"../../../fs.js\";\nimport { KEYBOARD, SCREEN } from \"../../../cpu/memory.js\";\n\nexport class ROM32K extends RAM {\n  constructor() {\n    super(16, \"ROM\");\n  }\n\n  override async load(fs: FileSystem, path: string) {\n    try {\n      (await load(fs, path)).map((v, i) => (this.at(i).busVoltage = v));\n    } catch (cause) {\n      // throw new Error(`ROM32K Failed to load file ${path}`, { cause });\n      throw new Error(`ROM32K Failed to load file ${path}`);\n    }\n  }\n}\n\nexport class Screen extends RAM {\n  static readonly OFFSET = SCREEN;\n\n  constructor() {\n    super(13, \"Screen\");\n  }\n}\n\nexport class Keyboard extends Chip {\n  static readonly OFFSET = KEYBOARD;\n\n  constructor() {\n    super([], [\"out[16]\"], \"Keyboard\");\n  }\n\n  setKey(key: number) {\n    this.out().busVoltage = key & 0xffff;\n  }\n\n  clearKey() {\n    this.out().busVoltage = 0;\n  }\n}\n\nexport class Memory extends ClockedChip {\n  private ram = new RAM16K();\n  private screen = new Screen();\n  private keyboard = new Keyboard();\n  private address = 0;\n\n  constructor() {\n    super([\"in[16]\", \"load\", \"address[15])\"], [\"out[16]\"], \"Memory\");\n    this.parts.add(this.keyboard);\n    this.parts.add(this.screen);\n    this.parts.add(this.ram);\n  }\n\n  override tick() {\n    const load = this.in(\"load\").voltage();\n    this.address = this.in(\"address\").busVoltage;\n    if (load) {\n      const inn = this.in().busVoltage;\n      if (this.address >= Keyboard.OFFSET) {\n        // Keyboard, do nothing\n      } else if (this.address >= Screen.OFFSET) {\n        this.screen.at(this.address - Screen.OFFSET).busVoltage = inn;\n      } else {\n        this.ram.at(this.address).busVoltage = inn;\n      }\n    }\n  }\n\n  override tock() {\n    this.eval();\n  }\n\n  override eval() {\n    if (!this.ram) return;\n    this.address = this.in(\"address\").busVoltage;\n    let out = 0;\n    if (this.address >= Keyboard.OFFSET) {\n      // Keyboard, do nothing\n      out = this.keyboard?.out().busVoltage ?? 0;\n    } else if (this.address >= Screen.OFFSET) {\n      out = this.screen?.at(this.address - Screen.OFFSET).busVoltage ?? 0;\n    } else {\n      out = this.ram?.at(this.address).busVoltage ?? 0;\n    }\n    this.out().busVoltage = out;\n  }\n\n  override in(pin?: string): Pin {\n    if (pin?.startsWith(\"RAM16K\")) {\n      const idx = int10(pin.match(/\\[(?<idx>\\d+)]/)?.groups?.idx ?? \"0\");\n      return this.ram.at(idx);\n    }\n    if (pin?.startsWith(\"Screen\")) {\n      const idx = int10(pin.match(/\\[(?<idx>\\d+)]/)?.groups?.idx ?? \"0\");\n      return this.screen.at(idx);\n    }\n    return super.in(pin);\n  }\n\n  override get(name: string, offset = 0): Pin | undefined {\n    if (name.startsWith(\"RAM16K\")) {\n      return this.at(offset & 0x3fff);\n    }\n    if (name.startsWith(\"Screen\")) {\n      return this.at(offset & (0x1fff + Screen.OFFSET));\n    }\n    if (name.startsWith(\"Keyboard\")) {\n      return this.at(Keyboard.OFFSET);\n    }\n    if (name.startsWith(\"Memory\")) {\n      return this.at(offset);\n    }\n    return super.get(name, offset);\n  }\n\n  at(offset: number): Pin {\n    if (offset >= Keyboard.OFFSET) {\n      return this.keyboard.out();\n    }\n    if (offset >= Screen.OFFSET) {\n      return this.screen.at(offset - Screen.OFFSET);\n    } else {\n      return this.ram.at(offset);\n    }\n  }\n\n  override reset(): void {\n    this.address = 0;\n    this.ram.reset();\n    this.screen.reset();\n    super.reset();\n  }\n}\n\nexport class CPU extends ClockedChip {\n  private _state: CPUState = emptyState();\n\n  get state(): CPUState {\n    return this._state;\n  }\n\n  constructor() {\n    super(\n      [\"inM[16]\", \"instruction[16]\", \"reset\"],\n      [\"outM[16]\", \"writeM\", \"addressM[15]\", \"pc[15]\"]\n    );\n  }\n\n  override tick(): void {\n    const [state, writeM] = cpuTick(this.cpuInput(), this._state);\n    this._state = state;\n    this.out(\"writeM\").pull(writeM ? HIGH : LOW);\n    this.out(\"outM\").busVoltage = this._state.ALU ?? 0;\n  }\n\n  override tock(): void {\n    if (!this._state) return; // Skip initial tock\n    const [output, state] = cpuTock(this.cpuInput(), this._state);\n    this._state = state;\n\n    this.out(\"addressM\").busVoltage = output.addressM ?? 0;\n    this.out(\"outM\").busVoltage = output.outM ?? 0;\n    this.out(\"writeM\").pull(output.writeM ? HIGH : LOW);\n    this.out(\"pc\").busVoltage = this._state?.PC ?? 0;\n  }\n\n  private cpuInput(): CPUInput {\n    const inM = this.in(\"inM\").busVoltage;\n    const instruction = this.in(\"instruction\").busVoltage;\n    const reset = this.in(\"reset\").busVoltage === 1;\n    return { inM, instruction, reset };\n  }\n\n  override get(pin: string, offset?: number): Pin | undefined {\n    if (pin?.startsWith(\"ARegister\")) {\n      return new ConstantBus(\"ARegister\", this._state.A);\n    }\n    if (pin?.startsWith(\"DRegister\")) {\n      return new ConstantBus(\"DRegister\", this._state.D);\n    }\n    if (pin?.startsWith(\"PC\")) {\n      return new ConstantBus(\"PC\", this._state.PC);\n    }\n    return super.get(pin, offset);\n  }\n\n  override reset() {\n    this._state = emptyState();\n    super.reset();\n  }\n}\n\nexport class Computer extends Chip {\n  #ram = new Memory();\n  #rom = new ROM32K();\n  #cpu = new CPU();\n\n  constructor() {\n    super([\"reset\"], []);\n\n    this.wire(this.#cpu, [\n      { from: { name: \"reset\", start: 0 }, to: { name: \"reset\", start: 0 } },\n      {\n        from: { name: \"instruction\", start: 0 },\n        to: { name: \"instruction\", start: 0 },\n      },\n      { from: { name: \"outM\", start: 0 }, to: { name: \"inM\", start: 0 } },\n      { from: { name: \"writeM\", start: 0 }, to: { name: \"writeM\", start: 0 } },\n      {\n        from: { name: \"addressM\", start: 0 },\n        to: { name: \"addressM\", start: 0 },\n      },\n    ]);\n\n    this.wire(this.#rom, [\n      { from: { name: \"pc\", start: 0 }, to: { name: \"address\", start: 0 } },\n      {\n        from: { name: \"instruction\", start: 0 },\n        to: { name: \"out\", start: 0 },\n      },\n    ]);\n\n    this.wire(this.#ram, [\n      { from: { name: \"inM\", start: 0 }, to: { name: \"in\", start: 0 } },\n      { from: { name: \"writeM\", start: 0 }, to: { name: \"load\", start: 0 } },\n      {\n        from: { name: \"addressM\", start: 0 },\n        to: { name: \"address\", start: 0 },\n      },\n      { from: { name: \"outM\", start: 0 }, to: { name: \"out\", start: 0 } },\n    ]);\n  }\n\n  override eval() {\n    super.eval();\n  }\n\n  override get(name: string, offset?: number): Pin | undefined {\n    if (\n      name.startsWith(\"PC\") ||\n      name.startsWith(\"ARegister\") ||\n      name.startsWith(\"DRegister\")\n    ) {\n      return this.#cpu.get(name);\n    }\n    if (name.startsWith(\"RAM16K\")) {\n      return this.#ram.get(name, offset);\n    }\n    return super.get(name, offset);\n  }\n\n  override load(fs: FileSystem, path: string): Promise<void> {\n    return this.#rom.load(fs, path);\n  }\n}\n","import { Chip, HIGH, LOW, Voltage } from \"../../chip.js\";\n\nexport function and(a: Voltage, b: Voltage): [Voltage] {\n  return [a === 1 && b === 1 ? HIGH : LOW];\n}\n\nexport function and16(a: number, b: number): [number] {\n  return [a & b & 0xffff];\n}\n\nexport class And extends Chip {\n  constructor() {\n    super([\"a\", \"b\"], [\"out\"]);\n  }\n\n  override eval() {\n    const a = this.in(\"a\").voltage();\n    const b = this.in(\"b\").voltage();\n    const [n] = and(a, b);\n    this.out().pull(n);\n  }\n}\n\nexport class And16 extends Chip {\n  constructor() {\n    super([\"a[16]\", \"b[16]\"], [\"out[16]\"]);\n  }\n\n  override eval() {\n    const a = this.in(\"a\").busVoltage;\n    const b = this.in(\"b\").busVoltage;\n    const [n] = and16(a, b);\n    this.out().busVoltage = n;\n  }\n}\n","import { Chip, HIGH, LOW, Voltage } from \"../../chip.js\";\n\nexport function dmux(inn: Voltage, sel: Voltage): [Voltage, Voltage] {\n  const a = sel === LOW && inn === HIGH ? HIGH : LOW;\n  const b = sel === HIGH && inn === HIGH ? HIGH : LOW;\n  return [a, b];\n}\n\nexport function dmux4way(\n  inn: Voltage,\n  sel: number\n): [Voltage, Voltage, Voltage, Voltage] {\n  const a = sel === 0b00 && inn === HIGH ? HIGH : LOW;\n  const b = sel === 0b01 && inn === HIGH ? HIGH : LOW;\n  const c = sel === 0b10 && inn === HIGH ? HIGH : LOW;\n  const d = sel === 0b11 && inn === HIGH ? HIGH : LOW;\n  return [a, b, c, d];\n}\n\nexport function dmux8way(\n  inn: Voltage,\n  sel: number\n): [Voltage, Voltage, Voltage, Voltage, Voltage, Voltage, Voltage, Voltage] {\n  const a = sel === 0b000 && inn === HIGH ? HIGH : LOW;\n  const b = sel === 0b001 && inn === HIGH ? HIGH : LOW;\n  const c = sel === 0b010 && inn === HIGH ? HIGH : LOW;\n  const d = sel === 0b011 && inn === HIGH ? HIGH : LOW;\n  const e = sel === 0b100 && inn === HIGH ? HIGH : LOW;\n  const f = sel === 0b101 && inn === HIGH ? HIGH : LOW;\n  const g = sel === 0b110 && inn === HIGH ? HIGH : LOW;\n  const h = sel === 0b111 && inn === HIGH ? HIGH : LOW;\n  return [a, b, c, d, e, f, g, h];\n}\n\nexport class DMux extends Chip {\n  constructor() {\n    super([\"in\", \"sel\"], [\"a\", \"b\"]);\n  }\n\n  override eval() {\n    const inn = this.in(\"in\").voltage();\n    const sel = this.in(\"sel\").voltage();\n\n    const [a, b] = dmux(inn, sel);\n    this.out(\"a\").pull(a);\n    this.out(\"b\").pull(b);\n  }\n}\n\nexport class DMux4Way extends Chip {\n  constructor() {\n    super([\"in\", \"sel[2]\"], [\"a\", \"b\", \"c\", \"d\"]);\n  }\n\n  override eval() {\n    const inn = this.in(\"in\").voltage();\n    const sel = this.in(\"sel\").busVoltage;\n\n    const [a, b, c, d] = dmux4way(inn, sel);\n    this.out(\"a\").pull(a);\n    this.out(\"b\").pull(b);\n    this.out(\"c\").pull(c);\n    this.out(\"d\").pull(d);\n  }\n}\n\nexport class DMux8Way extends Chip {\n  constructor() {\n    super([\"in\", \"sel[3]\"], [\"a\", \"b\", \"c\", \"d\", \"e\", \"f\", \"g\", \"h\"]);\n  }\n\n  override eval() {\n    const inn = this.in(\"in\").voltage();\n    const sel = this.in(\"sel\").busVoltage;\n\n    const [a, b, c, d, e, f, g, h] = dmux8way(inn, sel);\n    this.out(\"a\").pull(a);\n    this.out(\"b\").pull(b);\n    this.out(\"c\").pull(c);\n    this.out(\"d\").pull(d);\n    this.out(\"e\").pull(e);\n    this.out(\"f\").pull(f);\n    this.out(\"g\").pull(g);\n    this.out(\"h\").pull(h);\n  }\n}\n","import { Chip, LOW, Voltage } from \"../../chip.js\";\n\nexport function mux(a: Voltage, b: Voltage, sel: Voltage): [Voltage] {\n  return [sel === LOW ? a : b];\n}\n\nexport function mux16(a: number, b: number, sel: Voltage): [number] {\n  return [sel === LOW ? a : b];\n}\n\nexport function mux16_4(\n  a: number,\n  b: number,\n  c: number,\n  d: number,\n  sel: number\n): [number] {\n  const s2 = (sel & 0b01) as Voltage;\n  return (sel & 0b10) === 0b00 ? mux16(a, b, s2) : mux16(c, d, s2);\n}\n\nexport function mux16_8(\n  a: number,\n  b: number,\n  c: number,\n  d: number,\n  e: number,\n  f: number,\n  g: number,\n  h: number,\n  sel: number\n): [number] {\n  const s2 = (sel & 0b11) as Voltage;\n  return (sel & 0b100) === 0b000\n    ? mux16_4(a, b, c, d, s2)\n    : mux16_4(e, f, g, h, s2);\n}\n\nexport class Mux extends Chip {\n  constructor() {\n    super([\"a\", \"b\", \"sel\"], [\"out\"]);\n  }\n\n  override eval() {\n    const a = this.in(\"a\").voltage();\n    const b = this.in(\"b\").voltage();\n    const sel = this.in(\"sel\").voltage();\n\n    const [set] = mux(a, b, sel);\n    this.out().pull(set);\n  }\n}\n\nexport class Mux16 extends Chip {\n  constructor() {\n    super([\"a[16]\", \"b[16]\", \"sel\"], [\"out[16]\"]);\n  }\n\n  override eval() {\n    const a = this.in(\"a\").busVoltage;\n    const b = this.in(\"b\").busVoltage;\n    const sel = this.in(\"sel\").voltage();\n    const [out] = mux16(a, b, sel);\n    this.out().busVoltage = out;\n  }\n}\n\nexport class Mux4Way16 extends Chip {\n  constructor() {\n    super([\"a[16]\", \"b[16]\", \"c[16]\", \"d[16]\", \"sel[2]\"], [\"out[16]\"]);\n  }\n\n  override eval() {\n    const a = this.in(\"a\").busVoltage;\n    const b = this.in(\"b\").busVoltage;\n    const c = this.in(\"c\").busVoltage;\n    const d = this.in(\"d\").busVoltage;\n    const sel = this.in(\"sel\").busVoltage;\n    const [out] = mux16_4(a, b, c, d, sel);\n\n    this.out().busVoltage = out;\n  }\n}\n\nexport class Mux8Way16 extends Chip {\n  constructor() {\n    super(\n      [\n        \"a[16]\",\n        \"b[16]\",\n        \"c[16]\",\n        \"d[16]\",\n        \"e[16]\",\n        \"f[16]\",\n        \"g[16]\",\n        \"h[16]\",\n        \"sel[3]\",\n      ],\n      [\"out[16]\"]\n    );\n  }\n\n  override eval() {\n    const a = this.in(\"a\").busVoltage;\n    const b = this.in(\"b\").busVoltage;\n    const c = this.in(\"c\").busVoltage;\n    const d = this.in(\"d\").busVoltage;\n    const e = this.in(\"e\").busVoltage;\n    const f = this.in(\"f\").busVoltage;\n    const g = this.in(\"g\").busVoltage;\n    const h = this.in(\"h\").busVoltage;\n    const sel = this.in(\"sel\").busVoltage;\n    const [out] = mux16_8(a, b, c, d, e, f, g, h, sel);\n\n    this.out().busVoltage = out;\n  }\n}\n","import { nand16 } from \"../../../util/twos.js\";\nimport { HIGH, LOW, Chip, Voltage } from \"../../chip.js\";\n\nexport function nand(a: Voltage, b: Voltage): [Voltage] {\n  return [a === 1 && b === 1 ? LOW : HIGH];\n}\n\nexport class Nand extends Chip {\n  constructor() {\n    super([\"a\", \"b\"], [\"out\"]);\n  }\n\n  override eval() {\n    const a = this.in(\"a\").voltage();\n    const b = this.in(\"b\").voltage();\n    const [out] = nand(a, b);\n    this.out().pull(out);\n  }\n}\n\nexport class Nand16 extends Chip {\n  constructor() {\n    super([\"a[16]\", \"b[16]\"], [\"out[16]\"]);\n  }\n\n  override eval() {\n    const a = this.in(\"a\").busVoltage;\n    const b = this.in(\"b\").busVoltage;\n    this.out().busVoltage = nand16(a, b);\n  }\n}\n","import { Chip, HIGH, LOW, Voltage } from \"../../chip.js\";\n\nexport function not(inn: Voltage): [Voltage] {\n  return [inn === LOW ? HIGH : LOW];\n}\n\nexport function not16(inn: number): [number] {\n  return [~inn & 0xffff];\n}\n\nexport class Not extends Chip {\n  constructor() {\n    super([\"in\"], [\"out\"]);\n  }\n\n  override eval() {\n    const a = this.in(\"in\").voltage();\n    const [out] = not(a);\n    this.out().pull(out);\n  }\n}\n\nexport class Not16 extends Chip {\n  constructor() {\n    super([\"in[16]\"], [\"out[16]\"]);\n  }\n\n  override eval() {\n    const [n] = not16(this.in().busVoltage);\n    this.out().busVoltage = n;\n  }\n}\n","import { Chip, HIGH, LOW, Voltage } from \"../../chip.js\";\n\nexport function or(a: Voltage, b: Voltage): [Voltage] {\n  return [a === 1 || b === 1 ? HIGH : LOW];\n}\n\nexport function or16(a: number, b: number): [number] {\n  return [(a | b) & 0xffff];\n}\n\nexport function or8way(a: number): [Voltage] {\n  return [(a & 0xff) === 0 ? LOW : HIGH];\n}\n\nexport class Or extends Chip {\n  constructor() {\n    super([\"a\", \"b\"], [\"out\"]);\n  }\n\n  override eval() {\n    const a = this.in(\"a\").voltage();\n    const b = this.in(\"b\").voltage();\n    const [out] = or(a, b);\n    this.out().pull(out);\n  }\n}\n\nexport class Or16 extends Chip {\n  constructor() {\n    super([\"a[16]\", \"b[16]\"], [\"out[16]\"]);\n  }\n\n  override eval() {\n    const a = this.in(\"a\").busVoltage;\n    const b = this.in(\"b\").busVoltage;\n    const [out] = or16(a, b);\n    this.out().busVoltage = out;\n  }\n}\n\nexport class Or8way extends Chip {\n  constructor() {\n    super([\"in[8]\"], [\"out\"], \"Or8way\");\n  }\n\n  override eval() {\n    const inn = this.in().busVoltage;\n    const [out] = or8way(inn);\n    this.out().pull(out);\n  }\n}\n","import { Chip, HIGH, LOW, Voltage } from \"../../chip.js\";\n\nexport function xor(a: Voltage, b: Voltage): [Voltage] {\n  return [(a === HIGH && b === LOW) || (a === LOW && b === HIGH) ? HIGH : LOW];\n}\n\nexport function xor16(a: number, b: number): [number] {\n  return [(a ^ b) & 0xffff];\n}\n\nexport class Xor extends Chip {\n  constructor() {\n    super([\"a\", \"b\"], [\"out\"]);\n  }\n\n  override eval() {\n    const a = this.in(\"a\").voltage();\n    const b = this.in(\"b\").voltage();\n    const [out] = xor(a, b);\n    this.out().pull(out);\n  }\n}\n\nexport class Xor16 extends Chip {\n  constructor() {\n    super([\"a[16]\", \"b[16]\"], [\"out[16]\"]);\n  }\n\n  override eval() {\n    const a = this.in(\"a\").busVoltage;\n    const b = this.in(\"b\").busVoltage;\n    const [out] = xor16(a, b);\n    this.out().busVoltage = out;\n  }\n}\n","import { Chip } from \"../../chip.js\";\n\nexport function add16(a: number, b: number): [number] {\n  return [(a + b) & 0xffff];\n}\n\nexport class Add16 extends Chip {\n  constructor() {\n    super([\"a[16]\", \"b[16]\"], [\"out[16]\"], \"Add16\");\n  }\n\n  override eval() {\n    const a = this.in(\"a\").busVoltage;\n    const b = this.in(\"b\").busVoltage;\n    const [out] = add16(a, b);\n    this.out().busVoltage = out;\n  }\n}\n","import { alu, alua, COMMANDS_OP, Flags } from \"../../../cpu/alu.js\";\nimport { Chip, HIGH, LOW } from \"../../chip.js\";\n\nexport class ALUNoStat extends Chip {\n  constructor() {\n    super(\n      [\n        \"x[16]\",\n        \"y[16]\", // 16-bit inputs\n        \"zx\", // zero the x input?\n        \"nx\", // negate the x input?\n        \"zy\", // zero the y input?\n        \"ny\", // negate the y input?\n        \"f\", // compute out = x + y (if 1) or x & y (if 0)\n        \"no\", // negate the out output?\n      ],\n      [\n        \"out[16]\", // 16-bit output\n      ],\n      \"ALU\"\n    );\n  }\n\n  override eval() {\n    const x = this.in(\"x\").busVoltage;\n    const y = this.in(\"y\").busVoltage;\n    const zx = this.in(\"zx\").busVoltage << 5;\n    const nx = this.in(\"nx\").busVoltage << 4;\n    const zy = this.in(\"zy\").busVoltage << 3;\n    const ny = this.in(\"ny\").busVoltage << 2;\n    const f = this.in(\"f\").busVoltage << 1;\n    const no = this.in(\"no\").busVoltage << 0;\n    const op = zx + nx + zy + ny + f + no;\n\n    const [out] = alu(op, x, y);\n\n    this.out().busVoltage = out;\n  }\n}\n\nexport class ALU extends Chip {\n  constructor() {\n    super(\n      [\n        \"x[16]\",\n        \"y[16]\", // 16-bit inputs\n        \"zx\", // zero the x input?\n        \"nx\", // negate the x input?\n        \"zy\", // zero the y input?\n        \"ny\", // negate the y input?\n        \"f\", // compute out = x + y (if 1) or x & y (if 0)\n        \"no\", // negate the out output?\n      ],\n      [\n        \"out[16]\", // 16-bit output\n        \"zr\", // 1 if (out === 0), 0 otherwise\n        \"ng\", // 1 if (out < 0),  0 otherwise\n      ],\n      \"ALU\"\n    );\n  }\n\n  override eval() {\n    const x = this.in(\"x\").busVoltage;\n    const y = this.in(\"y\").busVoltage;\n    const zx = this.in(\"zx\").busVoltage << 5;\n    const nx = this.in(\"nx\").busVoltage << 4;\n    const zy = this.in(\"zy\").busVoltage << 3;\n    const ny = this.in(\"ny\").busVoltage << 2;\n    const f = this.in(\"f\").busVoltage << 1;\n    const no = this.in(\"no\").busVoltage << 0;\n    const op = zx + nx + zy + ny + f + no;\n\n    const [out, flags] = alu(op, x, y);\n\n    const ng = flags === Flags.Negative ? HIGH : LOW;\n    const zr = flags === Flags.Zero ? HIGH : LOW;\n    this.out(\"out\").busVoltage = out;\n    this.out(\"ng\").pull(ng);\n    this.out(\"zr\").pull(zr);\n  }\n\n  op(): COMMANDS_OP {\n    const zx = this.in(\"zx\").busVoltage << 5;\n    const nx = this.in(\"nx\").busVoltage << 4;\n    const zy = this.in(\"zy\").busVoltage << 3;\n    const ny = this.in(\"ny\").busVoltage << 2;\n    const f = this.in(\"f\").busVoltage << 1;\n    const no = this.in(\"no\").busVoltage << 0;\n    const op = zx + nx + zy + ny + f + no;\n    return op as COMMANDS_OP;\n  }\n}\n\nexport class ALUAll extends Chip {\n  constructor() {\n    super(\n      [\n        \"x[16]\",\n        \"y[16]\", // 16-bit inputs\n        \"zx\", // zero the x input?\n        \"nx\", // negate the x input?\n        \"zy\", // zero the y input?\n        \"ny\", // negate the y input?\n        \"f\", // compute out = x + y (if 1) or x & y (if 0)\n        \"no\", // negate the out output?\n      ],\n      [\n        \"out[16]\", // 16-bit output\n        \"zr\", // 1 if (out === 0), 0 otherwise\n        \"ng\", // 1 if (out < 0),  0 otherwise\n      ],\n      \"ALU\"\n    );\n  }\n\n  override eval() {\n    const x = this.in(\"x\").busVoltage;\n    const y = this.in(\"y\").busVoltage;\n    const zx = this.in(\"zx\").busVoltage << 5;\n    const nx = this.in(\"nx\").busVoltage << 4;\n    const zy = this.in(\"zy\").busVoltage << 3;\n    const ny = this.in(\"ny\").busVoltage << 2;\n    const f = this.in(\"f\").busVoltage << 1;\n    const no = this.in(\"no\").busVoltage << 0;\n    const op = zx + nx + zy + ny + f + no;\n\n    const [out, flags] = alua(op, x, y);\n\n    const ng = flags === Flags.Negative ? HIGH : LOW;\n    const zr = flags === Flags.Zero ? HIGH : LOW;\n    this.out(\"out\").busVoltage = out;\n    this.out(\"ng\").pull(ng);\n    this.out(\"zr\").pull(zr);\n  }\n\n  op(): COMMANDS_OP {\n    const zx = this.in(\"zx\").busVoltage << 5;\n    const nx = this.in(\"nx\").busVoltage << 4;\n    const zy = this.in(\"zy\").busVoltage << 3;\n    const ny = this.in(\"ny\").busVoltage << 2;\n    const f = this.in(\"f\").busVoltage << 1;\n    const no = this.in(\"no\").busVoltage << 0;\n    const op = zx + nx + zy + ny + f + no;\n    return op as COMMANDS_OP;\n  }\n}\n","import { Chip, HIGH, LOW, Voltage } from \"../../chip.js\";\n\nexport function halfAdder(a: Voltage, b: Voltage): [Voltage, Voltage] {\n  const sum = (a === 1 && b === 0) || (a === 0 && b === 1) ? HIGH : LOW;\n  const car = a === 1 && b === 1 ? HIGH : LOW;\n\n  return [sum, car];\n}\n\nexport class HalfAdder extends Chip {\n  constructor() {\n    super([\"a\", \"b\"], [\"sum\", \"carry\"]);\n  }\n\n  override eval() {\n    const a = this.in(\"a\").voltage();\n    const b = this.in(\"b\").voltage();\n    const [sum, carry] = halfAdder(a, b);\n    this.out(\"sum\").pull(sum);\n    this.out(\"carry\").pull(carry);\n  }\n}\n","import { Chip, Voltage } from \"../../chip.js\";\nimport { or } from \"../logic/or.js\";\nimport { halfAdder } from \"./half_adder.js\";\n\nexport function fullAdder(\n  a: Voltage,\n  b: Voltage,\n  c: Voltage\n): [Voltage, Voltage] {\n  const [s, ca] = halfAdder(a, b);\n  const [sum, cb] = halfAdder(s, c);\n  const [carry] = or(ca, cb);\n\n  return [sum, carry];\n}\n\nexport class FullAdder extends Chip {\n  constructor() {\n    super([\"a\", \"b\", \"c\"], [\"sum\", \"carry\"]);\n  }\n\n  override eval() {\n    const a = this.in(\"a\").voltage();\n    const b = this.in(\"b\").voltage();\n    const c = this.in(\"c\").voltage();\n    const [sum, carry] = fullAdder(a, b, c);\n    this.out(\"sum\").pull(sum);\n    this.out(\"carry\").pull(carry);\n  }\n}\n","import { Chip } from \"../../chip.js\";\nimport { add16 } from \"./add_16.js\";\n\nexport function inc16(n: number): [number] {\n  return add16(n, 1);\n}\n\nexport class Inc16 extends Chip {\n  constructor() {\n    super([\"in[16]\"], [\"out[16]\"], \"Inc16\");\n  }\n\n  override eval() {\n    const a = this.in().busVoltage;\n    const [out] = inc16(a);\n    this.out().busVoltage = out;\n  }\n}\n","import { ClockedChip } from \"../../chip.js\";\n\nexport class DFF extends ClockedChip {\n  constructor(name?: string) {\n    super([\"in\"], [\"out\"], name, [\"t\"]);\n  }\n\n  override tick() {\n    // Read in into t\n    const t = this.in().voltage();\n    this.pin(\"t\").pull(t);\n  }\n\n  override tock() {\n    // write t into out\n    const t = this.pin(\"t\").voltage();\n    this.out().pull(t);\n  }\n}\n","import { Err, Ok, Result } from \"@davidsouther/jiffies/lib/esm/result.js\";\nimport { Chip } from \"../chip.js\";\n\nimport { And, And16 } from \"./logic/and.js\";\nimport { DMux, DMux4Way, DMux8Way } from \"./logic/dmux.js\";\nimport { Mux, Mux16, Mux4Way16, Mux8Way16 } from \"./logic/mux.js\";\nimport { Nand, Nand16 } from \"./logic/nand.js\";\nimport { Not, Not16 } from \"./logic/not.js\";\nimport { Or, Or16, Or8way } from \"./logic/or.js\";\nimport { Xor, Xor16 } from \"./logic/xor.js\";\n\nimport { Add16 } from \"./arithmetic/add_16.js\";\nimport { ALU, ALUNoStat } from \"./arithmetic/alu.js\";\nimport { FullAdder } from \"./arithmetic/full_adder.js\";\nimport { HalfAdder } from \"./arithmetic/half_adder.js\";\nimport { Inc16 } from \"./arithmetic/inc16.js\";\n\nimport {\n  Computer,\n  CPU,\n  Keyboard,\n  Memory,\n  ROM32K,\n  Screen,\n} from \"./computer/computer.js\";\nimport { Bit, PC, Register, VRegister } from \"./sequential/bit.js\";\nimport { DFF } from \"./sequential/dff.js\";\nimport { RAM16K, RAM4K, RAM512, RAM64, RAM8 } from \"./sequential/ram.js\";\n\nexport {\n  And,\n  And16,\n  DMux,\n  Mux,\n  Mux16,\n  Mux4Way16,\n  Mux8Way16,\n  Nand,\n  Nand16,\n  Not,\n  Not16,\n  Or,\n  Or16,\n  Or8way,\n  Xor,\n  Xor16,\n  HalfAdder,\n  FullAdder,\n  Add16,\n  Inc16,\n  ALU,\n  Bit,\n  Register,\n  VRegister as ARegister,\n  VRegister as DRegister,\n  DFF,\n  RAM8,\n  RAM64,\n  RAM512,\n  RAM4K,\n  RAM16K,\n};\n\nexport const REGISTRY = new Map<string, () => Chip>(\n  (\n    [\n      [\"Nand\", Nand],\n      [\"Nand16\", Nand16],\n      [\"Not\", Not],\n      [\"Not16\", Not16],\n      [\"And\", And],\n      [\"And16\", And16],\n      [\"Or\", Or],\n      [\"Or16\", Or16],\n      [\"Or8Way\", Or8way],\n      [\"XOr\", Xor],\n      [\"XOr16\", Xor16],\n      [\"Xor\", Xor],\n      [\"Xor16\", Xor16],\n      [\"Mux\", Mux],\n      [\"Mux16\", Mux16],\n      [\"Mux4Way16\", Mux4Way16],\n      [\"Mux8Way16\", Mux8Way16],\n      [\"DMux\", DMux],\n      [\"DMux4Way\", DMux4Way],\n      [\"DMux8Way\", DMux8Way],\n      [\"HalfAdder\", HalfAdder],\n      [\"FullAdder\", FullAdder],\n      [\"Add16\", Add16],\n      [\"Inc16\", Inc16],\n      [\"ALU\", ALU],\n      [\"ALUNoStat\", ALUNoStat],\n      [\"DFF\", DFF],\n      [\"Bit\", Bit],\n      [\"Register\", Register],\n      [\"ARegister\", Register],\n      [\"DRegister\", Register],\n      [\"PC\", PC],\n      [\"RAM8\", RAM8],\n      [\"RAM64\", RAM64],\n      [\"RAM512\", RAM512],\n      [\"RAM4K\", RAM4K],\n      [\"RAM16K\", RAM16K],\n      [\"ROM32K\", ROM32K],\n      [\"Screen\", Screen],\n      [\"Keyboard\", Keyboard],\n      [\"CPU\", CPU],\n      [\"Computer\", Computer],\n      [\"Memory\", Memory],\n      [\"ARegister\", VRegister],\n      [\"DRegister\", VRegister],\n    ] as [string, { new (): Chip }][]\n  ).map(([name, ChipCtor]) => [\n    name,\n    () => {\n      const chip = new ChipCtor();\n      chip.name = name;\n      return chip;\n    },\n  ])\n);\n\nexport function hasBuiltinChip(name: string): boolean {\n  return REGISTRY.has(name);\n}\n\nexport function getBuiltinChip(name: string): Result<Chip> {\n  const chip = REGISTRY.get(name);\n  return chip\n    ? Ok(chip())\n    : Err(new Error(`Chip ${name} not in builtin registry`));\n}\n","import { ClockedChip, HIGH, LOW, Pin, Voltage } from \"../../chip.js\";\n\nexport class Bit extends ClockedChip {\n  bit: Voltage = LOW;\n\n  constructor(name?: string) {\n    super([\"in\", \"load\"], [\"out\"], name);\n  }\n\n  override tick() {\n    if (this.in(\"load\").voltage() === HIGH) {\n      this.bit = this.in().voltage();\n    }\n  }\n\n  override tock() {\n    this.out().pull(this.bit ?? 0);\n  }\n\n  override reset() {\n    this.bit = LOW;\n    super.reset();\n  }\n}\n\nexport class Register extends ClockedChip {\n  bits = 0x00;\n\n  constructor(name?: string) {\n    super([\"in[16]\", \"load\"], [\"out[16]\"], name);\n  }\n\n  override tick() {\n    if (this.in(\"load\").voltage() === HIGH) {\n      this.bits = this.in().busVoltage & 0xffff;\n    }\n  }\n\n  override tock() {\n    this.out().busVoltage = this.bits & 0xffff;\n  }\n\n  override get(name: string, offset?: number): Pin | undefined {\n    return name === this.name ? this.out() : super.get(name, offset);\n  }\n\n  override reset() {\n    this.bits = 0x00;\n    super.reset();\n  }\n}\n\nexport class VRegister extends Register {}\n\nexport class PC extends ClockedChip {\n  bits = 0x00;\n\n  constructor(name?: string) {\n    super([\"in[16]\", \"load\", \"inc\", \"reset\"], [\"out[16]\"], name);\n  }\n\n  override tick() {\n    if (this.in(\"reset\").voltage() === HIGH) {\n      this.bits = 0;\n    } else if (this.in(\"load\").voltage() === HIGH) {\n      this.bits = this.in().busVoltage & 0xffff;\n    } else if (this.in(\"inc\").voltage() === HIGH) {\n      this.bits += 1;\n    }\n  }\n\n  override tock() {\n    this.out().busVoltage = this.bits & 0xffff;\n  }\n\n  override get(name: string, offset?: number): Pin | undefined {\n    return name === this.name ? this.out() : super.get(name, offset);\n  }\n\n  override reset() {\n    this.bits = 0x00;\n    super.reset();\n  }\n}\n","import { Bus, ClockedChip, Pin } from \"../../chip.js\";\nimport { assert } from \"@davidsouther/jiffies/lib/esm/assert.js\";\nimport { Memory, Memory as MemoryChip } from \"../../../cpu/memory.js\";\n\nexport class RAM extends ClockedChip {\n  protected _memory: MemoryChip;\n  private _nextData = 0;\n  private _address = 0;\n\n  get memory() {\n    return this._memory;\n  }\n  get address() {\n    return this._address;\n  }\n\n  constructor(readonly width: number, name?: string) {\n    super([\"in[16]\", \"load\", `address[${width}]`], [`out[16]`], name);\n    this._memory = new MemoryChip(Math.pow(2, this.width));\n  }\n\n  override tick() {\n    const load = this.in(\"load\").voltage();\n    this._address = this.in(\"address\").busVoltage;\n    if (load) {\n      this._nextData = this.in().busVoltage;\n      this._memory.set(this._address, this._nextData);\n    }\n  }\n\n  override tock() {\n    this.out().busVoltage = this._memory?.get(this._address) ?? 0;\n  }\n\n  override eval() {\n    const address = this.in(\"address\").busVoltage;\n    this.out().busVoltage = this._memory?.get(address) ?? 0;\n  }\n\n  at(idx: number): Pin {\n    assert(\n      idx < this._memory.size,\n      () => `Request out of bounds (${idx} >= ${this._memory.size})`\n    );\n    return new RamBus(`${this.name}[${idx}]`, idx, this._memory);\n  }\n\n  override reset(): void {\n    console.log(\"ram reset\");\n    this._memory.reset();\n    super.reset();\n  }\n}\n\nexport class RamBus extends Bus {\n  constructor(\n    name: string,\n    private readonly index: number,\n    private ram: Memory\n  ) {\n    super(name);\n  }\n\n  override get busVoltage(): number {\n    return this.ram.get(this.index);\n  }\n\n  override set busVoltage(num: number) {\n    this.ram.set(this.index, num);\n  }\n}\n\nexport class RAM8 extends RAM {\n  constructor(name?: string) {\n    super(3, name);\n  }\n}\n\nexport class RAM64 extends RAM {\n  constructor(name?: string) {\n    super(6, name);\n  }\n}\n\nexport class RAM512 extends RAM {\n  constructor(name?: string) {\n    super(9, name);\n  }\n}\n\nexport class RAM4K extends RAM {\n  constructor(name?: string) {\n    super(12, name);\n  }\n}\n\nexport class RAM16K extends RAM {\n  constructor(name?: string) {\n    super(14, name);\n  }\n}\n","/* eslint-disable @typescript-eslint/no-non-null-assertion */\nimport { assert, assertExists } from \"@davidsouther/jiffies/lib/esm/assert.js\";\nimport { FileSystem } from \"@davidsouther/jiffies/lib/esm/fs.js\";\nimport { range } from \"@davidsouther/jiffies/lib/esm/range.js\";\nimport { bin } from \"../util/twos.js\";\nimport { Clock } from \"./clock.js\";\n\nexport const HIGH = 1;\nexport const LOW = 0;\nexport type Voltage = typeof HIGH | typeof LOW;\n\nexport interface Pin {\n  readonly name: string;\n  readonly width: number;\n  busVoltage: number;\n  pull(voltage: Voltage, bit?: number): void;\n  toggle(bit?: number): void;\n  voltage(bit?: number): Voltage;\n  connect(pin: Pin): void;\n}\n\nexport class Bus implements Pin {\n  state: Voltage[];\n  next: Pin[] = [];\n\n  constructor(readonly name: string, readonly width = 1) {\n    this.state = range(0, this.width).map(() => LOW);\n  }\n\n  ensureWidth(newWidth: number) {\n    assert(newWidth <= 16, `Cannot widen past 16 to ${newWidth} bits`);\n    if (this.width < newWidth) {\n      (this as { width: number }).width = newWidth;\n      this.state = [\n        ...this.state,\n        ...range(this.width, newWidth).map(() => LOW as Voltage),\n      ];\n    }\n  }\n\n  connect(next: Pin) {\n    this.next.push(next);\n    next.busVoltage = this.busVoltage;\n  }\n\n  pull(voltage: Voltage, bit = 0) {\n    assert(\n      bit >= 0 && bit < this.width,\n      `Bit out of bounds: ${this.name}@${bit}`\n    );\n    this.state[bit] = voltage;\n    this.next.forEach((n) => n.pull(voltage, bit));\n  }\n\n  voltage(bit = 0): Voltage {\n    assert(bit >= 0 && bit < this.width);\n    return this.state[bit];\n  }\n\n  set busVoltage(voltage: number) {\n    for (const i of range(0, this.width)) {\n      this.state[i] = ((voltage & (1 << i)) >> i) as Voltage;\n    }\n    this.next.forEach((n) => (n.busVoltage = this.busVoltage));\n  }\n\n  get busVoltage(): number {\n    return range(0, this.width).reduce((b, i) => b | (this.state[i] << i), 0);\n  }\n\n  toggle(bit = 0) {\n    const nextVoltage = this.voltage(bit) === LOW ? HIGH : LOW;\n    this.pull(nextVoltage, bit);\n  }\n}\n\nexport class InSubBus extends Bus {\n  constructor(\n    private bus: Pin,\n    private start: number,\n    override readonly width = 1\n  ) {\n    super(bus.name);\n    assert(\n      start >= 0 && start + width <= bus.width,\n      `Mismatched InSubBus dimensions on ${bus.name} (${width} + ${start} > ${bus.width})`\n    );\n    this.connect(bus);\n  }\n\n  override pull(voltage: Voltage, bit = 0) {\n    assert(bit >= 0 && bit < this.width);\n    this.bus.pull(voltage, this.start + bit);\n  }\n\n  override voltage(bit = 0): Voltage {\n    assert(bit >= 0 && bit < this.width);\n    return this.bus.voltage(this.start + bit);\n  }\n\n  override set busVoltage(voltage: number) {\n    const high = this.bus.busVoltage & ~mask(this.width + this.start);\n    const low = this.bus.busVoltage & mask(this.start);\n    const mid = (voltage & mask(this.width)) << this.start;\n    this.bus.busVoltage = high | mid | low;\n  }\n\n  override get busVoltage(): number {\n    return (this.bus.busVoltage >> this.start) & mask(this.width);\n  }\n\n  override connect(bus: Pin): void {\n    assert(\n      this.start + this.width <= bus.width,\n      `Mismatched InSubBus connection dimensions (From ${bus.name} to ${this.name})`\n    );\n    this.bus = bus;\n  }\n}\n\nexport class OutSubBus extends Bus {\n  constructor(\n    private bus: Pin,\n    private start: number,\n    override readonly width = 1\n  ) {\n    super(bus.name);\n    assert(start >= 0 && width <= bus.width, `Mismatched OutSubBus dimensions`);\n    this.connect(bus);\n  }\n\n  override set busVoltage(voltage: number) {\n    this.bus.busVoltage =\n      (voltage & mask(this.width + this.start)) >> this.start;\n  }\n\n  override get busVoltage(): number {\n    return this.bus.busVoltage & mask(this.width);\n  }\n\n  override connect(bus: Pin): void {\n    assert(\n      this.width <= bus.width,\n      `Mismatched OutSubBus connection dimensions`\n    );\n    this.bus = bus;\n  }\n}\n\nexport class ConstantBus extends Bus {\n  constructor(name: string, private readonly value: number) {\n    super(name, 16 /* TODO: get high bit index */);\n  }\n\n  pullHigh(_ = 0) {\n    return undefined;\n  }\n  pullLow(_ = 0) {\n    return undefined;\n  }\n  override voltage(_ = 0): Voltage {\n    return (this.busVoltage & 0x1) as Voltage;\n  }\n\n  override set busVoltage(voltage: number) {\n    // Noop\n  }\n  override get busVoltage(): number {\n    return this.value;\n  }\n}\n\nexport const TRUE_BUS = new ConstantBus(\"true\", 0xffff);\nexport const FALSE_BUS = new ConstantBus(\"false\", 0);\n\nexport function parsePinDecl(toPin: string): {\n  pin: string;\n  width: number;\n} {\n  const { pin, w } = toPin.match(/(?<pin>[a-zA-Z]+)(\\[(?<w>\\d+)\\])?/)\n    ?.groups as {\n    pin: string;\n    w?: string;\n  };\n  return {\n    pin,\n    width: w ? Number(w) : 1,\n  };\n}\n\nexport function parseToPin(toPin: string): {\n  pin: string;\n  start?: number;\n  end?: number;\n} {\n  const { pin, i, j } = toPin.match(\n    /(?<pin>[a-z]+)(\\[(?<i>\\d+)(\\.\\.(?<j>\\d+))?\\])?/\n  )?.groups as { pin: string; i?: string; j?: string };\n  return {\n    pin,\n    start: i ? Number(i) : undefined,\n    end: j ? Number(j) : undefined,\n  };\n}\n\nexport class Pins {\n  private readonly map = new Map<string, Pin>();\n\n  insert(pin: Pin) {\n    const { name } = pin;\n    assert(!this.map.has(name), `Pins already has ${name}!`);\n    this.map.set(name, pin);\n  }\n\n  emplace(name: string, minWidth?: number) {\n    if (this.has(name)) {\n      return this.get(name)!;\n    } else {\n      const pin = new Bus(name, minWidth);\n      this.insert(pin);\n      return pin;\n    }\n  }\n\n  has(pin: string): boolean {\n    return this.map.has(pin);\n  }\n\n  get(pin: string): Pin | undefined {\n    return this.map.get(pin);\n  }\n\n  entries(): Iterable<Pin> {\n    return this.map.values();\n  }\n\n  [Symbol.iterator]() {\n    return this.map[Symbol.iterator]();\n  }\n}\n\nlet id = 0;\nexport class Chip {\n  readonly id = id++;\n  ins = new Pins();\n  outs = new Pins();\n  pins = new Pins();\n  parts = new Set<Chip>();\n  clockedPins: Set<string>;\n\n  get clocked() {\n    if (this.clockedPins.size > 0) {\n      return true;\n    }\n    for (const part of this.parts) {\n      if (part.clocked) return true;\n    }\n    return false;\n  }\n\n  constructor(\n    ins: (string | { pin: string; width: number })[],\n    outs: (string | { pin: string; width: number })[],\n    public name?: string,\n    internals: (string | { pin: string; width: number })[] = [],\n    clocked: string[] = []\n  ) {\n    for (const inn of ins) {\n      const { pin, width = 1 } =\n        (inn as { pin: string }).pin !== undefined\n          ? (inn as { pin: string; width: number })\n          : parsePinDecl(inn as string);\n      this.ins.insert(new Bus(pin, width));\n    }\n\n    for (const out of outs) {\n      const { pin, width = 1 } =\n        (out as { pin: string }).pin !== undefined\n          ? (out as { pin: string; width: number })\n          : parsePinDecl(out as string);\n      this.outs.insert(new Bus(pin, width));\n    }\n\n    for (const internal of internals) {\n      const { pin, width = 1 } =\n        (internal as { pin: string }).pin !== undefined\n          ? (internal as { pin: string; width: number })\n          : parsePinDecl(internal as string);\n      this.pins.insert(new Bus(pin, width));\n    }\n\n    this.clockedPins = new Set(clocked);\n\n    Clock.get().$.subscribe(() => this.eval());\n  }\n\n  reset() {\n    for (const [_, pin] of this.ins) {\n      pin.busVoltage = 0;\n    }\n    for (const part of this.parts) {\n      part.reset();\n    }\n    this.eval();\n  }\n\n  in(pin = \"in\"): Pin {\n    assert(this.hasIn(pin), `No in pin ${pin}`);\n    return this.ins.get(pin)!;\n  }\n\n  out(pin = \"out\"): Pin {\n    assert(this.hasOut(pin), `No in pin ${pin}`);\n    return this.outs.get(pin)!;\n  }\n\n  hasIn(pin: string): boolean {\n    return this.ins.has(pin);\n  }\n\n  hasOut(pin: string): boolean {\n    return this.outs.has(pin);\n  }\n\n  pin(name: string): Pin {\n    assert(this.pins.has(name));\n    return this.pins.get(name)!;\n  }\n\n  get(name: string, offset?: number): Pin | undefined {\n    if (this.ins.has(name)) {\n      return this.ins.get(name)!;\n    }\n    if (this.outs.has(name)) {\n      return this.outs.get(name)!;\n    }\n    if (this.pins.has(name)) {\n      return this.pins.get(name)!;\n    }\n    return this.getBuiltin(name, offset);\n  }\n\n  private getBuiltin(name: string, offset = 0): Pin | undefined {\n    if (BUILTIN_NAMES.includes(name)) {\n      for (const part of this.parts) {\n        const pin = part.get(name, offset);\n        if (pin) {\n          return pin;\n        }\n      }\n    }\n    return undefined;\n  }\n\n  isOutPin(pin: string): boolean {\n    return this.outs.has(pin);\n  }\n\n  wire(part: Chip, connections: Connection[]) {\n    this.parts.add(part);\n    for (const { to, from } of connections) {\n      if (part.isOutPin(to.name)) {\n        this.wireOutPin(part, to, from);\n      } else {\n        this.wireInPin(part, to, from);\n      }\n    }\n  }\n\n  private findPin(from: string, minWidth?: number): Pin {\n    if (from.toLowerCase() === \"true\" || from === \"1\") {\n      return TRUE_BUS;\n    }\n    if (from.toLowerCase() === \"false\" || from === \"0\") {\n      return FALSE_BUS;\n    }\n    if (this.ins.has(from)) {\n      return this.ins.get(from)!;\n    }\n    if (this.outs.has(from)) {\n      return this.outs.get(from)!;\n    }\n    return this.pins.emplace(from, minWidth);\n  }\n\n  private wireOutPin(part: Chip, to: PinSide, from: PinSide) {\n    const partPin = assertExists(\n      part.outs.get(to.name),\n      () => `Cannot wire to missing pin ${to.name}`\n    );\n    to.width ??= partPin.width;\n\n    let chipPin = this.findPin(from.name, from.width ?? to.width);\n    const isInternal = this.pins.has(chipPin.name);\n\n    from.width ??= chipPin.width;\n\n    if (chipPin instanceof ConstantBus) {\n      throw new Error(`Cannot wire to constant bus`);\n    }\n\n    // Widen internal pins\n    if (isInternal && chipPin instanceof Bus) {\n      chipPin.ensureWidth(from.start + from.width);\n    }\n\n    // Wrap the chipPin in an InBus when the chip side is dimensioned\n    if (from.start > 0 || from.width !== chipPin.width) {\n      chipPin = new InSubBus(chipPin, from.start, from.width);\n    }\n\n    // Wrap the chipPin in an OutBus when the part side is dimensioned\n    if (to.start > 0 || to.width !== chipPin.width) {\n      chipPin = new OutSubBus(chipPin, to.start, to.width);\n    }\n\n    partPin.connect(chipPin);\n  }\n\n  private wireInPin(part: Chip, to: PinSide, from: PinSide) {\n    let partPin = assertExists(\n      part.ins.get(to.name),\n      () => `Cannot wire to missing pin ${to.name}`\n    );\n    to.width ??= partPin.width;\n\n    const chipPin = this.findPin(from.name, from.width ?? to.width);\n\n    from.width ??= chipPin.width;\n\n    // Wrap the partPin in an InBus when the part side is dimensioned\n    if (to.start > 0 || to.width !== chipPin.width) {\n      partPin = new InSubBus(partPin, to.start, to.width);\n    }\n\n    // Wrap the partPin in an OutBus when the chip side is dimensioned\n    if (![\"true\", \"false\"].includes(chipPin.name)) {\n      if (from.start > 0 || from.width !== chipPin.width) {\n        partPin = new OutSubBus(partPin, from.start, from.width);\n      }\n    }\n    chipPin.connect(partPin);\n  }\n\n  eval() {\n    for (const chip of this.parts) {\n      // TODO topological sort\n      // eval chip input busses\n      TRUE_BUS.next.forEach((pin) => (pin.busVoltage = TRUE_BUS.busVoltage));\n      FALSE_BUS.next.forEach((pin) => (pin.busVoltage = FALSE_BUS.busVoltage));\n      chip.eval();\n      // eval output busses\n    }\n  }\n\n  tick() {\n    this.eval();\n  }\n\n  tock() {\n    this.eval();\n  }\n\n  remove() {\n    for (const part of this.parts) {\n      part.remove();\n    }\n  }\n\n  // For the ROM32K builtin to load from a file system\n  async load(fs: FileSystem, path: string): Promise<void> {\n    for (const part of this.parts) {\n      if (part.name === \"ROM32K\") {\n        await part.load(fs, path);\n      }\n    }\n  }\n}\n\nexport class Low extends Chip {\n  constructor() {\n    super([], []);\n    this.outs.insert(FALSE_BUS);\n  }\n}\n\nexport class High extends Chip {\n  constructor() {\n    super([], []);\n    this.outs.insert(TRUE_BUS);\n  }\n}\n\nexport class ClockedChip extends Chip {\n  override get clocked(): boolean {\n    return true;\n  }\n\n  #subscription = Clock.get().$.subscribe(({ level }) => {\n    if (level === LOW) {\n      this.tock();\n    } else {\n      this.tick();\n    }\n  });\n\n  override remove() {\n    this.#subscription.unsubscribe();\n    super.remove();\n  }\n\n  override reset(): void {\n    super.reset();\n    this.tick();\n    this.tock();\n  }\n}\n\nexport interface PinSide {\n  name: string;\n  start: number;\n  width?: number;\n}\n\nexport interface Connection {\n  // To is the part side\n  to: PinSide;\n  // From is the chip side\n  from: PinSide;\n}\n\nexport type Pinout = Record<string, string>;\nexport interface SerializedChip {\n  id: number;\n  name: string;\n  ins: Pinout;\n  outs: Pinout;\n  pins: Pinout;\n  children: SerializedChip[];\n}\n\nfunction mask(width: number) {\n  return Math.pow(2, width) - 1;\n}\n\nfunction setBus(busses: Pinout, pin: Pin) {\n  busses[pin.name] = bin(\n    (pin.busVoltage & mask(pin.width)) <<\n      (pin as unknown as { start: number }).start ?? 0\n  );\n  return busses;\n}\n\nexport function printChip(chip: Chip): SerializedChip {\n  return {\n    id: chip.id,\n    name: chip.name ?? chip.constructor.name,\n    ins: [...chip.ins.entries()].reduce(setBus, {} as Pinout),\n    outs: [...chip.outs.entries()].reduce(setBus, {} as Pinout),\n    pins: [...chip.pins.entries()].reduce(setBus, {} as Pinout),\n    children: [...chip.parts.values()].map(printChip),\n  };\n}\n\nexport const BUILTIN_NAMES = [\n  \"Register\",\n  \"ARegister\",\n  \"DRegister\",\n  \"PC\",\n  \"RAM8\",\n  \"RAM64\",\n  \"RAM512\",\n  \"RAM4K\",\n  \"RAM16K\",\n  \"ROM32K\",\n  \"Screen\",\n  \"Keyboard\",\n  \"Memory\",\n];\n","import { BehaviorSubject, Observable, Subject } from \"rxjs\";\nimport { assert } from \"@davidsouther/jiffies/lib/esm/assert.js\";\nimport { HIGH, LOW, Voltage } from \"./chip.js\";\n\ninterface Tick {\n  readonly level: Voltage;\n  readonly ticks: number;\n}\n\nlet clock: Clock;\nexport class Clock {\n  private level: Voltage = LOW;\n  private ticks = 0;\n\n  static get() {\n    if (clock === undefined) {\n      clock = new Clock();\n    }\n    return clock;\n  }\n\n  get isHigh(): boolean {\n    return this.level === HIGH;\n  }\n\n  get isLow(): boolean {\n    return this.level === LOW;\n  }\n\n  private subject = new BehaviorSubject<Tick>({\n    level: this.level,\n    ticks: this.ticks,\n  });\n  readonly frameSubject = new Subject<void>();\n  readonly resetSubject = new Subject<void>();\n\n  readonly $: Observable<Tick> = this.subject;\n  readonly frame$: Observable<void> = this.frameSubject;\n  readonly reset$: Observable<void> = this.resetSubject;\n\n  private next() {\n    this.subject.next({\n      level: this.level,\n      ticks: this.ticks,\n    });\n  }\n\n  private constructor() {\n    // private\n  }\n\n  reset() {\n    this.level = LOW;\n    this.ticks = 0;\n    this.next();\n    this.resetSubject.next();\n  }\n\n  tick() {\n    assert(this.level === LOW, \"Can only tick up from LOW\");\n    this.level = HIGH;\n    this.next();\n  }\n\n  tock() {\n    assert(this.level === HIGH, \"Can only tock down from HIGH\");\n    this.level = LOW;\n    this.ticks += 1;\n    this.next();\n  }\n\n  toggle() {\n    this.level === HIGH ? this.tock() : this.tick();\n  }\n\n  eval() {\n    this.tick();\n    this.tock();\n  }\n\n  frame() {\n    this.frameSubject.next();\n  }\n\n  toString() {\n    return `${this.ticks}${this.level === HIGH ? \"+\" : \"\"}`;\n  }\n}\n","export type COMMANDS_ASM =\n  | \"0\"\n  | \"1\"\n  | \"-1\"\n  | \"D\"\n  | \"A\"\n  | \"M\"\n  | \"!D\"\n  | \"!A\"\n  | \"-D\"\n  | \"-A\"\n  | \"D+1\"\n  | \"A+1\"\n  | \"D-1\"\n  | \"A-1\"\n  | \"D+A\"\n  | \"D-A\"\n  | \"D-M\"\n  | \"A-D\"\n  | \"D&A\"\n  | \"D&M\"\n  | \"D|A\"\n  | \"D|M\";\n\nexport type COMMANDS_OP =\n  | 0b101010\n  | 0b111111\n  | 0b111010\n  | 0b001100\n  | 0b110000\n  | 0b110000\n  | 0b001101\n  | 0b110001\n  | 0b001111\n  | 0b110011\n  | 0b011111\n  | 0b110111\n  | 0b001110\n  | 0b110010\n  | 0b000010\n  | 0b010011\n  | 0b010011\n  | 0b000111\n  | 0b000000\n  | 0b000000\n  | 0b010101\n  | 0b010101;\n\n//Usefull for the visualization of the ALU\nexport type COMMANDS_ALU =\n  | \"0\"\n  | \"1\"\n  | \"-1\"\n  | \"x\"\n  | \"y\"\n  | \"!x\"\n  | \"!y\"\n  | \"-x\"\n  | \"-y\"\n  | \"x+1\"\n  | \"y+1\"\n  | \"x-1\"\n  | \"y-1\"\n  | \"x+y\"\n  | \"x-y\"\n  | \"y-x\"\n  | \"x&y\"\n  | \"x|y\";\n\nexport const COMMANDS_ALU: {\n  op: Record<COMMANDS_OP, COMMANDS_ALU>;\n} = {\n  op: {\n    0x2a: \"0\",\n    0x3f: \"1\",\n    0x3a: \"-1\",\n    0x0c: \"x\",\n    0x30: \"y\",\n    0x0d: \"!x\",\n    0x31: \"!y\",\n    0x0f: \"-x\",\n    0x33: \"-y\",\n    0x1f: \"x+1\",\n    0x37: \"y+1\",\n    0x0e: \"x-1\",\n    0x32: \"y-1\",\n    0x02: \"x+y\",\n    0x13: \"x-y\",\n    0x07: \"y-x\",\n    0x00: \"x&y\",\n    0x15: \"x|y\",\n  },\n};\n\nexport const COMMANDS: {\n  asm: Record<COMMANDS_ASM, COMMANDS_OP>;\n  op: Record<COMMANDS_OP, COMMANDS_ASM>;\n} = {\n  asm: {\n    \"0\": 0b101010, // 42 0x2A\n    \"1\": 0b111111, // 63 0x3F\n    \"-1\": 0b111010, // 58 0x3A\n    D: 0b001100, // 12 0x0C\n    A: 0b110000, // 48 0x30\n    M: 0b110000, // 48 0x30\n    \"!D\": 0b001101, // 13 0x0D\n    \"!A\": 0b110001, // 49 0x31\n    \"-D\": 0b001111, // 15 0x0F\n    \"-A\": 0b110011, // 51 0x33\n    \"D+1\": 0b011111, // 31 0x1F\n    \"A+1\": 0b110111, // 55 0x37\n    \"D-1\": 0b001110, // 14 0x0E\n    \"A-1\": 0b110010, // 50 0x32\n    \"D+A\": 0b000010, //  2 0x02\n    \"D-A\": 0b010011, // 19 0x13\n    \"D-M\": 0b010011, // 19 0x13\n    \"A-D\": 0b000111, //  7 0x07\n    \"D&A\": 0b000000, //  0 0x00\n    \"D&M\": 0b000000, //  0 0x00\n    \"D|A\": 0b010101, // 21 0x15\n    \"D|M\": 0b010101, // 21 0x15\n  },\n  op: {\n    0x2a: \"0\",\n    0x3f: \"1\",\n    0x3a: \"-1\",\n    0x0c: \"D\",\n    0x30: \"A\",\n    0x0d: \"!D\",\n    0x31: \"!A\",\n    0x0f: \"-D\",\n    0x33: \"-A\",\n    0x1f: \"D+1\",\n    0x37: \"A+1\",\n    0x0e: \"D-1\",\n    0x32: \"A-1\",\n    0x02: \"D+A\",\n    0x13: \"D-A\",\n    0x07: \"A-D\",\n    0x00: \"D&A\",\n    0x15: \"D|A\",\n  },\n};\n\nexport type ASSIGN_ASM = \"\" | \"M\" | \"D\" | \"MD\" | \"A\" | \"AM\" | \"AD\" | \"AMD\";\nexport type ASSIGN_OP = 0 | 1 | 2 | 3 | 4 | 5 | 6 | 7;\n\nexport const ASSIGN: {\n  asm: Record<ASSIGN_ASM, ASSIGN_OP>;\n  op: Record<ASSIGN_OP, ASSIGN_ASM>;\n} = {\n  asm: {\n    \"\": 0x0,\n    M: 0b001,\n    D: 0b010,\n    MD: 0b011,\n    A: 0b100,\n    AM: 0b101,\n    AD: 0b110,\n    AMD: 0b111,\n  },\n  op: {\n    0x0: \"\",\n    0x1: \"M\",\n    0x2: \"D\",\n    0x3: \"MD\",\n    0x4: \"A\",\n    0x5: \"AM\",\n    0x6: \"AD\",\n    0x7: \"AMD\",\n  },\n};\n\nexport type JUMP_ASM =\n  | \"\"\n  | \"JGT\"\n  | \"JEQ\"\n  | \"JGE\"\n  | \"JLT\"\n  | \"JNE\"\n  | \"JLE\"\n  | \"JMP\";\nexport type JUMP_OP = 0 | 1 | 2 | 3 | 4 | 5 | 6 | 7;\nexport const JUMP: {\n  asm: Record<JUMP_ASM, JUMP_OP>;\n  op: Record<JUMP_OP, JUMP_ASM>;\n} = {\n  asm: {\n    \"\": 0b0,\n    JGT: 0b001,\n    JEQ: 0b010,\n    JGE: 0b011,\n    JLT: 0b100,\n    JNE: 0b101,\n    JLE: 0b110,\n    JMP: 0b111,\n  },\n  op: {\n    0x0: \"\",\n    0x1: \"JGT\",\n    0x2: \"JEQ\",\n    0x3: \"JGE\",\n    0x4: \"JLT\",\n    0x5: \"JNE\",\n    0x6: \"JLE\",\n    0x7: \"JMP\",\n  },\n};\n\nexport const Flags = {\n  0x01: \"Positive\",\n  0x00: \"Zero\",\n  0x0f: \"Negative\",\n  Positive: 0x01,\n  Zero: 0x00,\n  Negative: 0x0f,\n};\n\nexport function alu(op: number, d: number, a: number): [number, number] {\n  let o = 0;\n  switch (op) {\n    case 0x2a:\n      o = 0;\n      break;\n    case 0x3f:\n      o = 1;\n      break;\n    case 0x3a:\n      o = -1;\n      break;\n    case 0x0c:\n      o = d;\n      break;\n    case 0x30:\n      o = a;\n      break;\n    case 0x0d:\n      o = ~d;\n      break;\n    case 0x31:\n      o = ~a;\n      break;\n    case 0x0f:\n      o = -d;\n      break;\n    case 0x33:\n      o = -a;\n      break;\n    case 0x1f:\n      o = d + 1;\n      break;\n    case 0x37:\n      o = a + 1;\n      break;\n    case 0x0e:\n      o = d - 1;\n      break;\n    case 0x32:\n      o = a - 1;\n      break;\n    case 0x02:\n      o = d + a;\n      break;\n    case 0x13:\n      o = d - a;\n      break;\n    case 0x07:\n      o = a - d;\n      break;\n    case 0x00:\n      o = d & a;\n      break;\n    case 0x15:\n      o = d | a;\n      break;\n  }\n\n  o = o & 0xffff;\n  const flags =\n    o === 0 ? Flags.Zero : o & 0x8000 ? Flags.Negative : Flags.Positive;\n  return [o, flags];\n}\n\nexport function alua(op: number, d: number, a: number): [number, number] {\n  if (op & 0b100000) d = 0;\n  if (op & 0b010000) d = ~d & 0xffff;\n  if (op & 0b001000) a = 0;\n  if (op & 0b000100) a = ~a & 0xffff;\n\n  let o = (op & 0b000010 ? d + a : d & a) & 0xffff;\n  if (op & 0b000001) o = ~o & 0xffff;\n\n  const flags =\n    o === 0 ? Flags.Zero : o & 0x8000 ? Flags.Negative : Flags.Positive;\n  return [o, flags];\n}\n","import { alu, COMMANDS_OP, Flags } from \"./alu.js\";\nimport { Memory } from \"./memory.js\";\n\nexport interface CPUInput {\n  inM: number;\n  instruction: number;\n  reset: boolean;\n}\n\nexport interface CPUOutput {\n  outM: number;\n  writeM: boolean;\n  addressM: number;\n}\n\nexport interface CPUState {\n  A: number;\n  D: number;\n  PC: number;\n  ALU: number;\n  flag: number;\n}\n\nexport function emptyState(): CPUState {\n  return { A: 0, D: 0, PC: 0, ALU: 0, flag: Flags.Zero };\n}\n\nconst BITS = {\n  c: 0b1000_0000_0000_0000,\n  x1: 0b1001_0000_0000_0000,\n  x2: 0b1001_0000_0000_0000,\n  am: 0b1001_0000_0000_0000,\n  op: 0b0000_1111_1100_0000,\n  d1: 0b1000_0000_0010_0000,\n  d2: 0b1000_0000_0001_0000,\n  d3: 0b1000_0000_0000_1000,\n  j1: 0b1000_0000_0000_0001,\n  j2: 0b1000_0000_0000_0010,\n  j3: 0b1000_0000_0000_0100,\n};\n\nexport function decode(instruction: number) {\n  function bit(bit: number): boolean {\n    return (instruction & bit) === bit;\n  }\n  const bits = {\n    c: bit(BITS.c),\n    x1: bit(BITS.x1),\n    x2: bit(BITS.x2),\n    am: bit(BITS.am),\n    op: ((instruction & BITS.op) >> 6) as COMMANDS_OP,\n    d1: bit(BITS.d1),\n    d2: bit(BITS.d2),\n    d3: bit(BITS.d3),\n    j1: bit(BITS.j1),\n    j2: bit(BITS.j2),\n    j3: bit(BITS.j3),\n  };\n\n  return bits;\n}\n\nexport function cpuTick(\n  { inM, instruction }: CPUInput,\n  { A, D, PC }: CPUState\n): [CPUState, boolean] {\n  const bits = decode(instruction);\n  const a = bits.am ? inM : A;\n  const [ALU, flag] = alu(bits.op, D, a);\n\n  return [{ A, D, PC: PC + 1, ALU, flag }, bits.d3];\n}\n\nexport function cpuTock(\n  { inM, instruction, reset }: CPUInput,\n  { A, D, PC, ALU, flag }: CPUState\n): [CPUOutput, CPUState] {\n  const bits = decode(instruction);\n\n  const j1 = bits.j1 && flag === Flags.Positive;\n  const j2 = bits.j2 && flag === Flags.Zero;\n  const j3 = bits.j3 && flag === Flags.Negative;\n  const jmp = j1 || j2 || j3;\n\n  PC = reset ? 0 : jmp ? A : PC;\n\n  if (bits.d2) {\n    D = ALU;\n  }\n\n  if (!bits.c) {\n    A = instruction & 0x7fff;\n  } else if (bits.d1) {\n    A = ALU;\n  }\n\n  const a = bits.am ? inM : A;\n  const alu2 = alu(bits.op, D, a);\n\n  ALU = alu2[0];\n  flag = alu2[1];\n\n  const output: CPUOutput = {\n    addressM: A,\n    outM: ALU,\n    writeM: bits.d3,\n  };\n\n  const state: CPUState = {\n    A,\n    D,\n    ALU,\n    flag,\n    PC,\n  };\n\n  return [output, state];\n}\n\nexport function cpu(input: CPUInput, state: CPUState): [CPUOutput, CPUState] {\n  const [tickState, _writeM] = cpuTick(input, state);\n  return cpuTock(input, tickState);\n}\n\nexport class CPU {\n  RAM: Memory;\n  ROM: Memory;\n\n  #pc = 0;\n  #a = 0;\n  #d = 0;\n\n  #tickState: CPUState = {\n    A: 0,\n    D: 0,\n    PC: 0,\n    ALU: 0,\n    flag: Flags.Zero,\n  };\n\n  get state(): CPUState {\n    return this.#tickState;\n  }\n\n  get PC() {\n    return this.#pc;\n  }\n\n  get A() {\n    return this.#a;\n  }\n\n  get D() {\n    return this.#d;\n  }\n\n  constructor({\n    RAM = new Memory(0x7fff),\n    ROM,\n  }: {\n    RAM?: Memory;\n    ROM: Memory;\n  }) {\n    this.RAM = RAM;\n    this.ROM = ROM;\n  }\n\n  reset() {\n    this.#pc = 0;\n    this.#a = 0;\n    this.#d = 0;\n  }\n\n  tick() {\n    const [{ addressM, outM, writeM }, { A, D, PC }] = cpu(\n      {\n        inM: this.RAM.get(this.#a),\n        instruction: this.ROM.get(this.#pc),\n        reset: false,\n      },\n      {\n        A: this.#a,\n        D: this.#d,\n        PC: this.#pc,\n        ALU: this.#d,\n        flag: Flags.Zero,\n      }\n    );\n\n    this.#a = A;\n    this.#d = D;\n    this.#pc = PC;\n\n    if (writeM) {\n      this.RAM.set(addressM, outM);\n    }\n  }\n}\n","import { assert } from \"@davidsouther/jiffies/lib/esm/assert.js\";\nimport { FileSystem } from \"@davidsouther/jiffies/lib/esm/fs.js\";\nimport { Subject } from \"rxjs\";\nimport { op } from \"../util/asm.js\";\nimport { int10, int16, int2 } from \"../util/twos.js\";\nimport { load } from \"../fs.js\";\n\nexport const FORMATS = [\"bin\", \"dec\", \"hex\", \"asm\"];\nexport type Format = typeof FORMATS[number];\n\nexport const SCREEN = 0x4000;\nexport const SCREEN_ROWS = 512;\nexport const SCREEN_COLS = 256;\nexport const KEYBOARD = 0x6000;\n\nexport class Memory {\n  #memory: Int16Array;\n  updates = new Subject<void>();\n\n  get size(): number {\n    return this.#memory.length;\n  }\n\n  constructor(memory: ArrayBuffer | number) {\n    if (typeof memory === \"number\") {\n      this.#memory = new Int16Array(memory);\n    } else {\n      this.#memory = new Int16Array(memory);\n    }\n  }\n\n  get(index: number): number {\n    if (index < 0 || index >= this.size) {\n      return 0xffff;\n    }\n    return this.#memory[index] ?? 0;\n  }\n\n  set(index: number, value: number): void {\n    if (index >= 0 && index < this.size) {\n      this.#memory[index] = value & 0xffff;\n    }\n  }\n\n  reset(): void {\n    this.#memory.fill(0);\n  }\n\n  update(cell: number, value: string, format: Format) {\n    let current: number;\n    switch (format) {\n      case \"asm\":\n        current = op(value);\n        break;\n      case \"bin\":\n        current = int2(value);\n        break;\n      case \"hex\":\n        current = int16(value);\n        break;\n      case \"dec\":\n      default:\n        current = int10(value);\n        break;\n    }\n\n    if (isFinite(current) && current <= 0xffff) {\n      this.set(cell, current);\n      this.updates.next();\n    }\n  }\n\n  async load(fs: FileSystem, path: string) {\n    try {\n      (await load(fs, path)).map((v, i) => this.set(i, v));\n    } catch (cause) {\n      // throw new Error(`ROM32K Failed to load file ${path}`, { cause });\n      throw new Error(`Memory Failed to load file ${path}`);\n    }\n  }\n\n  range(start = 0, end = this.size): number[] {\n    return [...this.#memory.slice(start, end)];\n  }\n\n  *map<T>(\n    fn: (index: number, value: number) => T,\n    start = 0,\n    end = this.size\n  ): Iterable<T> {\n    assert(start < end);\n    for (let i = start; i < end; i++) {\n      yield fn(i, this.get(i));\n    }\n  }\n}\n","const asm = `\nASM <: Base {\n  Root := ASM\n  ASM = Instruction*\n  \n  Instruction = Label|AInstruction|CInstruction\n  \n  Label = OpenParen identifier closeParen\n  AInstruction = at (identifier | decNumber)\n  CInstruction = assign? op jmp?\n  \n  assign = (\n      \"AMD\"\n      | \"AM\"\n      | \"AD\"\n      | \"MD\"\n      | \"M\"\n      | \"D\"\n      | \"A\"\n      ) equal\n      \n  op =\n      | \"0\" | \"1\" | \"-1\"\n      | \"!D\" | \"!A\" | \"!M\"\n      | \"-D\" | \"-A\" | \"-M\"\n      | \"D+1\" | \"A+1\" | \"M+1\"\n      | \"D-1\" | \"A-1\" | \"M-1\"\n      | \"D+A\" | \"D+M\"\n      | \"D-A\" | \"D-M\"\n      | \"A-D\" | \"M-D\"\n      | \"D&A\" | \"D&M\"\n      | \"D|A\" | \"D|M\"\n      | \"D\" | \"A\" | \"M\"\n\n\n  jmp = semi (\"JGT\" | \"JEQ\" | \"JGE\" | \"JLT\" | \"JNE\" | \"JLE\" | \"JMP\")\n}`;\nexport default asm;\n","import { assertExists } from \"@davidsouther/jiffies/lib/esm/assert.js\";\nimport ohm from \"ohm-js\";\nimport {\n  ASSIGN,\n  ASSIGN_ASM,\n  ASSIGN_OP,\n  COMMANDS,\n  COMMANDS_ASM,\n  COMMANDS_OP,\n  JUMP,\n  JUMP_ASM,\n  JUMP_OP,\n} from \"../cpu/alu.js\";\nimport { KEYBOARD, SCREEN } from \"../cpu/memory.js\";\nimport { makeC } from \"../util/asm.js\";\nimport { grammars, makeParser, baseSemantics } from \"./base.js\";\n\nimport asmGrammar from \"./grammars/asm.ohm.js\";\n\nexport const grammar = ohm.grammar(asmGrammar, grammars);\nexport const asmSemantics = grammar.extendSemantics(baseSemantics);\n\nexport interface Asm {\n  instructions: AsmInstruction[];\n}\n\nexport type AsmInstruction =\n  | AsmAInstruction\n  | AsmCInstruction\n  | AsmLabelInstruction;\n\nexport type AsmAInstruction = AsmALabelInstruction | AsmAValueInstruction;\nexport interface AsmALabelInstruction {\n  type: \"A\";\n  label: string;\n}\n\nexport interface AsmAValueInstruction {\n  type: \"A\";\n  value: number;\n}\n\nfunction isALabelInstruction(\n  inst: AsmAInstruction\n): inst is AsmALabelInstruction {\n  return (inst as AsmALabelInstruction).label !== undefined;\n}\n\nexport interface AsmCInstruction {\n  type: \"C\";\n  op: COMMANDS_OP;\n  isM: boolean;\n  store?: ASSIGN_OP;\n  jump?: JUMP_OP;\n}\n\nexport interface AsmLabelInstruction {\n  type: \"L\";\n  label: string;\n}\n\nasmSemantics.addAttribute<Asm>(\"root\", {\n  Root(_) {\n    return this.asm;\n  },\n});\n\nasmSemantics.addAttribute<Asm>(\"asm\", {\n  Root(asm) {\n    return {\n      instructions: asm\n        .child(0)\n        .children.map(({ instruction }) => instruction as AsmInstruction),\n    };\n  },\n});\n\nasmSemantics.addAttribute<AsmInstruction>(\"instruction\", {\n  AInstruction(_at, val): AsmAInstruction {\n    try {\n      return {\n        type: \"A\",\n        label: val.name,\n      };\n    } catch (e) {\n      // Pass\n    }\n\n    try {\n      return {\n        type: \"A\",\n        value: val.value,\n      };\n    } catch (e) {\n      // pass\n    }\n\n    throw new Error(`AsmAInstruction must have either a name or a value`);\n  },\n  CInstruction(assignN, opN, jmpN): AsmCInstruction {\n    const assign = assignN.child(0)?.child(0)?.sourceString as ASSIGN_ASM;\n    const op = opN.sourceString.replace(\"M\", \"A\") as COMMANDS_ASM;\n    const jmp = jmpN.child(0)?.child(1)?.sourceString as JUMP_ASM;\n    const isM =\n      assignN.sourceString.includes(\"M\") || opN.sourceString.includes(\"M\");\n    const inst: AsmCInstruction = {\n      type: \"C\",\n      op: COMMANDS.asm[op],\n      isM,\n    };\n    if (jmp) inst.jump = JUMP.asm[jmp];\n    if (assign) inst.store = ASSIGN.asm[assign];\n    return inst;\n  },\n  Label(_o, { name }, _c): AsmLabelInstruction {\n    return {\n      type: \"L\",\n      label: name,\n    };\n  },\n});\n\nexport function fillLabel(asm: Asm) {\n  let nextLabel = 16;\n  const symbols = new Map<string, number>([\n    [\"R0\", 0],\n    [\"R1\", 1],\n    [\"R2\", 2],\n    [\"R3\", 3],\n    [\"R4\", 4],\n    [\"R5\", 5],\n    [\"R6\", 6],\n    [\"R7\", 7],\n    [\"R8\", 8],\n    [\"R9\", 9],\n    [\"R10\", 10],\n    [\"R11\", 11],\n    [\"R12\", 12],\n    [\"R13\", 13],\n    [\"R14\", 14],\n    [\"R15\", 15],\n    [\"SP\", 0],\n    [\"LCL\", 1],\n    [\"ARG\", 2],\n    [\"THIS\", 3],\n    [\"THAT\", 4],\n    [\"SCREEN\", SCREEN],\n    [\"KBD\", KEYBOARD],\n  ]);\n\n  function getLabelValue(label: string) {\n    if (!symbols.has(label)) {\n      symbols.set(label, nextLabel);\n      nextLabel += 1;\n    }\n    return assertExists(symbols.get(label), `Label not in symbols: ${label}`);\n  }\n\n  function transmuteAInstruction(instruction: AsmALabelInstruction) {\n    const value = getLabelValue(instruction.label);\n    (instruction as unknown as AsmAValueInstruction).value = value;\n    delete (instruction as unknown as { label: undefined }).label;\n  }\n\n  const unfilled: AsmALabelInstruction[] = [];\n  let line = 0;\n  for (const instruction of asm.instructions) {\n    if (instruction.type === \"L\") {\n      if (symbols.has(instruction.label)) {\n        throw new Error(`ASM Duplicate label ${instruction.label}`);\n      } else {\n        symbols.set(instruction.label, line);\n      }\n      continue;\n    }\n\n    line += 1;\n\n    if (instruction.type === \"A\") {\n      if (isALabelInstruction(instruction)) {\n        unfilled.push(instruction);\n      }\n    }\n  }\n\n  unfilled.forEach(transmuteAInstruction);\n}\n\nexport function emit(asm: Asm): number[] {\n  return asm.instructions\n    .map((inst) => {\n      if (inst.type === \"A\") {\n        if (isALabelInstruction(inst)) {\n          throw new Error(`ASM Emitting unfilled A instruction`);\n        }\n        return inst.value;\n      }\n      if (inst.type === \"C\") {\n        return makeC(inst.isM, inst.op, inst.store, inst.jump);\n      }\n      return undefined;\n    })\n    .filter((op): op is number => op !== undefined);\n}\n\nexport const ASM = {\n  grammar: asmGrammar,\n  semantics: asmSemantics,\n  parser: grammar,\n  parse: makeParser<Asm>(grammar, asmSemantics),\n  passes: {\n    fillLabel,\n    emit,\n  },\n};\n","import { FileSystem } from \"@davidsouther/jiffies/lib/esm/fs.js\";\nimport { unwrap } from \"@davidsouther/jiffies/lib/esm/result.js\";\nimport { ASM } from \"./languages/asm.js\";\nimport { int2 } from \"./util/twos.js\";\n\nexport async function load(fs: FileSystem, path: string): Promise<number[]> {\n  if (path.endsWith(\".hack\")) {\n    return loadHack(fs, path);\n  }\n\n  if (path.endsWith(\".asm\")) {\n    return loadAsm(fs, path);\n  }\n\n  throw new Error(`Cannot load file without hack or asm extension ${path}`);\n}\n\nexport async function loadAsm(fs: FileSystem, path: string): Promise<number[]> {\n  const source = await fs.readFile(path);\n  const asm = unwrap(ASM.parse(source));\n  ASM.passes.fillLabel(asm);\n  return ASM.passes.emit(asm);\n}\n\nexport async function loadHack(\n  fs: FileSystem,\n  path: string\n): Promise<number[]> {\n  return (await fs.readFile(path))\n    .split(\"\\n\")\n    .filter((line) => line.trim() !== \"\")\n    .map(int2);\n}\n","import ohm from \"ohm-js\";\nimport { int10, int16, int2 } from \"../util/twos.js\";\nimport { Err, Ok, Result } from \"@davidsouther/jiffies/lib/esm/result.js\";\n\nexport const UNKNOWN_PARSE_ERROR = `Unknown parse error`;\n\nimport baseGrammar from \"./grammars/base.ohm.js\";\nexport const grammars = {\n  Base: ohm.grammar(baseGrammar),\n};\n\nexport const baseSemantics = grammars.Base.createSemantics();\n\nbaseSemantics.extendOperation(\"asIteration\", {\n  List(list, _) {\n    return list.asIteration();\n  },\n});\n\nbaseSemantics.addAttribute(\"value\", {\n  decNumber(_, digits): number {\n    return int10(digits.sourceString);\n  },\n  wholeDec(_, digits): number {\n    return int10(digits.sourceString);\n  },\n  binNumber(_, digits) {\n    return int2(digits.sourceString);\n  },\n  hexNumber(_, digits) {\n    return int16(digits.sourceString);\n  },\n  Number(num) {\n    return num.value;\n  },\n  Name(ident) {\n    return ident.name;\n  },\n  identifier(_, __): string {\n    return this.sourceString;\n  },\n});\n\nbaseSemantics.addAttribute(\"name\", {\n  identifier(_, __): string {\n    return this.sourceString;\n  },\n  Name(_): string {\n    return this.child(0)?.name;\n  },\n});\n\nbaseSemantics.addAttribute(\"String\", {\n  String(_a, str, _b) {\n    return str.sourceString;\n  },\n});\n\nexport type ParseError = Error | { message: string; shortMessage: string };\n\nexport function makeParser<ResultType>(\n  grammar: ohm.Grammar,\n  semantics: ohm.Semantics,\n  property: (obj: ohm.Dict) => ResultType = ({ root }) => root\n): (source: string) => Result<ResultType, ParseError> {\n  return function parse(source) {\n    try {\n      const match = grammar.match(source);\n      if (match.succeeded()) {\n        const parsed = semantics(match);\n        const parse = property(parsed);\n        return Ok(parse);\n      } else {\n        return Err({\n          message: match.message ?? UNKNOWN_PARSE_ERROR,\n          shortMessage: match.shortMessage ?? UNKNOWN_PARSE_ERROR,\n        });\n      }\n    } catch (e) {\n      return Err(e as Error);\n    }\n  };\n}\n\nexport interface Span {\n  start: number;\n  end: number;\n}\n","const base = `\nBase {\n  Root = Value*\n\n  At = at\n  Bang = bang\n  Bar = bar\n  CloseAngle = closeAngle\n  CloseBrace = closeBrace\n  CloseParen = closeParen\n  CloseSquare = closeSquare\n  Comma = comma\n  Dollar = dollar\n  Dot = dot\n  DoubleQuote = doubleQuote\n  Equal = equal\n  OpenAngle = openAngle\n  OpenBrace = openBrace\n  OpenParen = openParen\n  OpenSquare = openSquare\n  Percent = percent\n  Semi = semi\n  Underscore = underscore\n\n  at = \"@\"\n  bang = \"!\"\n  bar = \"|\"\n  closeAngle = \">\"\n  closeBrace = \"}\"\n  closeParen = \")\"\n  closeSquare = \"]\"\n  comma = \",\"\n  dollar = \"$\"\n  dot = \".\"\n  doubleQuote = \"\\\\\"\"\n  equal = \"=\"\n  minus = \"-\"\n  newline = \"\\\\r\"? \"\\\\n\"\n  openAngle = \"<\"\n  openBrace = \"{\"\n  openParen = \"(\"\n  openSquare = \"[\"\n  percent = \"%\"\n  semi = \";\"\n  underscore = \"_\"\n\n  Value = identifier | number | boolean\n\n  boolean = true | false\n  True = true\n  False = false\n  true = \"true\"\n  false = \"false\"\n\n  Name = identifier\n  identifier = (letter|underscore) (alnum|underscore|dot|dollar)*\n\n  Number = number\n  number = hexNumber | decNumber | binNumber\n  binNumber = (\"%B\") (\"0\"|\"1\")+\n  hexNumber = (\"%X\") hexDigit+\n  decNumber = (\"%D\")? (wholeDec | realDec)\n  wholeDec = minus? digit+\n  realDec = minus? digit* \".\" digit+\n\n  String = DoubleQuote (~doubleQuote any)* doubleQuote\n  \n  spaces := (lineComment | comment | space)*\n  commentStart = \"/*\"\n  commentEnd = \"*/\"\n  comment = commentStart (~commentEnd any)* commentEnd\n  lineCommentStart = \"//\"\n  lineComment = lineCommentStart (~\"\\\\n\" any)* \"\\\\n\"\n\n  List<elem, sep> = NonemptyListOf<elem, sep> sep?\n  EmptyList<elem, sep> = EmptyList<elem, sep> sep?\n}`;\nexport default base;\n","const cmp = `\nCmp <: Base {\n  Root := line*\n  line = bar cell+ newline?\n  cell = cellvalue bar\n  cellvalue = (~(bar|newline) any)*\n}`;\nexport default cmp;\n","import ohm from \"ohm-js\";\nimport { grammars, makeParser, baseSemantics } from \"./base.js\";\n\nexport type Cell = string;\nexport type Line = Cell[];\nexport type Cmp = Line[];\n\nimport cmpGrammar from \"./grammars/cmp.ohm.js\";\nexport const grammar = ohm.grammar(cmpGrammar, grammars);\nexport const cmpSemantics = grammar.extendSemantics(baseSemantics);\n\ncmpSemantics.addAttribute<Cell>(\"cell\", {\n  cell(value, _) {\n    return value.sourceString;\n  },\n});\n\ncmpSemantics.addAttribute<Line>(\"line\", {\n  line(_a, cells, _b) {\n    return cells.children.map((c) => c.cell);\n  },\n});\n\ncmpSemantics.addAttribute<Cmp>(\"root\", {\n  Root(lines) {\n    return lines.children.map((c) => c.line);\n  },\n});\n\nexport const CMP = {\n  grammar: cmpGrammar,\n  semantics: cmpSemantics,\n  parser: grammar,\n  parse: makeParser<Cmp>(grammar, cmpSemantics),\n};\n","const hdl = `\nHdl <: Base{\n  Root := Chip\n  Chip = \"CHIP\" Name OpenBrace ChipBody CloseBrace\n  ChipBody = InList? OutList? PartList ClockedList?\n  InList = \"IN\" PinList Semi\n  OutList = \"OUT\" PinList Semi\n  PartList = BuiltinPart | Parts\n  PinList = List<PinDecl, Comma>\n  PinDecl = Name PinWidth?\n  PinWidth = OpenSquare decNumber CloseSquare\n  BuiltinPart = \"BUILTIN\" Semi\n  Parts = \"PARTS:\" Part*\n  Part = Name \"(\" Wires \")\" Semi\n  Wires = List<Wire, Comma>\n  Wire = WireSide Equal (WireSide | True | False) \n  WireSide = Name SubBus? \n  SubBus = OpenSquare decNumber subBusRest? CloseSquare\n  subBusRest = \"..\" decNumber\n  ClockedList = \"CLOCKED\" SimplePinList Semi\n  SimplePinList = List<Name, Comma>\n}`;\nexport default hdl;\n","/** Reads and parses HDL chip descriptions. */\nimport ohm from \"ohm-js\";\nimport { grammars, baseSemantics } from \"./base.js\";\nimport { makeParser } from \"./base.js\";\n\nexport interface PinIndex {\n  start?: number | undefined;\n  end?: number | undefined;\n}\n\nexport interface PinParts extends PinIndex {\n  pin: string;\n}\n\nexport interface PinDeclaration {\n  pin: string | string;\n  width: number;\n}\n\nexport interface Wire {\n  lhs: PinParts;\n  rhs: PinParts;\n}\n\nexport interface Part {\n  name: string;\n  wires: Wire[];\n}\n\nexport interface HdlParse {\n  name: string;\n  ins: PinDeclaration[];\n  outs: PinDeclaration[];\n  clocked: string[];\n  parts: \"BUILTIN\" | Part[];\n}\n\nimport hdlGrammar from \"./grammars/hdl.ohm.js\";\nexport const grammar = ohm.grammar(hdlGrammar, grammars);\n\nexport const hdlSemantics = grammar.extendSemantics(baseSemantics);\n\nhdlSemantics.addAttribute<PinIndex>(\"SubBus\", {\n  SubBus(_a, startNode, endNode, _b) {\n    const start = startNode.value;\n    const end = endNode.child(0)?.child(1)?.value ?? start;\n    return { start, end };\n  },\n});\n\nhdlSemantics.addAttribute<PinParts>(\"WireSide\", {\n  WireSide({ name }, index) {\n    const { start, end } = (index.child(0)?.SubBus as PinIndex) ?? {\n      start: undefined,\n      end: undefined,\n    };\n    return { pin: name, start, end };\n  },\n});\n\nhdlSemantics.addAttribute<Wire>(\"Wire\", {\n  Wire(left, _, right) {\n    const rhs: PinParts = right.isTerminal()\n      ? { pin: right.sourceString }\n      : right.WireSide;\n    return { lhs: left.WireSide as PinParts, rhs };\n  },\n});\n\nhdlSemantics.addAttribute<Wire[]>(\"Wires\", {\n  Wires(list) {\n    return list.asIteration().children.map((node) => node.Wire as Wire);\n  },\n});\n\nhdlSemantics.addAttribute<Part>(\"Part\", {\n  Part({ name }, _a, { Wires }, _b, _c) {\n    return { name: name as string, wires: Wires as Wire[] };\n  },\n});\n\nhdlSemantics.addAttribute<Part[] | \"BUILTIN\">(\"Parts\", {\n  Parts(_, parts) {\n    return parts.children.map((c) => c.Part);\n  },\n  BuiltinPart(_a, _b) {\n    return \"BUILTIN\";\n  },\n});\n\nhdlSemantics.addAttribute<\"BUILTIN\" | Part[]>(\"PartList\", {\n  PartList(list) {\n    return list.Parts;\n  },\n});\n\nhdlSemantics.addAttribute<string[]>(\"Clocked\", {\n  ClockedList(_a, clocked, _b) {\n    return (\n      clocked\n        .asIteration()\n        .children.map(\n          ({ sourceString }: { sourceString: string }) => sourceString\n        ) ?? []\n    );\n  },\n});\n\nhdlSemantics.addAttribute<PinDeclaration>(\"PinDecl\", {\n  PinDecl({ name }, width) {\n    return {\n      pin: name,\n      width: width.child(0)?.child(1)?.value ?? 1,\n    };\n  },\n});\n\nhdlSemantics.addAttribute<PinDeclaration[]>(\"PinList\", {\n  PinList(list) {\n    return list\n      .asIteration()\n      .children.map((node) => node.PinDecl as PinDeclaration);\n  },\n});\n\nhdlSemantics.addAttribute<HdlParse>(\"Chip\", {\n  Chip(_a, { name }, _b, body, _c) {\n    return {\n      name,\n      ins: body.child(0).child(0)?.child(1)?.PinList ?? [],\n      outs: body.child(1).child(0)?.child(1)?.PinList ?? [],\n      parts: body.child(2).PartList ?? [],\n      clocked: body.child(3).child(0)?.Clocked,\n    };\n  },\n});\n\nhdlSemantics.addAttribute<HdlParse>(\"Root\", {\n  Root(root) {\n    return root.child(0)?.Chip;\n  },\n});\n\nexport const HDL = {\n  parser: grammar,\n  grammar: hdlGrammar,\n  semantics: hdlSemantics,\n  parse: makeParser<HdlParse>(grammar, hdlSemantics, (n) => n.Chip),\n};\n","const tst = `\nTst <: Base {\n  Root := Tst\n  Tst = (TstStatement | TstRepeat | TstWhile)+\n\n  TstRepeat = Repeat Number? OpenBrace TstStatement+ CloseBrace\n  TstWhile = While Condition OpenBrace TstStatement+ CloseBrace\n  TstStatement = List<TstOperation, \",\"> (Semi | Bang)\n\n  TstOperation =\n    | TstFileOperation\n    | TstOutputListOperation\n    | TstEvalOperation\n    | TstSetOperation\n    | TstOutputOperation\n    | TstEchoOperation\n    | TstClearEchoOperation\n    | TstLoadROMOperation\n\n  TstLoadROMOperation = ROM32K Load FileName\n  TstFileOperation = FileOperation FileName\n  TstOutputListOperation = \"output-list\" OutputFormat+\n  OutputFormat = Name Index? percent FormatStyle wholeDec dot wholeDec dot wholeDec\n  TstSetOperation = Set Name Index? Number\n  Index = OpenSquare wholeDec? CloseSquare\n  Condition = Value CompareOp Value\n  TstEvalOperation = Eval | Tick | Tock\n  TstOutputOperation = Output\n  TstEchoOperation = Echo String\n  TstClearEchoOperation = ClearEcho\n\n  FileName = Name\n  FileOperation = \"load\" | \"output-file\" | \"compare-to\"\n\n  Set = \"set\"\n  Eval = \"eval\"\n  Tick = \"tick\"\n  Tock = \"tock\"\n  Echo = \"echo\"\n  Repeat = \"repeat\"\n  ClearEcho = \"clear-echo\"\n  Output = \"output\"\n  OutputList = \"output-list\"\n  FormatStyle = \"B\"|\"D\"|\"S\"|\"X\"\n  ROM32K = \"ROM32K\"\n  Load = \"load\"\n  While = \"while\"\n\n  CompareOp = \"<>\" | \"<=\" | \">=\" | \"=\" | \"<\" | \">\"\n}`;\nexport default tst;\n","/** Reads tst files to apply and perform test runs. */\n\nimport ohm from \"ohm-js\";\nimport { baseSemantics, grammars, makeParser, Span } from \"./base.js\";\n\nexport interface TstEchoOperation {\n  op: \"echo\";\n  message: string;\n}\n\nexport interface TstClearEchoOperation {\n  op: \"clear-echo\";\n}\n\nexport interface TstSetOperation {\n  op: \"set\";\n  id: string;\n  index?: number;\n  value: number;\n}\n\nexport interface TstEvalOperation {\n  op: \"eval\" | \"tick\" | \"tock\";\n}\n\nexport interface TstOutputOperation {\n  op: \"output\";\n}\n\nexport interface TstOutputSpec {\n  id: string;\n  builtin: boolean;\n  address: number;\n  style: \"D\" | \"X\" | \"B\" | \"S\";\n  width: number;\n  lpad: number;\n  rpad: number;\n}\n\nexport interface TstOutputListOperation {\n  op: \"output-list\";\n  spec: TstOutputSpec[];\n}\n\nexport interface TstLoadROMOperation {\n  op: \"loadRom\";\n  file: string;\n}\n\nexport interface TstFileOperation {\n  op: \"load\" | \"output-file\" | \"compare-to\";\n  file: string;\n}\n\nexport type TstOperation =\n  | TstFileOperation\n  | TstEvalOperation\n  | TstEchoOperation\n  | TstClearEchoOperation\n  | TstOutputOperation\n  | TstSetOperation\n  | TstOutputListOperation\n  | TstLoadROMOperation;\n\nexport interface TstLineStatement {\n  ops: TstOperation[];\n  break?: true;\n  span: Span;\n}\n\nexport interface TstRepeat {\n  statements: TstLineStatement[];\n  count: number;\n  span: Span;\n}\n\nexport interface TstWhileCondition {\n  op: \"<\" | \"<=\" | \"=\" | \">=\" | \">\" | \"<>\";\n  left: string | number;\n  right: string | number;\n}\n\nexport interface TstWhileStatement {\n  statements: TstLineStatement[];\n  condition: TstWhileCondition;\n  span: Span;\n}\n\nexport type TstStatement = TstLineStatement | TstRepeat | TstWhileStatement;\n\nexport interface Tst {\n  lines: TstStatement[];\n}\n\nimport tstGrammar from \"./grammars/tst.ohm.js\";\nexport const grammar = ohm.grammar(tstGrammar, grammars);\nexport const tstSemantics = grammar.extendSemantics(baseSemantics);\n\ntstSemantics.extendAttribute<number>(\"value\", {\n  Index(_a, idx, _b) {\n    return idx?.child(0)?.value ?? -1;\n  },\n});\n\ntstSemantics.extendAttribute<string>(\"name\", {\n  FileName({ name }) {\n    return name;\n  },\n});\n\ntstSemantics.addAttribute<number>(\"index\", {\n  Index(_open, dec, _close) {\n    return dec.child(0)?.value ?? 0;\n  },\n});\n\ntstSemantics.addAttribute<TstOutputSpec>(\"format\", {\n  OutputFormat(\n    { name: id },\n    index,\n    _a,\n    { sourceString: style },\n    { value: lpad },\n    _b,\n    { value: width },\n    _c,\n    { value: rpad }\n  ) {\n    return {\n      id,\n      builtin: index?.child(0) !== undefined,\n      address: index?.child(0)?.value ?? -1,\n      style: style as TstOutputSpec[\"style\"],\n      width,\n      lpad,\n      rpad,\n    };\n  },\n});\n\ntstSemantics.addAttribute<TstOperation>(\"operation\", {\n  TstEvalOperation(op) {\n    return { op: op.sourceString as TstEvalOperation[\"op\"] };\n  },\n  TstOutputOperation(_) {\n    return { op: \"output\" };\n  },\n  TstOutputListOperation(_, formats) {\n    return {\n      op: \"output-list\",\n      spec: formats.children.map((n) => n.format),\n    };\n  },\n  TstSetOperation(op, { name }, index, { value }) {\n    const setOp: TstSetOperation = {\n      op: \"set\",\n      id: name,\n      value,\n    };\n    const child = index.child(0)?.child(1)?.child(0);\n    if (child) {\n      setOp.index = child.value;\n    }\n    return setOp;\n  },\n  TstEchoOperation(op, str) {\n    return {\n      op: \"echo\",\n      message: str.String as string,\n    };\n  },\n  TstClearEchoOperation(op) {\n    return {\n      op: \"clear-echo\",\n    };\n  },\n  TstLoadROMOperation(_r, _l, { name }) {\n    return {\n      op: \"loadRom\",\n      file: name,\n    };\n  },\n  TstFileOperation(op, file) {\n    return {\n      op: op.sourceString as TstFileOperation[\"op\"],\n      file: file.sourceString,\n    };\n  },\n});\n\ntstSemantics.addAttribute<TstWhileCondition>(\"condition\", {\n  Condition({ value: left }, { sourceString: op }, { value: right }) {\n    return {\n      left,\n      right,\n      op: op as \"<\" | \"<=\" | \"=\" | \">=\" | \">\" | \"<>\",\n    };\n  },\n});\n\ntstSemantics.addAttribute<TstStatement>(\"statement\", {\n  TstWhile(op, cond, _o, statements, _c) {\n    return {\n      statements: statements.children.map(({ statement }) => statement),\n      condition: cond.condition,\n      span: {\n        start: op.source.startIdx,\n        end: cond.source.endIdx,\n      },\n    };\n  },\n  TstRepeat(op, count, _o, statements, _c) {\n    return {\n      statements: statements.children.map(({ statement }) => statement),\n      count: count.child(0)?.value ?? -1,\n      span: {\n        start: op.source.startIdx,\n        end: count.source.endIdx,\n      },\n    };\n  },\n  TstStatement(list, end) {\n    const stmt: TstStatement = {\n      ops: list\n        .asIteration()\n        .children.map((node) => node.operation as TstOperation),\n      span: {\n        start: this.source.startIdx,\n        end: this.source.endIdx,\n      },\n    };\n    if (end.sourceString === \"!\") {\n      stmt.break = true;\n    }\n    return stmt;\n  },\n});\n\ntstSemantics.addAttribute<Tst>(\"tst\", {\n  Tst(lines) {\n    return {\n      lines: lines.children.map((n) => n.statement),\n    };\n  },\n});\n\ntstSemantics.addAttribute<Tst>(\"root\", {\n  Root({ tst }) {\n    return tst;\n  },\n});\n\nexport const TST = {\n  grammar: tstGrammar,\n  semantics: tstSemantics,\n  parser: grammar,\n  parse: makeParser<Tst>(grammar, tstSemantics),\n};\n","import { assert } from \"@davidsouther/jiffies/lib/esm/assert.js\";\nimport { bin, dec, hex } from \"./util/twos.js\";\nimport { Test } from \"./tst.js\";\n\nexport class Output {\n  private readonly fmt: \"B\" | \"X\" | \"D\" | \"S\";\n  private readonly lPad: number;\n  private readonly rPad: number;\n  private readonly len: number;\n  private readonly index: number;\n  private readonly builtin: boolean;\n\n  // new Output(inst.id, inst.style, inst.width, inst.lpad, inst.rpad)\n  constructor(\n    private variable: string,\n    format = \"%B1.1.1\",\n    len?: number,\n    lPad?: number,\n    rPad?: number,\n    builtin?: boolean,\n    index?: number\n  ) {\n    if (\n      format.startsWith(\"%\") &&\n      len === undefined &&\n      lPad === undefined &&\n      rPad === undefined\n    ) {\n      const { fmt, lPad, rPad, len } = format.match(\n        /^%(?<fmt>[BDXS])(?<lPad>\\d+)\\.(?<len>\\d+)\\.(?<rPad>\\d+)$/\n      )?.groups as {\n        fmt: \"B\" | \"X\" | \"D\" | \"S\";\n        lPad: string;\n        rPad: string;\n        len: string;\n      };\n      this.fmt = fmt;\n      this.lPad = parseInt(lPad);\n      this.rPad = parseInt(rPad);\n      this.len = parseInt(len);\n      this.builtin = false;\n      this.index = -1;\n    } else {\n      assert([\"B\", \"X\", \"D\", \"S\"].includes(format[0]));\n      this.fmt = format[0] as \"B\" | \"X\" | \"D\" | \"S\";\n      this.len = len ?? 3;\n      this.lPad = lPad ?? 1;\n      this.rPad = rPad ?? 1;\n      this.builtin = builtin ?? false;\n      this.index = index ?? -1;\n    }\n  }\n\n  header(test: Test) {\n    let variable = `${this.variable}`;\n    if (this.builtin) {\n      const index = this.index >= 0 ? this.index : \"\";\n      variable = `${variable}[${index}]`;\n    }\n    if (variable.length > this.len + this.lPad + this.rPad) {\n      return variable.substring(0, this.len + this.lPad + this.rPad);\n    }\n    return this.padCenter(variable);\n  }\n\n  print(test: Test) {\n    const val = test.getVar(this.variable, this.index);\n    if (this.fmt === \"S\") {\n      return this.padLeft(val as string);\n    }\n\n    const fmt = { B: bin, D: dec, X: hex }[this.fmt];\n    const value = fmt(val as number);\n    if (this.fmt === \"D\") {\n      return this.padRight(value);\n    } else {\n      return this.padCenter(value.slice(value.length - this.len));\n    }\n  }\n\n  private padCenter(value: string) {\n    const space = this.lPad + this.len + this.rPad;\n    const leftSpace = Math.floor((space - value.length) / 2);\n    const rightSpace = space - leftSpace - value.length;\n    const padLeft = leftSpace + value.length;\n    const padRight = padLeft + rightSpace;\n    value = value.padStart(padLeft);\n    value = value.padEnd(padRight);\n    return value;\n  }\n\n  private padLeft(value: string) {\n    value = value.substring(0, this.len);\n    const padRight = this.rPad + this.len;\n    const padLeft = this.lPad + padRight;\n    value = value.padEnd(padRight);\n    value = value.padStart(padLeft);\n    return value;\n  }\n\n  private padRight(value: string) {\n    value = value.substring(0, this.len);\n    const padLeft = this.lPad + this.len;\n    const padRight = this.rPad + padLeft;\n    value = value.padStart(padLeft);\n    value = value.padEnd(padRight);\n    return value;\n  }\n}\n","import {\n  assertExists,\n  checkExhaustive,\n} from \"@davidsouther/jiffies/lib/esm/assert.js\";\nimport { FileSystem } from \"@davidsouther/jiffies/lib/esm/fs.js\";\nimport { Span } from \"./languages/base.js\";\nimport {\n  Tst,\n  TstLineStatement,\n  TstOperation,\n  TstOutputSpec,\n  TstStatement,\n  TstWhileStatement,\n} from \"./languages/tst.js\";\nimport { Bus, Chip, HIGH, Low, LOW } from \"./chip/chip.js\";\nimport { Clock } from \"./chip/clock.js\";\nimport { Output } from \"./output.js\";\n\nexport abstract class Test<IS extends TestInstruction = TestInstruction> {\n  protected readonly instructions: (IS | TestInstruction)[] = [];\n  protected _outputList: Output[] = [];\n  protected _log = \"\";\n  fs: FileSystem = new FileSystem();\n\n  setFileSystem(fs: FileSystem): this {\n    this.fs = fs;\n    return this;\n  }\n\n  echo(_content: string) {\n    return undefined;\n  }\n  clearEcho() {\n    return undefined;\n  }\n\n  async load(_filename: string): Promise<void> {\n    return undefined;\n  }\n  async compareTo(_filename: string): Promise<void> {\n    return undefined;\n  }\n  outputFile(_filename: string): void {\n    return undefined;\n  }\n  outputList(outputs: Output[]): void {\n    this._outputList = outputs;\n  }\n\n  addInstruction(instruction: IS | TestInstruction): void {\n    this.instructions.push(instruction);\n  }\n\n  reset(): this {\n    this._steps = (function* (test) {\n      for (const instruction of test.instructions) {\n        yield* instruction.steps(test);\n      }\n    })(this);\n    this._step = this._steps.next();\n    this._step; //?\n    this._log = \"\";\n    return this;\n  }\n\n  private _steps!: IterableIterator<IS | TestInstruction>;\n  private _step!: IteratorResult<IS | TestInstruction, IS | TestInstruction>;\n\n  get steps(): Iterator<IS | TestInstruction> {\n    if (this._steps === undefined) {\n      this.reset();\n      this._steps = assertExists(this._steps, \"Reset did not initialize steps\");\n      this._step = assertExists(this._step, \"Reset did not find first step\");\n    }\n    return this._steps;\n  }\n\n  get currentStep(): IS | TestInstruction | undefined {\n    return this._step?.value;\n  }\n\n  get done(): boolean {\n    return this._step?.done ?? false;\n  }\n\n  async step() {\n    if (!this._step.done) {\n      await this._step.value.do(this);\n      this._step = this.steps.next();\n      return false;\n    }\n    return true;\n  }\n\n  async run() {\n    this.reset();\n    while (!(await this.step()));\n  }\n\n  protected readonly breakpoints: Map<string, number> = new Map();\n  addBreakpoint(variable: string, value: number) {\n    this.breakpoints.set(variable, value);\n  }\n  clearBreakpoints() {\n    this.breakpoints.clear();\n  }\n\n  output() {\n    const values = this._outputList.map((output) => output.print(this));\n    this._log += `|${values.join(\"|\")}|\\n`;\n  }\n\n  header() {\n    const values = this._outputList.map((output) => output.header(this));\n    this._log += `|${values.join(\"|\")}|\\n`;\n  }\n\n  log() {\n    return this._log;\n  }\n\n  abstract hasVar(variable: string | number): boolean;\n  abstract getVar(variable: string | number, offset?: number): number | string;\n  abstract setVar(variable: string, value: number, offset?: number): void;\n}\n\nfunction isTstLineStatment(line: TstStatement): line is TstLineStatement {\n  return (line as TstLineStatement).ops !== undefined;\n}\n\nfunction isTstWhileStatement(line: TstStatement): line is TstWhileStatement {\n  return (line as TstWhileStatement).condition !== undefined;\n}\n\nexport class ChipTest extends Test<ChipTestInstruction> {\n  private chip: Chip = new Low();\n  get chipId(): number {\n    return this.chip.id;\n  }\n\n  private clock = Clock.get();\n\n  static from(tst: Tst): ChipTest {\n    const test = new ChipTest();\n\n    for (const line of tst.lines) {\n      if (isTstLineStatment(line)) {\n        test.addInstruction(ChipTest.makeLineStatement(line));\n      } else {\n        const repeat = isTstWhileStatement(line)\n          ? new TestWhileInstruction(\n              new Condition(\n                line.condition.left,\n                line.condition.right,\n                line.condition.op\n              )\n            )\n          : new TestRepeatInstruction(line.count);\n        repeat.span = line.span;\n        test.addInstruction(repeat);\n        for (const statement of line.statements) {\n          repeat.addInstruction(ChipTest.makeLineStatement(statement));\n        }\n      }\n    }\n\n    test.reset();\n\n    return test;\n  }\n\n  private static makeLineStatement(line: TstLineStatement) {\n    const statement = new TestCompoundInstruction();\n    statement.span = line.span;\n    for (const op of line.ops) {\n      const inst = ChipTest.makeInstruction(op);\n      if (inst !== undefined) statement.addInstruction(inst);\n    }\n    return statement;\n  }\n\n  private static makeInstruction(inst: TstOperation) {\n    const { op } = inst;\n    switch (op) {\n      case \"tick\":\n        return new TestTickInstruction();\n      case \"tock\":\n        return new TestTockInstruction();\n      case \"eval\":\n        return new TestEvalInstruction();\n      case \"output\":\n        return new TestOutputInstruction();\n      case \"set\":\n        return new TestSetInstruction(inst.id, inst.value, inst.index);\n      case \"output-list\":\n        return new TestOutputListInstruction(inst.spec);\n      case \"echo\":\n        return new TestEchoInstruction(inst.message);\n      case \"clear-echo\":\n        return new TestClearEchoInstruction();\n      case \"loadRom\":\n        return new TestLoadROMInstruction(inst.file);\n      case \"load\":\n      case \"output-file\":\n      case \"compare-to\":\n        return undefined;\n      default:\n        checkExhaustive(op, `Unknown tst operation ${op}`);\n    }\n  }\n\n  with(chip: Chip): this {\n    this.chip = chip;\n    return this;\n  }\n\n  hasVar(variable: string | number): boolean {\n    if (variable === \"time\") {\n      return true;\n    }\n    variable = `${variable}`;\n    // Look up built-in chip state variables\n    return this.chip.hasIn(variable) || this.chip.hasOut(variable);\n  }\n\n  getVar(variable: string | number, offset?: number): number | string {\n    variable = `${variable}`;\n    if (variable === \"time\") {\n      return this.clock.toString();\n    }\n    const pin = this.chip.get(variable, offset);\n    if (!pin) return 0;\n    return pin instanceof Bus ? pin.busVoltage : pin.voltage();\n  }\n\n  setVar(variable: string, value: number, offset?: number): void {\n    // Look up built-in chip state variables\n    const pinOrBus = this.chip.get(variable, offset);\n    if (pinOrBus instanceof Bus) {\n      pinOrBus.busVoltage = value;\n    } else {\n      pinOrBus?.pull(value === 0 ? LOW : HIGH);\n    }\n  }\n\n  eval(): void {\n    this.chip.eval();\n  }\n\n  tick(): void {\n    this.chip.eval();\n    this.clock.tick();\n  }\n\n  tock(): void {\n    this.chip.eval();\n    this.clock.tock();\n  }\n\n  override async load(filename: string) {\n    await this.chip.load(this.fs, filename);\n  }\n\n  override async run() {\n    this.clock.reset();\n    await super.run();\n  }\n}\n\nexport class CPUTest extends Test<CPUTestInstruction> {\n  hasVar(_variable: string | number): boolean {\n    return false;\n  }\n  getVar(_variable: string | number): number {\n    return 0;\n  }\n  setVar(_variable: string, _value: number): void {\n    return undefined;\n  }\n  ticktock(): void {\n    return undefined;\n  }\n}\n\nexport class VMTest extends Test<VMTestInstruction> {\n  hasVar(_variable: string | number): boolean {\n    return false;\n  }\n  getVar(_variable: string | number): number {\n    return 0;\n  }\n  setVar(_variable: string, _value: number): void {\n    return undefined;\n  }\n  vmstep(): void {\n    return undefined;\n  }\n}\n\nexport interface TestInstruction {\n  span?: Span;\n  do(test: Test): void;\n  steps(test: Test): IterableIterator<TestInstruction>;\n}\n\nexport class TestSetInstruction implements TestInstruction {\n  constructor(\n    private variable: string,\n    private value: number,\n    private index?: number | undefined\n  ) {}\n\n  do(test: Test) {\n    test.setVar(this.variable, this.value, this.index);\n  }\n\n  *steps() {\n    yield this;\n  }\n}\n\nexport class TestOutputInstruction implements TestInstruction {\n  do(test: Test) {\n    test.output();\n  }\n\n  *steps() {\n    yield this;\n  }\n}\n\nexport class TestOutputListInstruction implements TestInstruction {\n  private outputs: Output[] = [];\n\n  constructor(specs: TstOutputSpec[] = []) {\n    for (const spec of specs) {\n      this.addOutput(spec);\n    }\n  }\n\n  addOutput(inst: TstOutputSpec) {\n    this.outputs.push(\n      new Output(\n        inst.id,\n        inst.style,\n        inst.width,\n        inst.lpad,\n        inst.rpad,\n        inst.builtin,\n        inst.address\n      )\n    );\n  }\n\n  do(test: Test) {\n    test.outputList(this.outputs);\n    test.header();\n  }\n\n  *steps() {\n    yield this;\n  }\n}\n\nexport class TestCompoundInstruction implements TestInstruction {\n  protected readonly instructions: TestInstruction[] = [];\n  span?: Span;\n\n  addInstruction(instruction: TestInstruction) {\n    this.instructions.push(instruction);\n  }\n\n  do(test: Test<TestInstruction>): void {\n    for (const instruction of this.instructions) {\n      instruction.do(test);\n    }\n  }\n\n  *steps(_test: Test): Generator<TestInstruction> {\n    yield this;\n  }\n}\n\nexport class TestRepeatInstruction extends TestCompoundInstruction {\n  constructor(public readonly repeat: number) {\n    super();\n  }\n\n  override do() {\n    return undefined;\n  }\n\n  private *innerSteps(test: Test) {\n    for (const instruction of this.instructions) {\n      yield* instruction.steps(test);\n    }\n  }\n\n  override *steps(test: Test) {\n    if (this.repeat === -1) {\n      yield this;\n      while (true) {\n        yield* this.innerSteps(test);\n      }\n    } else {\n      for (let i = 0; i < this.repeat; i++) {\n        yield this;\n        yield* this.innerSteps(test);\n      }\n    }\n  }\n}\n\nexport class Condition {\n  constructor(\n    public readonly x: string | number,\n    public readonly y: string | number,\n    public readonly op: \"<\" | \"<=\" | \"=\" | \">=\" | \">\" | \"<>\"\n  ) {}\n\n  check(test: Test): boolean {\n    const x = test.hasVar(this.x) ? test.getVar(this.x) : this.x;\n    const y = test.hasVar(this.y) ? test.getVar(this.y) : this.y;\n\n    if (typeof x === \"string\" || typeof y === \"string\") {\n      switch (this.op) {\n        case \"=\":\n          return `${x}` === `${y}`;\n        case \"<>\":\n          return `${x}` !== `${y}`;\n      }\n    } else {\n      switch (this.op) {\n        case \"<\":\n          return x < y;\n        case \"<=\":\n          return x <= y;\n        case \">\":\n          return x > y;\n        case \">=\":\n          return x >= y;\n        case \"=\":\n          return x === y;\n        case \"<>\":\n          return x !== y;\n      }\n    }\n    return false;\n  }\n}\n\nexport class TestWhileInstruction extends TestCompoundInstruction {\n  constructor(public readonly condition: Condition) {\n    super();\n  }\n\n  override *steps(test: Test) {\n    while (this.condition.check(test)) {\n      yield this;\n      for (const instruction of this.instructions) {\n        yield* instruction.steps(test);\n      }\n    }\n  }\n}\n\nexport class TestEchoInstruction implements TestInstruction {\n  constructor(public readonly content: string) {}\n  do(test: Test) {\n    test.echo(this.content);\n  }\n\n  *steps() {\n    yield this;\n  }\n}\n\nexport class TestClearEchoInstruction implements TestInstruction {\n  do(test: Test) {\n    test.clearEcho();\n  }\n\n  *steps() {\n    yield this;\n  }\n}\n\nexport class TestLoadROMInstruction implements TestInstruction {\n  constructor(readonly file: string) {}\n  async do(test: Test) {\n    test.fs.pushd(\"/samples\");\n    await test.load(this.file);\n    test.fs.popd();\n  }\n\n  *steps() {\n    yield this;\n  }\n}\n\nexport class TestBreakpointInstruction implements TestInstruction {\n  constructor(readonly variable: string, readonly value: number) {}\n\n  do(test: Test) {\n    test.addBreakpoint(this.variable, this.value);\n  }\n\n  *steps() {\n    yield this;\n  }\n}\n\nexport class TestClearBreakpointsInstruction implements TestInstruction {\n  do(test: Test) {\n    test.clearBreakpoints();\n  }\n\n  *steps() {\n    yield this;\n  }\n}\n\nexport interface ChipTestInstruction extends TestInstruction {\n  _chipTestInstruction_: true;\n  do(test: ChipTest): void | Promise<void>;\n}\n\nexport class TestEvalInstruction implements ChipTestInstruction {\n  readonly _chipTestInstruction_ = true;\n  do(test: ChipTest) {\n    test.eval();\n  }\n\n  *steps() {\n    yield this;\n  }\n}\n\nexport class TestTickInstruction implements ChipTestInstruction {\n  readonly _chipTestInstruction_ = true;\n  do(test: ChipTest) {\n    test.tick();\n  }\n\n  *steps() {\n    yield this;\n  }\n}\n\nexport class TestTockInstruction implements ChipTestInstruction {\n  readonly _chipTestInstruction_ = true;\n  do(test: ChipTest) {\n    test.tock();\n  }\n\n  *steps() {\n    yield this;\n  }\n}\n\nexport interface CPUTestInstruction extends TestInstruction {\n  _cpuTestInstruction_: true;\n  do(test: CPUTest): void | Promise<void>;\n}\n\nexport class TestTickTockInstruction implements CPUTestInstruction {\n  readonly _cpuTestInstruction_ = true;\n  do(test: CPUTest) {\n    test.ticktock();\n  }\n\n  *steps() {\n    yield this;\n  }\n}\n\nexport interface VMTestInstruction extends TestInstruction {\n  _vmTestInstruction_: true;\n  do(test: VMTest): void | Promise<void>;\n}\n\nexport class TestVMStepInstruction implements VMTestInstruction {\n  readonly _vmTestInstruction_ = true;\n  do(test: VMTest) {\n    test.vmstep();\n  }\n\n  *steps() {\n    yield this;\n  }\n}\n","import {\n  ASSIGN,\n  ASSIGN_ASM,\n  ASSIGN_OP,\n  COMMANDS,\n  COMMANDS_ASM,\n  COMMANDS_OP,\n  JUMP,\n  JUMP_ASM,\n  JUMP_OP,\n} from \"../cpu/alu.js\";\n\nexport type CommandOps = keyof typeof COMMANDS.op;\nexport type JumpOps = keyof typeof JUMP.op;\nexport type StoreOps = keyof typeof ASSIGN.op;\n\nexport function asm(op: number): string {\n  if (op & 0x8000) {\n    return cInstruction(op);\n  }\n  return aInstruction(op);\n}\n\nfunction cInstruction(op: number): string {\n  op = op & 0xffff; // Clear high order bits\n  const mop = (op & 0x1000) >> 12;\n  const cop: CommandOps = ((op & 0b0000111111000000) >> 6) as CommandOps;\n  const sop: StoreOps = ((op & 0b0000000000111000) >> 3) as StoreOps;\n  const jop: JumpOps = (op & 0b0000000000000111) as JumpOps;\n\n  if (COMMANDS.op[cop] === undefined) {\n    // Invalid commend\n    return \"#ERR\";\n  }\n\n  let command = COMMANDS.op[cop];\n  if (mop) {\n    command = command.replace(/A/g, \"M\") as COMMANDS_ASM;\n  }\n\n  const store = ASSIGN.op[sop];\n  const jump = JUMP.op[jop];\n\n  let instruction: string = command;\n  if (store) {\n    instruction = `${store}=${instruction}`;\n  }\n  if (jump) {\n    instruction = `${instruction};${jump}`;\n  }\n\n  return instruction;\n}\n\nfunction aInstruction(op: number): string {\n  return \"@\" + (op & 0x7fff).toString(10);\n}\n\nexport function op(asm: string): number {\n  if (asm[0] === \"@\") {\n    return aop(asm);\n  } else {\n    return cop(asm);\n  }\n}\n\nfunction aop(asm: string): number {\n  return parseInt(asm.substring(1), 10);\n}\n\nfunction cop(asm: string): number {\n  const parts = asm.match(\n    /(?:(?<assign>[AMD]{1,3})=)?(?<operation>[-!01ADM&|]{1,3})(?:;(?<jump>JGT|JLT|JGE|JLE|JEQ|JMP))?/\n  );\n  const { assign, operation, jump } = parts?.groups ?? {};\n  const mode = operation.includes(\"M\") || assign.includes(\"M\");\n  const aop = ASSIGN.asm[(assign as ASSIGN_ASM) ?? \"\"];\n  const jop = JUMP.asm[(jump as JUMP_ASM) ?? \"\"];\n  const cop = COMMANDS.asm[(operation as COMMANDS_ASM) ?? \"\"];\n\n  return makeC(mode, cop, aop, jop);\n}\n\nexport function makeC(\n  isM: boolean,\n  op: COMMANDS_OP,\n  assign: ASSIGN_OP = 0,\n  jmp: JUMP_OP = 0\n): number {\n  const C = 0xe000;\n  const A = isM ? 0x1000 : 0;\n  const O = op << 6;\n  const D = (assign ?? 0) << 3;\n  const J = jmp ?? 0;\n  return C + A + O + D + J;\n}\n","const Hex = [\n  \"0\",\n  \"1\",\n  \"2\",\n  \"3\",\n  \"4\",\n  \"5\",\n  \"6\",\n  \"7\",\n  \"8\",\n  \"9\",\n  \"A\",\n  \"B\",\n  \"C\",\n  \"D\",\n  \"E\",\n  \"F\",\n];\n\nexport function chars(i: number): string {\n  return Hex[i] ?? \"X\";\n}\n\nexport function bits(i: number): string {\n  switch (i) {\n    case 0x0:\n      return \"0000\";\n    case 0x1:\n      return \"0001\";\n    case 0x2:\n      return \"0010\";\n    case 0x3:\n      return \"0011\";\n    case 0x4:\n      return \"0100\";\n    case 0x5:\n      return \"0101\";\n    case 0x6:\n      return \"0110\";\n    case 0x7:\n      return \"0111\";\n    case 0x8:\n      return \"1000\";\n    case 0x9:\n      return \"1001\";\n    case 0xa:\n      return \"1010\";\n    case 0xb:\n      return \"1011\";\n    case 0xc:\n      return \"1100\";\n    case 0xd:\n      return \"1101\";\n    case 0xe:\n      return \"1110\";\n    case 0xf:\n      return \"1111\";\n    default:\n      return \"erro\";\n  }\n}\n\nexport function int(n: string, radix: number): number {\n  const i = parseInt(n.replace(/[^\\d+-.xa-fA-F]/g, \"\"), radix);\n  return i & 0xffff;\n}\n\nexport function int16(i: string): number {\n  return int(i, 16);\n}\n\nexport function int10(i: string): number {\n  return int(i, 10);\n}\n\nexport function int2(i: string): number {\n  return int(i, 2);\n}\n\nexport function hex(i: number): string {\n  const hu = chars((i & 0xf000) >> 12);\n  const hl = chars((i & 0x0f00) >> 8);\n  const lu = chars((i & 0x00f0) >> 4);\n  const ll = chars(i & 0x000f);\n\n  return `0x${hu}${hl}${lu}${ll}`;\n}\n\nexport function bin(i: number, precision = 16): string {\n  const hu = bits((i & 0xf000) >> 12);\n  const hl = bits((i & 0x0f00) >> 8);\n  const lu = bits((i & 0x00f0) >> 4);\n  const ll = bits(i & 0x000f);\n\n  // return `${hu} ${hl} ${lu} ${ll}`;\n  return `${hu}${hl}${lu}${ll}`.substring(16 - precision); // Match the book's formatting\n}\n\nexport function dec(i: number): string {\n  i = i & 0xffff;\n  if (i === 0x8000) {\n    return \"-32768\";\n  }\n  if (i & 0x8000) {\n    i = (~i + 1) & 0x7fff;\n    return `-${i}`;\n  }\n  return `${i}`;\n}\n\nexport function uns(i: number): string {\n  i = i & 0xffff;\n  return `${i}`;\n}\n\nexport function nand16(a: number, b: number): number {\n  a = a & 0xffff;\n  b = b & 0xffff;\n  let c = ~(a & b);\n  c = c & 0xffff;\n  return c;\n}\n"],"names":["DiffTable","className","out","cmp","zeroState","output","CMP","compare","isErr","_jsxs","children","_jsx","display","Err","cmpData","Ok","outData","failures","table","range","Math","min","length","map","i","cmpI","outI","max","_","j","cell","pass","trim","match","style","fontFamily","marginBottom","row","DiffCell","pinWidth","start","end","undefined","Error","loadChip","name","fs","hasBuiltinChip","getBuiltinChip","readFile","file","maybeParsedHDL","HDL","chip","isOk","build","parts","toString","buildChip","Chip","ins","pin","width","outs","clocked","part","builtin","partChip","wires","lhs","rhs","to","from","wire","ROM32K","path","load","v","at","busVoltage","RAM","Screen","SCREEN","Keyboard","key","this","KEYBOARD","Memory","RAM16K","add","keyboard","screen","ram","in","voltage","address","inn","OFFSET","eval","startsWith","idx","int10","groups","offset","reset","ClockedChip","CPU","emptyState","_state","cpuTick","cpuInput","state","writeM","pull","HIGH","LOW","ALU","cpuTock","addressM","outM","PC","inM","instruction","ConstantBus","A","D","Computer","get","And","a","b","and","n","And16","and16","DMux","sel","dmux","DMux4Way","dmux4way","c","d","DMux8Way","dmux8way","e","f","g","h","mux16","mux16_4","s2","Mux","mux","set","Mux16","Mux4Way16","Mux8Way16","mux16_8","Nand","nand","Nand16","nand16","Not","Not16","or","Or","Or16","or16","Or8way","Xor","xor","Xor16","xor16","add16","Add16","ALUNoStat","x","y","op","alu","flags","ng","Flags","zr","halfAdder","HalfAdder","sum","carry","FullAdder","s","ca","fullAdder","Inc16","DFF","t","REGISTRY","Map","Bit","Register","RAM8","RAM64","RAM512","RAM4K","VRegister","ChipCtor","has","bit","bits","_memory","MemoryChip","pow","_address","_nextData","assert","size","RamBus","console","log","index","num","Bus","newWidth","next","push","forEach","reduce","nextVoltage","InSubBus","bus","connect","mask","high","low","mid","OutSubBus","value","TRUE_BUS","FALSE_BUS","parsePinDecl","toPin","w","Number","Symbol","iterator","Pins","minWidth","insert","values","id","internals","Set","internal","pins","clockedPins","Clock","$","subscribe","hasIn","hasOut","getBuiltin","BUILTIN_NAMES","includes","connections","isOutPin","wireOutPin","wireInPin","toLowerCase","emplace","partPin","assertExists","chipPin","findPin","isInternal","ensureWidth","remove","Low","level","tock","tick","unsubscribe","clock","BehaviorSubject","ticks","Subject","subject","frameSubject","resetSubject","COMMANDS_ALU","COMMANDS","asm","M","ASSIGN","MD","AM","AD","AMD","JUMP","JGT","JEQ","JGE","JLT","JNE","JLE","JMP","Positive","Zero","Negative","o","flag","BITS","decode","x1","x2","am","d1","d2","d3","j1","j2","j3","alu2","ROM","input","tickState","cpu","FORMATS","memory","Int16Array","fill","format","current","int2","int16","isFinite","updates","slice","fn","grammar","ohm","asmGrammar","grammars","asmSemantics","extendSemantics","baseSemantics","isALabelInstruction","inst","label","addAttribute","Root","instructions","child","AInstruction","_at","val","type","CInstruction","assignN","opN","jmpN","assign","sourceString","replace","jmp","isM","jump","store","Label","_o","_c","ASM","semantics","parser","parse","makeParser","passes","fillLabel","nextLabel","symbols","unfilled","line","emit","makeC","filter","endsWith","loadHack","loadAsm","source","unwrap","split","UNKNOWN_PARSE_ERROR","Base","createSemantics","property","root","succeeded","parsed","message","shortMessage","extendOperation","List","list","asIteration","decNumber","digits","wholeDec","binNumber","hexNumber","Name","ident","identifier","__","String","_a","str","_b","cmpGrammar","cmpSemantics","cells","lines","hdlGrammar","hdlSemantics","SubBus","startNode","endNode","WireSide","Wire","left","right","isTerminal","Wires","node","Part","Parts","BuiltinPart","PartList","ClockedList","PinDecl","PinList","body","Clocked","tstGrammar","tstSemantics","extendAttribute","Index","FileName","_open","dec","_close","OutputFormat","lpad","rpad","TstEvalOperation","TstOutputOperation","TstOutputListOperation","formats","spec","TstSetOperation","setOp","TstEchoOperation","TstClearEchoOperation","TstLoadROMOperation","_r","_l","TstFileOperation","Condition","TstWhile","cond","statements","statement","condition","span","startIdx","endIdx","TstRepeat","count","TstStatement","stmt","ops","operation","break","Tst","tst","TST","Output","variable","len","lPad","rPad","fmt","parseInt","test","substring","padCenter","getVar","padLeft","B","bin","X","hex","padRight","space","leftSpace","floor","rightSpace","padStart","padEnd","Test","FileSystem","_content","_filename","outputs","_outputList","_steps","steps","_step","_log","done","do","step","breakpoints","clear","print","join","header","isTstLineStatment","isTstWhileStatement","ChipTest","pinOrBus","filename","addInstruction","makeLineStatement","repeat","TestWhileInstruction","TestRepeatInstruction","TestCompoundInstruction","makeInstruction","TestTickInstruction","TestTockInstruction","TestEvalInstruction","TestOutputInstruction","TestSetInstruction","TestOutputListInstruction","TestEchoInstruction","TestClearEchoInstruction","TestLoadROMInstruction","checkExhaustive","setVar","specs","addOutput","outputList","_test","innerSteps","hasVar","check","content","echo","clearEcho","pushd","popd","mop","cop","sop","jop","command","cInstruction","aInstruction","aop","mode","C","O","J","Hex","chars","int","radix","hu","hl","lu","ll","precision","uns"],"sourceRoot":""}
"use strict";(self.webpackChunk_nand2tetris_web=self.webpackChunk_nand2tetris_web||[]).push([[519],{5519:(e,t,s)=>{s.r(t),s.d(t,{Asm:()=>C,default:()=>k});var n=s(1391),a=s(7022),r=s(910),i=s(782),l=s(135);const o=({values:e=[],highlight:t=-1,onClick:s})=>(0,i.jsx)("div",{children:e.map(((e,n)=>(0,i.jsx)(c,{identifier:e.name,value:e.value,highlight:n===t,onClick:()=>s?.(e.name,e.value)},n)))}),c=({identifier:e,value:t,highlight:s=!1,onClick:n})=>(0,i.jsxs)("div",{style:{display:"flex",alignItems:"center"},onClick:n,children:[e.length>0&&(0,i.jsx)("code",{style:{flex:"1",...(0,l.Wf)("none"),...s?{background:"var(--mark-background-color)"}:{},whiteSpace:"pre",padding:"3px"},children:e}),t.length>0&&(0,i.jsx)("code",{style:{flex:"1",textAlign:"right",padding:"3px",...(0,l.Wf)("none"),...s?{background:"var(--mark-background-color)"}:{}},children:t})]});var d=s(4666),u=s(9547),h=s(1091),p=s(8878),m=s(2675),g=s(5168),x=s(2144),f=s(7076),v=s(8330),j=s(6073),b=s(8029),y=s(3600),w=s(3499);const C=()=>{const{filePicker:e}=(0,p.useContext)(b.BR),{stores:t,setTool:s}=(0,p.useContext)(y.NQ),{state:l,actions:c,dispatch:C}=t.asm,{fs:k,localFsRoot:N}=(0,p.useContext)(r.L),R=(0,p.useRef)(0),L=(0,p.useRef)(0),T=(0,p.useRef)(),[_,F]=(0,p.useState)(!1),[S,E]=(0,p.useState)(!0);(0,p.useEffect)((()=>{s("asm")}),[s]),(0,p.useEffect)((()=>(T.current=new class extends h.M{async tick(){return R.current=0,L.current=0,await c.step()}reset(){c.reset()}toggle(){}},F(!0),()=>{var e;null===(e=T.current)||void 0===e||e.stop()})),[c,C]);const P=(0,p.useRef)(null),A=(0,p.useRef)(null),{setStatus:U}=(0,p.useContext)(r.L),H=(e,t)=>{const s=new Blob([e],{type:"text/plain"}),n=URL.createObjectURL(s);P.current&&(P.current.href=n,P.current.download=t,P.current.click(),URL.revokeObjectURL(n))};return(0,i.jsxs)("div",{className:"AsmPage grid "+(S?"":"hide-sym"),children:[(0,i.jsx)(g.Z,{className:"source",isEditorPanel:!0,header:(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("div",{children:(0,i.jsx)(n.x6,{id:"wdxz7K"})}),(0,i.jsx)("div",{className:"flex-1",children:_&&T.current&&(0,i.jsx)(a.T,{runner:T.current,disabled:void 0!=l.error,prefix:(0,i.jsx)("button",{className:"flex-0",onClick:async()=>{const t=await e.select({suffix:".asm"});U(x.F),requestAnimationFrame((async()=>{var e;await c.loadAsm(t.path),U(""),C.current({action:"setTitle",payload:null!==(e=t.path.split("/").pop())&&void 0!==e?e:""})}))},"data-tooltip":"Load file","data-placement":"bottom",children:"\ud83d\udcc2"}),overrideTooltips:{step:"Translate",run:"Translate all"},speed:l.config.speed,onSpeedChange:e=>{C.current({action:"updateConfig",payload:{speed:e}}),c.setAnimate(e<=2)}})}),!N&&(0,i.jsx)("fieldset",{role:"group",children:(0,i.jsx)("button",{"data-tooltip":"Download","data-placement":"left",onClick:()=>{var e,t;return H(l.asm,null!==(e=null===(t=l.path)||void 0===t?void 0:t.split("/").pop())&&void 0!==e?e:"source.asm")},children:"\u2b07\ufe0f"})})]}),children:(0,i.jsx)(m.K,{value:l.asm,error:l.error,alwaysRecenter:!1,onChange:e=>{c.setAsm(e)},onCursorPositionChange:e=>{e!=R.current&&(R.current=e,setTimeout((()=>{c.updateHighlight(e,!0)}),100))},grammar:d.y0.parser,language:"asm",highlight:l.translating?l.sourceHighlight:void 0,lineNumberTransform:e=>{if(!l.translating)return"";const t=l.lineNumbers[e];return(void 0===t?"":t).toString()}})}),(0,i.jsx)(g.Z,{className:"result",isEditorPanel:!0,header:(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("div",{children:(0,i.jsx)(n.x6,{id:"BUAJAb"})}),(0,i.jsxs)("div",{children:[(0,i.jsx)("a",{ref:P,style:{display:"none"}}),(0,i.jsx)(v.N_,{ref:A,style:{display:"none"},to:w.Ay.cpu.href}),(0,i.jsxs)("fieldset",{role:"group",children:[(0,i.jsx)("button",{"data-tooltip":"Load to the CPU Emulator","data-placement":"left",onClick:async()=>{var e;const s=await(0,u.aU)(l.result),n=new f.n9;var a;(await n.loadBytes(s),t.cpu.actions.replaceROM(n),l.path)&&(t.cpu.dispatch.current({action:"setTitle",payload:null!==(a=l.path.split("/").pop())&&void 0!==a?a:""}),t.cpu.actions.setPath(l.path),t.cpu.actions.reset());null===(e=A.current)||void 0===e||e.click()},children:"\u21a9\ufe0f"}),!N&&(0,i.jsx)("button",{"data-tooltip":"Download","data-placement":"left",onClick:()=>{var e,t,s;return H(l.result,null!==(e=null===(t=l.path)||void 0===t||null===(s=t.split("/").pop())||void 0===s?void 0:s.replace(".asm",".hack"))&&void 0!==e?e:"result.hack")},children:"\u2b07\ufe0f"})]})]})]}),children:(0,i.jsx)(m.K,{value:l.result,highlight:l.resultHighlight,disabled:!0,onChange:function(e){},onCursorPositionChange:e=>{e!=L.current&&(L.current=e,c.updateHighlight(e,!1))},grammar:void 0,language:"",alwaysRecenter:!1,lineNumberTransform:e=>(e-1).toString()})}),(0,i.jsx)(g.Z,{className:"sym",isEditorPanel:!0,header:(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("div",{className:"flex-1",children:(0,i.jsx)(n.x6,{id:"LWSJ0G"})}),(0,i.jsx)("input",{type:"checkbox",role:"switch",checked:S,onChange:()=>E(!S)})]}),children:l.translating&&S&&(0,i.jsx)(o,{values:l.symbols})}),(0,i.jsx)(g.Z,{className:"compare",header:(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)("div",{children:[(0,i.jsx)(n.x6,{id:"UV+b1H"}),l.compareName&&`: ${l.compareName}`]}),(0,i.jsx)("fieldset",{role:"group",children:(0,i.jsx)("button",{onClick:async()=>{const t=await e.selectAllowLocal({suffix:"hack"});if((0,j.uf)(t)){const e=await k.readFile(t.path);C.current({action:"setCmp",payload:{cmp:e,name:t.path.split("/").pop()}})}else{const e=Array.isArray(t)?t[0]:t;C.current({action:"setCmp",payload:{cmp:e.content,name:e.name}})}},children:"\ud83d\udcc2"})}),(0,i.jsx)("div",{className:"flex-1"}),(0,i.jsx)("fieldset",{role:"group",children:(0,i.jsx)("button",{onClick:()=>{c.compare()},children:"Compare"})})]}),children:(0,i.jsx)(m.K,{value:l.compare,highlight:l.translating?l.resultHighlight:void 0,highlightType:l.compareError?"error":"highlight",alwaysRecenter:!1,onChange:function(e){},disabled:!0,onCursorPositionChange:e=>{e!=L.current&&(L.current=e,c.updateHighlight(e,!1))},language:"",lineNumberTransform:e=>(e-1).toString()})})]})},k=C},2675:(e,t,s)=>{s.d(t,{K:()=>d});var n=s(1391),a=s(8878),r=s(8029),i=s(782);const l=(0,a.lazy)((()=>Promise.all([s.e(983),s.e(265),s.e(965)]).then(s.bind(s,8965)))),o=({error:e})=>e?(0,i.jsxs)("details",{className:"ErrorPanel",open:!0,children:[(0,i.jsx)("summary",{role:"button",className:"secondary",children:(0,i.jsx)(n.x6,{id:"1tSpqV"})}),(0,i.jsx)("pre",{children:(0,i.jsx)("code",{children:null===e||void 0===e?void 0:e.message})})]}):(0,i.jsx)(i.Fragment,{}),c=({value:e,onChange:t,language:s,disabled:n=!1})=>{const[r,l]=(0,a.useState)(e);return(0,i.jsx)("textarea",{"data-testid":`editor-${s}`,disabled:n,value:r,onChange:e=>{var s;const n=null===(s=e.target)||void 0===s?void 0:s.value;l(n),t(n)}})},d=({className:e="",style:t={},disabled:s=!1,value:n,error:d,onChange:u,onCursorPositionChange:h,grammar:p,language:m,highlight:g,highlightType:x="highlight",customDecorations:f=[],dynamicHeight:v=!1,alwaysRecenter:j=!0,lineNumberTransform:b})=>{const{monaco:y}=(0,a.useContext)(r.BR);return(0,i.jsx)("div",{className:`Editor ${v?"dynamic-height":""} ${e}`,style:t,children:y.canUse&&y.wants?(0,i.jsx)(a.Suspense,{fallback:"Loading...",children:(0,i.jsx)(l,{value:n,onChange:u,onCursorPositionChange:h,language:m,error:d,disabled:s,highlight:g,highlightType:x,customDecorations:f,dynamicHeight:v,alwaysRecenter:j,lineNumberTransform:b})}):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(c,{value:n,onChange:u,language:m,disabled:s}),(0,i.jsx)(o,{error:d})]})})}},5168:(e,t,s)=>{s.d(t,{p:()=>r,Z:()=>a});var n=s(782);const a=e=>{var t;return(0,n.jsxs)("article",{className:["panel",null!==(t=e.className)&&void 0!==t?t:"",e.isEditorPanel?"editor":""].join(" "),children:[e.header&&(0,n.jsx)("header",{children:e.header}),(0,n.jsx)("main",{children:e.children}),e.footer&&(0,n.jsx)("footer",{children:e.footer})]})},r=e=>{var t;return(0,n.jsxs)("details",{className:null!==(t=e.className)&&void 0!==t?t:"",open:e.open,style:e.style,children:[(0,n.jsx)("summary",{children:(0,n.jsx)("div",{className:"flex row align-baseline",children:e.summary})}),e.children]})}},2144:(e,t,s)=>{s.d(t,{F:()=>n});const n="Loading in progress..."},7022:(e,t,s)=>{s.d(t,{T:()=>i});var n=s(782),a=s(8878),r=s(9646);const i=e=>{const t=function(e){const t=(0,a.useRef)((()=>{})),{initialState:s,reducers:n,actions:i}=(0,a.useMemo)((()=>((e,t)=>{const s={running:e.running,speed:e.speed,steps:e.steps},n=e.finishFrame.bind(e);return e.finishFrame=function(){n(),t.current({action:"update"})},{initialState:s,reducers:{update(t){t.running=e.running,t.speed=e.speed,t.steps=e.steps},setSteps(t,s){t.steps=s,e.steps=s},setSpeed(t,s){t.speed=s,e.speed=s}},actions:{frame(){e.frame()},start(){e.start(),t.current({action:"update"})},stop(){e.stop(),t.current({action:"update"})},reset(){e.reset(),t.current({action:"update"})}}}})(e,t)),[e,t]),[l,o]=(0,r.A)(n,s);return t.current=o,{state:l,dispatch:t.current,actions:i}}(e.runner),[s,i]=(0,r.b)(e.speed??2),l={0:[1e3,1],1:[500,1],2:[16,1],3:[16,16666],4:[16,499980]};(0,a.useEffect)((()=>{o()}),[s]);const o=()=>{const[e,n]=l[s];t.dispatch({action:"setSpeed",payload:e}),t.dispatch({action:"setSteps",payload:n})},c=(0,a.useRef)(null),d=e=>{c.current?.blur()};return(0,a.useEffect)((()=>(window.addEventListener("keydown",d),window.addEventListener("keyup",d),()=>{window.removeEventListener("keydown",d),window.removeEventListener("keyup",d)}))),(0,n.jsxs)("div",{className:"flex row wrap",children:[(0,n.jsxs)("fieldset",{role:"group",children:[e.prefix,(0,n.jsx)("button",{className:"flex-0",disabled:e.disabled,onClick:()=>t.actions.frame(),"data-tooltip":e.overrideTooltips?.step??"Step","data-placement":"bottom",children:"\u27a1\ufe0f"}),(0,n.jsx)("button",{className:"flex-0",ref:c,disabled:e.disabled,onClick:()=>t.state.running?t.actions.stop():t.actions.start(),"data-tooltip":t.state.running?e.overrideTooltips?.pause??"Pause":e.overrideTooltips?.run??"Run","data-placement":"bottom",children:t.state.running?"\u23f8":"\ufe0f\u23e9"}),(0,n.jsx)("button",{className:"flex-0",onClick:()=>{t.state.running&&t.actions.stop(),t.actions.reset()},"data-tooltip":e.overrideTooltips?.reset??"Reset","data-placement":"bottom",children:"\u23ee"})]}),(0,n.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",fontSize:16,fontWeight:"normal"},children:[(0,n.jsx)("span",{style:{padding:"0.2rem"},children:"Slow"}),(0,n.jsx)("input",{type:"range",min:0,max:4,step:1,value:s,disabled:t.state.running,onChange:t=>{const s=Number(t.target.value);i(s),e.onSpeedChange?.(s)},style:{width:"150px",padding:"0.2rem"},"data-tooltip":"Execution speed","data-placement":"bottom"}),(0,n.jsx)("span",{style:{padding:"0.2rem"},children:"Fast"})]}),e.children]})}},135:(e,t,s)=>{s.d(t,{Wf:()=>r});var n=s(8281);function a(e){switch(e){case"t":return[...a("tl"),...a("tr")];case"r":return[...a("tr"),...a("br")];case"b":return[...a("br"),...a("bl")];case"l":return[...a("tl"),...a("bl")];default:return[n.Hw[e]]}}function r(e="",t=""){var s;s=e,void 0!==n.Hw[s]&&(t=e,e="");const r=function(e){return n.DN[e]}(e);return a(t).reduce(((e,t)=>(""===t?e.borderRadius=r:e[`border${t}Radius`]=r,e)),{})}},8281:(e,t,s)=>{s.d(t,{DN:()=>n,Hw:()=>a,UL:()=>r});const n={none:"0px",sm:"0.125rem","":"0.25rem",md:"0.375rem",lg:"0.5rem",xl:"0.75rem","2xl":"1rem","3xl":"1.5rem",full:"9999px"},a={"":"",t:"Top",r:"Right",l:"Left",b:"Bottom",tl:"TopLeft",tr:"TopRight",bl:"BottomLeft",br:"BottomRight"},r={"1/4":"25%","1/2":"50%","3/4":"75%",full:"100%"}},1091:(e,t,s)=>{s.d(t,{M:()=>a});const n=s(3096).z.get();class a{frame(){this.tick(),this.finishFrame()}finishFrame(){n.frame()}_steps=1;_steps_actual=1;get steps(){return this._steps}set steps(e){this._steps=e,this._steps_actual=e}_speed=60;get speed(){return this._speed}set speed(e){this._speed=e}get running(){return this.#e}#e=!1;#t=0;#s=0;#n=async()=>{if(!this.#e)return;const e=Date.now(),t=e-this.#s;if(this.#s=e,this.#t+=t,this.#t>this.speed){let e=!1,t=Math.min(this._steps,this._steps_actual);const s=performance.now();for(;!e&&t-- >0;)e=await this.tick();const n=performance.now()-s;this._steps_actual*=8/n,this._steps_actual=Math.ceil(this._steps_actual),this.finishFrame(),e&&this.stop(),this.#t-=this.speed}requestAnimationFrame(this.#n)};start(){this.#e=!0,this.#s=Date.now()-this.speed,this.#n(),this.toggle()}stop(){this.#e=!1,this.toggle()}}}}]);
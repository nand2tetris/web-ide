"use strict";(self.webpackChunk_nand2tetris_web=self.webpackChunk_nand2tetris_web||[]).push([[598],{6598:(e,l,a)=>{a.r(l),a.d(l,{Compiler:()=>g,default:()=>f});var t=a(1391),s=a(8256),n=a(4544),i=a(172),r=a(910),o=a(1916),c=a(8878),d=a(8330),u=a(2675),h=a(1384),x=a(8029),m=a(3600),v=a(5168),j=a(3499),p=a(782);const g=()=>{const{setStatus:e,canUpgradeFs:l}=(0,c.useContext)(r.L),{tracking:a}=(0,c.useContext)(x.BR),{stores:g,setTool:f}=(0,c.useContext)(m.NQ),{state:k,dispatch:C,actions:w}=g.compiler,[N,S]=(0,c.useState)(0),[E,F]=(0,c.useState)(!1),[R,_]=(0,c.useState)(!1),$=(0,c.useRef)(null);(0,c.useEffect)((()=>{f("compiler")}),[f]);(0,c.useEffect)((()=>{E||(()=>{const l=k.compiled[k.selected];var a,t;l&&e(l.valid?"":null!==(a=null===(t=l.error)||void 0===t?void 0:t.message)&&void 0!==a?a:"")})()}),[k.selected,k.files,E]);const P=(0,c.useCallback)((e=>{C.current({action:"setSelected",payload:e}),a.trackEvent("tab","change",e)}),[a]);(0,c.useEffect)((()=>{S(Object.keys(k.files).indexOf(k.selected))}),[k.selected]);const T=(0,c.useRef)(null),V=(0,i.s)(),z=(0,p.jsx)(y,{title:"Create New File",buttonText:"Create",dialog:V,isValid:e=>{var l;return null!==(l=(null===e||void 0===e?void 0:e.match(/^[a-zA-Z_][a-zA-Z0-9_]*$/))&&!Object.keys(k.files).includes(e))&&void 0!==l&&l},onExit:async e=>{e&&(await w.writeFile(e),P(e),F(!1))}});return(0,p.jsxs)("div",{className:"Page CompilerPage grid",children:[(0,p.jsx)("input",{type:"file",ref:T,webkitdirectory:"",onChange:async()=>{var e,l;if(!T.current||null===(e=T.current)||void 0===e||!e.files||0==(null===(l=T.current.files)||void 0===l?void 0:l.length))return;const a={};for(const t of T.current.files)t.name.endsWith(".jack")&&(a[t.name.replace(".jack","")]=await t.text());w.loadFiles(a)},style:{display:"none"}}),(0,p.jsx)(d.N_,{ref:$,to:j.Ay.vm.href,style:{display:"none"}}),z,(0,p.jsx)(v.Z,{className:"code",header:(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)("div",{children:(0,p.jsx)(t.x6,{id:"wdxz7K"})}),(0,p.jsxs)("div",{className:"flex row flex-1",children:[(0,p.jsx)("button",{"data-tooltip":s.Ru._({id:"FZeS2z"}),"data-placement":"right",className:"flex-0",onClick:async()=>{if(l){const l=await(0,o.EH)(),a=new n.Q2(new o.Ik(l));0==(await a.scandir("/")).filter((e=>e.isFile()&&e.name.endsWith(".jack"))).length?(e("No .jack files in the selected folder"),F(!0)):(e(""),w.loadProject(a,`${l.name} / *.jack`),_(!0))}else{var a;null===(a=T.current)||void 0===a||a.click(),_(!1)}},children:"\ud83d\udcc2"}),(0,p.jsx)(b,{}),(0,p.jsx)("button",{"data-tooltip":s.Ru._({id:"oXeVWH"}),"data-placement":"right",className:"flex-0",onClick:()=>{k.fs?V.open():e("No project folder loaded")},children:"+"}),(0,p.jsx)(b,{}),(0,p.jsx)("button",{className:"flex-0","data-tooltip":"Compile all the opened Jack files","data-placement":"bottom",onClick:()=>{k.isValid&&(w.compile(),e("Compiled successfully"))},disabled:!k.isValid,children:"Compile"}),(0,p.jsx)(b,{}),(0,p.jsx)("button",{className:"flex-0",disabled:!k.isCompiled,"data-tooltip":s.Ru._({id:"1/5eLk"}),"data-placement":"bottom",onClick:()=>{var e;k.title&&g.vm.dispatch.current({action:"setTitle",payload:k.title.replace(".jack",".vm")}),g.vm.actions.loadVm((()=>{const e=[];for(const a of Object.keys(k.files)){var l;let t=null!==(l=k.compiled[a].vm)&&void 0!==l?l:"";t=`// Compiled ${a}.jack:\n`.concat(t),e.push({name:a,content:t})}return e})()),null===(e=$.current)||void 0===e||e.click()},children:"Run"})]})]}),children:(0,p.jsx)(h.w,{tabIndex:{value:N,set:S},children:Object.keys(k.files).map((e=>(0,p.jsx)(h.o,{title:`${e}.jack`,onSelect:()=>P(e),style:{backgroundColor:k.compiled[e].valid?void 0:"var(--compiler-err-color)"},children:(0,p.jsx)(u.K,{value:k.files[e],onChange:l=>{w.writeFile(e,l)},error:k.compiled[e].error,language:"jack",disabled:!R})},e)))})})]})},f=g;function b(){return(0,p.jsx)("div",{style:{width:"0.25vw"}})}const y=({title:e,buttonText:l,dialog:a,isValid:s,onExit:n})=>{const[i,r]=(0,c.useState)();return(0,p.jsx)("dialog",{open:a.isOpen,children:(0,p.jsxs)("article",{children:[(0,p.jsxs)("header",{children:[(0,p.jsx)(t.x6,{id:"pDgeaz",values:{title:e}}),(0,p.jsx)("a",{className:"close",href:"#root",onClick:e=>{e.preventDefault(),n(),a.close()}})]}),(0,p.jsxs)("main",{children:[(0,p.jsxs)("div",{className:"flex row",children:[(0,p.jsx)("input",{value:i,onChange:e=>r(e.target.value)}),(0,p.jsx)("span",{children:".jack"})]}),(0,p.jsx)("button",{disabled:!s(null!==i&&void 0!==i?i:""),onClick:()=>{a.close(),r(""),n(i)},children:l})]})]})})}},2675:(e,l,a)=>{a.d(l,{K:()=>d});var t=a(1391),s=a(8878),n=a(8029),i=a(782);const r=(0,s.lazy)((()=>Promise.all([a.e(983),a.e(265),a.e(965)]).then(a.bind(a,8965)))),o=({error:e})=>e?(0,i.jsxs)("details",{className:"ErrorPanel",open:!0,children:[(0,i.jsx)("summary",{role:"button",className:"secondary",children:(0,i.jsx)(t.x6,{id:"1tSpqV"})}),(0,i.jsx)("pre",{children:(0,i.jsx)("code",{children:null===e||void 0===e?void 0:e.message})})]}):(0,i.jsx)(i.Fragment,{}),c=({value:e,onChange:l,language:a,disabled:t=!1})=>{const[n,r]=(0,s.useState)(e);return(0,i.jsx)("textarea",{"data-testid":`editor-${a}`,disabled:t,value:n,onChange:e=>{var a;const t=null===(a=e.target)||void 0===a?void 0:a.value;r(t),l(t)}})},d=({className:e="",style:l={},disabled:a=!1,value:t,error:d,onChange:u,onCursorPositionChange:h,grammar:x,language:m,highlight:v,highlightType:j="highlight",customDecorations:p=[],dynamicHeight:g=!1,alwaysRecenter:f=!0,lineNumberTransform:b})=>{const{monaco:y}=(0,s.useContext)(n.BR);return(0,i.jsx)("div",{className:`Editor ${g?"dynamic-height":""} ${e}`,style:l,children:y.canUse&&y.wants?(0,i.jsx)(s.Suspense,{fallback:"Loading...",children:(0,i.jsx)(r,{value:t,onChange:u,onCursorPositionChange:h,language:m,error:d,disabled:a,highlight:v,highlightType:j,customDecorations:p,dynamicHeight:g,alwaysRecenter:f,lineNumberTransform:b})}):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(c,{value:t,onChange:u,language:m,disabled:a}),(0,i.jsx)(o,{error:d})]})})}},5168:(e,l,a)=>{a.d(l,{p:()=>n,Z:()=>s});var t=a(782);const s=e=>{var l;return(0,t.jsxs)("article",{className:["panel",null!==(l=e.className)&&void 0!==l?l:"",e.isEditorPanel?"editor":""].join(" "),children:[e.header&&(0,t.jsx)("header",{children:e.header}),(0,t.jsx)("main",{children:e.children}),e.footer&&(0,t.jsx)("footer",{children:e.footer})]})},n=e=>{var l;return(0,t.jsxs)("details",{className:null!==(l=e.className)&&void 0!==l?l:"",open:e.open,style:e.style,children:[(0,t.jsx)("summary",{children:(0,t.jsx)("div",{className:"flex row align-baseline",children:e.summary})}),e.children]})}},1384:(e,l,a)=>{a.d(l,{o:()=>n,w:()=>i});var t=a(8878),s=a(782);const n=e=>{const l=(0,t.useId)(),a=`tab-${l}`,n=`panel-${l}`;return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{role:"tab",id:a,"aria-controls":n,style:e.style,children:(0,s.jsxs)("label",{children:[e.title,(0,s.jsx)("input",{type:"radio",name:e.parent,"aria-controls":n,value:a,checked:e.checked,onChange:l=>{var a;return 1==l.target.checked&&(null===(a=e.onSelect)||void 0===a?void 0:a.call(e))}})]})}),(0,s.jsx)("div",{role:"tabpanel",id:n,"aria-labelledby":a,children:e.children})]})},i=e=>{var l,a,n,i;const r=(0,t.useId)(),[o,c]=(0,t.useState)(0),d=null!==(l=null===(a=e.tabIndex)||void 0===a?void 0:a.value)&&void 0!==l?l:o,u=null!==(n=null===(i=e.tabIndex)||void 0===i?void 0:i.set)&&void 0!==n?n:c;return(0,s.jsx)("section",{role:"tablist",style:{"--tab-count":e.children.length},children:t.Children.map(e.children,((e,l)=>(0,t.cloneElement)(e,{checked:l===d,parent:r,idx:l,onSelect:()=>{var a,t;u(l),null===(a=e.props)||void 0===a||null===(t=a.onSelect)||void 0===t||t.call(a)}})))})}}}]);
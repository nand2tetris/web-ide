"use strict";(self.webpackChunk_nand2tetris_web=self.webpackChunk_nand2tetris_web||[]).push([[735],{5299:(t,e,s)=>{s.r(e),s.d(e,{CPU:()=>k,default:()=>w});var n=s(5072),r=s(4619),i=s(3478),c=s(3577),a=s(8963),u=s(7054),o=s(2201),d=s(4430),l=s(1003);const p=new Int16Array([2,55944,0,64528,15,54018,1,64528,2,61584,54024,0,64648,2,55943,15,55943]);var m=s(6845),h=s(4913),f=s(6604),x=s(5692);class S extends o.kG{dispatch;constructor(t,e){super(t,t.size,0),this.dispatch=e}async load(t,e){await super.load(t,e),this.dispatch.current({action:"update"})}}function g(t,e){const s=new S(t.cpu.RAM,e),n=new S(t.cpu.ROM,e),r=new S(t.cpu.Screen,e),i=new o.qT(new S(t.cpu.RAM,e));return{A:t.cpu.A,D:t.cpu.D,PC:t.cpu.PC,RAM:s,ROM:n,Screen:r,Keyboard:i}}function j(){const{fs:t,setStatus:e,storage:s}=(0,m.useContext)(x.r),n=(0,m.useRef)((()=>{})),{initialState:r,reducers:i,actions:c}=(0,m.useMemo)((()=>function(t,e,s,n){let r=new l.o(new o.eD(p)),i=!0;const c={update(t){t.sim=g(r,n),t.test.highlight=r.currentStep?.span},setTest(t,e){let{tst:s,cmp:n}=e;t.test.tst=s??t.test.tst,t.test.cmp=n??t.test.cmp,t.test.out=""},testStep(t){t.test.out=r.log(),this.update(t)},testFinished(t){if(""===t.test.cmp.trim())return;const s=(0,h.q)(t.test.cmp.trim(),r.log().trim());e(s?"Simulation successful: The output file is identical to the compare file":"Simulation error: The output file differs from the compare file")}},a={tick(){r.cpu.tick()},setAnimate(t){i=t},testStep(){const t=r.step();return(i||t)&&n.current({action:"testStep"}),t&&n.current({action:"testFinished"}),t},resetRAM(){r.cpu.RAM.loadBytes([]),n.current({action:"update"}),e("Reset RAM")},toggleUseTest(){n.current({action:"update"})},resetCPU(){r.reset(),n.current({action:"setTest",payload:{}}),n.current({action:"update"}),e("Reset CPU")},reset(){this.resetCPU(),e("Reset CPU & RAM")},compileTest(t,s){n.current({action:"setTest",payload:{tst:t,cmp:s}});const i=d.qH.parse(t);return(0,u.dZ)(i)?(e("Failed to parse test"),!1):(e("Parsed tst"),r=l.o.from((0,u.Ok)(i),r.cpu.ROM),n.current({action:"update"}),!0)},initialize(){this.compileTest("repeat {\n  ticktock;\n}")}};return{initialState:{sim:g(r,n),test:{highlight:r.currentStep?.span,tst:"",cmp:"",out:""}},reducers:c,actions:a}}(0,e,0,n)),[t,e,s,n]),[a,S]=(0,f.C)(i,r);return n.current=S,{state:a,dispatch:n,actions:c}}var y=s(6791),R=s(8722),C=s(8398),M=s(558),b=s(864);const k=()=>{const{state:t,actions:e,dispatch:s}=j(),{toolStates:u}=(0,m.useContext)(R.Il),[o,d]=(0,f.i)(t.test.tst),[l,p]=(0,f.i)(t.test.out),[h,x]=(0,f.i)(t.test.cmp),[S,g]=(0,m.useState)(),[k,w]=(0,m.useState)("asm"),[A,P]=(0,m.useState)(!0),[v,O]=(0,m.useState)(0);(0,m.useEffect)((()=>{e.initialize()}),[e]),(0,m.useEffect)((()=>{u.cpuState.rom&&(t.sim.ROM.loadBytes(u.cpuState.rom),u.cpuState.name&&(g(u.cpuState.name),u.cpuState.name.endsWith(".hack")&&w("bin")))}),[]),(0,m.useEffect)((()=>{u.setCpuState(S,Array.from(t.sim.ROM.map(((t,e)=>e))))}),[t]);const T=(0,m.useRef)(),D=(0,m.useRef)(),[E,F]=(0,m.useState)(!1);(0,m.useEffect)((()=>(T.current=new class extends r.B{async tick(){return e.tick(),!1}finishFrame(){s.current({action:"update"})}reset(){e.reset()}toggle(){s.current({action:"update"})}},D.current=new class extends r.B{async tick(){return e.testStep()}finishFrame(){s.current({action:"update"})}reset(){e.reset()}toggle(){s.current({action:"update"})}},F(!0),()=>{var t,e;null===(t=T.current)||void 0===t||t.stop(),null===(e=D.current)||void 0===e||e.stop()})),[e,s]);return(0,b.jsxs)("div",{className:"Page CpuPage grid",children:[(0,b.jsx)(c.ZP,{name:"ROM",displayEnabled:A,memory:t.sim.ROM,highlight:t.sim.PC,format:k,onUpload:t=>{g(t),e.reset()}}),(0,b.jsx)(c.ZP,{name:"RAM",displayEnabled:A,memory:t.sim.RAM,format:"hex",onChange:()=>{O(v+1)}}),(0,b.jsxs)(C.s,{className:"IO",header:(0,b.jsxs)(b.Fragment,{children:[S&&(0,b.jsx)("div",{className:"flex-0",children:S}),(0,b.jsx)("div",{className:"flex-1",children:E&&T.current&&(0,b.jsx)(y.D,{runner:T.current})})]}),children:[(0,b.jsx)(a.l,{memory:t.sim.Screen},v),(0,b.jsx)(i.N,{update:()=>{s.current({action:"update"})},keyboard:t.sim.Keyboard}),(0,b.jsxs)("label",{children:[(0,b.jsx)("input",{type:"checkbox",role:"switch",checked:A,onChange:()=>{P(!A)}}),(0,b.jsx)(n.cC,{id:"{0}",values:{0:A?"Disable display":"Enable display"}})]}),A&&(0,b.jsx)("div",{children:(0,b.jsxs)("dl",{children:[(0,b.jsx)("dt",{children:"PC"}),(0,b.jsx)("dd",{children:t.sim.PC}),(0,b.jsx)("dt",{children:"A"}),(0,b.jsx)("dd",{children:t.sim.A}),(0,b.jsx)("dt",{children:"D"}),(0,b.jsx)("dd",{children:t.sim.D})]})})]}),E&&(0,b.jsx)(M.F,{runner:D,tst:[o,d,t.test.highlight],out:[l,p],cmp:[h,x],onLoadTest:(t,s)=>{e.compileTest(t,s)},onSpeedChange:t=>{e.setAnimate(t<=2)}})]})},w=k},554:(t,e,s)=>{s.d(e,{j:()=>n});const n=t=>{if((t=>"function"===typeof t?.toString||"string"===typeof t)(t)){const e=t.toString();return"[object Object]"===e?JSON.stringify(t):e}return JSON.stringify(t)}},2936:(t,e,s)=>{s.d(e,{b:()=>r});var n=s(5251);function r(t,e){return void 0===t&&void 0!==n.BM[e]&&(t=e),{..."inline"===e?{display:"inline-block"}:{},width:n.BM[t]??"0"}}}}]);
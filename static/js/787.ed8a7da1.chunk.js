"use strict";(globalThis.webpackChunk_nand2tetris_web=globalThis.webpackChunk_nand2tetris_web||[]).push([[787],{7737:(e,t,s)=>{s.r(t),s.d(t,{Chip:()=>_,default:()=>M});var n=s(1391),i=s(8256),a=s(8878),r=s(782),l=s(7761),o=s(6980),c=s(2331),d=s(836),h=s(9651),u=s(8739),p=s(7721),x=s(3180);const m=({A:e,op:t,D:s,out:n,flag:i})=>(0,r.jsxs)("div",{className:"alu",children:[(0,r.jsx)("span",{children:"ALU"}),(0,r.jsxs)("svg",{width:"250",height:"250",version:"1.1",children:[(0,r.jsx)("defs",{children:(0,r.jsx)("rect",{x:"34.442518",y:"54.335354",width:"0.91770717",height:"20.780869"})}),(0,r.jsxs)("g",{children:[(0,r.jsx)("polygon",{points:"70,10 180,85 180,165 70,240 70,135 90,125 70,115",stroke:"#000",fill:"#6D97AB"}),(0,r.jsx)("text",{xmlSpace:"preserve",textAnchor:"middle",y:"61",x:"35",children:e}),(0,r.jsx)("text",{xmlSpace:"preserve",textAnchor:"middle",y:"176",x:"35",children:s}),(0,r.jsx)("text",{xmlSpace:"preserve",textAnchor:"middle",y:"121",x:"207",children:n}),(0,r.jsx)("text",{xmlSpace:"preserve",y:"130.50002",x:"110.393929",fill:"#ffffff",fontSize:24,children:u._0.op[t]??"(??)"}),(0,r.jsxs)("g",{children:[(0,r.jsx)("path",{d:"M 6,67.52217 H 68.675994"}),(0,r.jsx)("path",{d:"M 68.479388,67.746136 60.290279,61.90711"}),(0,r.jsx)("path",{d:"m 68.479388,67.40711 -8.189109,5.839026"})]}),(0,r.jsxs)("g",{transform:"translate(0,115.5)",children:[(0,r.jsx)("path",{d:"M 6,67.52217 H 68.675994"}),(0,r.jsx)("path",{d:"M 68.479388,67.746136 60.290279,61.90711"}),(0,r.jsx)("path",{d:"m 68.479388,67.40711 -8.189109,5.839026"})]}),(0,r.jsxs)("g",{transform:"translate(176,57.5)",children:[(0,r.jsx)("path",{d:"M 6,67.52217 H 68.675994"}),(0,r.jsx)("path",{d:"M 68.479388,67.746136 60.290279,61.90711"}),(0,r.jsx)("path",{d:"m 68.479388,67.40711 -8.189109,5.839026"})]})]})]})]});var j=s(7437),f=s(64),g=s(6537),v=s(4668);function b(e){return(0,r.jsx)(f.ce,{name:e.name,memory:e.memory,format:e instanceof l.N4?"asm":"dec",highlight:e.address,count:5})}function C(e,t,s){if(e instanceof o.Hs)return(0,r.jsx)(m,{A:e.in("x").busVoltage,op:e.op(),D:e.in("y").busVoltage,out:e.out().busVoltage,flag:e.out("zr").voltage()===h.RY?u.iI.Zero:e.out("ng").voltage()===h.RY?u.iI.Negative:u.iI.Positive});if(e instanceof c.UZ)return(0,r.jsx)(g.d,{name:e.name??`Chip ${e.id}`,bits:e.bits});if(e instanceof c.PC)return(0,r.jsx)(g.d,{name:"PC",bits:e.bits});if(e instanceof l.s3)return(0,r.jsx)(j.s,{keyboard:e,update:t});if(e instanceof l.ff)return(0,r.jsx)(v.f,{memory:e.memory});if(e instanceof d.XK)return b(e);if(e instanceof d.Z4)return(0,r.jsxs)("span",{children:["RAM ",e.width]});if(e instanceof l.Z8){const t=(0,p.D4)(e.in("instruction").busVoltage);return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(g.d,{name:"A",bits:e.state.A}),(0,r.jsx)(g.d,{name:"D",bits:e.state.D}),(0,r.jsx)(g.d,{name:"PC",bits:e.state.PC}),(0,r.jsx)(m,{A:t.am?e.in("inM").busVoltage:e.state.A,D:e.state.D,out:e.state.ALU,op:t.op,flag:e.state.flag})]})}if(e instanceof l.Sc)return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(g.d,{name:"A",bits:e.cpu.state.A}),(0,r.jsx)(g.d,{name:"D",bits:e.cpu.state.D}),(0,r.jsx)(g.d,{name:"PC",bits:e.cpu.state.PC}),!s?.has(x.XC)&&(0,r.jsx)(v.f,{memory:e.ram.screen.memory}),b(e.rom),b(e.ram.ram)]});const n=[...e.parts].map(e=>C(e,t)).filter(e=>void 0!==e);return n.length>0?(0,r.jsx)(r.Fragment,{children:n}):void 0}var y=s(6513),k=s(7490),w=s(9646),P=s(910),N=s(5005),A=s(1091),D=s(9267),F=s(8029),R=s(3344),S=s(2675),B=s(5168),E=s(3569);const _=()=>{const{setStatus:e,localFsRoot:t}=(0,a.useContext)(P.L),{stores:s,setTool:l}=(0,a.useContext)(R.NQ),{tracking:c,filePicker:d}=(0,a.useContext)(F.BR),{state:h,actions:u,dispatch:p}=s.chip,[x,m]=(0,w.b)(h.files.hdl),[j,f]=(0,w.b)(h.files.tst),[g,v]=(0,w.b)(h.files.cmp),[b,_]=(0,w.b)(h.files.out),[M,L]=(0,w.b)(h.dir),[H,$]=(0,a.useState)();(0,a.useEffect)(()=>{H&&L(null===H||void 0===H?void 0:H.split("/").slice(0,-1).join("/"))},[H]),(0,a.useEffect)(()=>{l("chip")},[l]),(0,a.useEffect)(()=>{c.trackPage("/chip")},[c]),(0,a.useEffect)(()=>{c.trackEvent("action","setProject",h.controls.project),c.trackEvent("action","setChip",h.controls.chipName)},[]);const O=(0,a.useCallback)(()=>{u.eval(),c.trackEvent("action","eval")},[u,c]),T=(0,a.useRef)(()=>{});T.current=async(e={})=>{var t,s,n,i;const a=h.controls.usingBuiltin?e.hdl:null!==(t=e.hdl)&&void 0!==t?t:x;await u.updateFiles({hdl:a,tst:null!==(s=e.tst)&&void 0!==s?s:j,cmp:null!==(n=e.cmp)&&void 0!==n?n:g,tstPath:null!==(i=e.tstDir)&&void 0!==i?i:M})},(0,a.useEffect)(()=>{T.current({tst:j,cmp:g,tstDir:M}),u.reset()},[j,g,M]);const Z=(0,a.useRef)();(0,a.useEffect)(()=>(Z.current=new class extends A.M{async reset(){await T.current(),await u.reset()}finishFrame(){super.finishFrame(),p.current({action:"updateTestStep"})}async tick(){return await u.stepTest()}toggle(){p.current({action:"updateTestStep"})}},()=>{var e;null===(e=Z.current)||void 0===e||e.stop()}),[T,u,p]);const I=(0,a.useMemo)(()=>({toggle(){u.clock(),c.trackEvent("action","toggleClock")},reset(){c.trackEvent("action","resetClock"),u.reset()}}),[u]),V=(0,a.useRef)(null),K=(0,r.jsx)(r.Fragment,{children:(0,r.jsxs)("fieldset",{role:"group","data-tooltip":"Open an HDL file using this menu","data-placement":"bottom",children:[(0,r.jsx)("select",{value:h.controls.project,onChange:({target:{value:e}})=>{u.setProject(e)},"data-testid":"project-picker",children:h.controls.projects.map(e=>(0,r.jsx)("option",{value:e,children:`Project ${e.replace(/^0/,"")}`},e))}),(0,r.jsxs)("select",{value:h.controls.chipName,onChange:({target:{value:e}})=>{if(""!=e){let s=`/${h.controls.project}/${e}.hdl`;t||(s=`/projects${s}`),u.loadChip(s)}},"data-testid":"chip-picker",children:[""==h.controls.chipName&&(0,r.jsx)("option",{}),h.controls.chips.map(e=>(0,r.jsx)("option",{value:e,children:e},e))]})]})}),U=(0,r.jsx)(B.Z,{className:"_hdl_panel",isEditorPanel:!0,header:(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{tabIndex:0,children:"HDL"}),(0,r.jsxs)("label",{style:{visibility:(0,o.KQ)(h.controls.chipName)?"visible":"hidden"},children:[(0,r.jsx)("input",{type:"checkbox",role:"switch",checked:h.controls.usingBuiltin,onChange:()=>{u.toggleBuiltin(),q.reset()}}),(0,r.jsx)(n.x6,{id:"++LBSt"})]}),(0,r.jsx)("div",{style:{width:"30px"}}),(0,r.jsx)("div",{className:"flex-4",children:K}),(0,r.jsxs)("fieldset",{role:"group",children:[(0,r.jsx)("button",{"data-tooltip":"Open an HDL file directly","data-placement":"bottom",onClick:async()=>{const e=await d.select({suffix:"hdl"});u.loadChip(e.path)},children:"\ud83d\udcc2"}),(0,r.jsx)("a",{ref:V,style:{display:"none"}}),(0,r.jsx)("button",{onClick:async()=>{if(!V.current)return;const e=await u.getProjectFiles(),t=await(0,E.y)(e);V.current.href=t,V.current.download=`${h.controls.project}`,V.current.click(),URL.revokeObjectURL(t)},"data-tooltip":i.Ru._({id:"Ovrln6"}),"data-placement":"left",children:"\u2b07\ufe0f"})]})]}),children:(0,r.jsx)(S.K,{className:"flex-1",value:x,error:h.controls.error,onChange:async e=>{m(e),h.controls.usingBuiltin||u.saveChip(e),T.current(h.controls.usingBuiltin?{}:{hdl:e})},grammar:N.xP.parser,language:"hdl",disabled:h.controls.usingBuiltin||""==h.controls.chipName})}),[J,z]=(0,a.useState)(!0),W=()=>{e(i.Ru._({id:"Ow/xRO"}))},X=()=>{h.sim.invalid?W():O()},Q=(0,r.jsxs)("fieldset",{role:"group",children:[(0,r.jsx)("button",{onClick:X,onKeyDown:X,disabled:!h.sim.pending||!J,children:(0,r.jsx)(n.x6,{id:"J3L683"})}),(0,r.jsx)("button",{onClick:()=>{h.sim.invalid?W():I.reset()},style:{maxWidth:"initial"},disabled:!h.sim.clocked,children:(0,r.jsx)(n.x6,{id:"OfhWJH"})}),(0,r.jsxs)("button",{onClick:()=>{h.sim.invalid?W():I.toggle()},style:{minWidth:"7em",textAlign:"start"},disabled:!h.sim.clocked,children:[(0,r.jsx)(n.x6,{id:"3rHyAJ"}),":","\xa0",(0,r.jsx)(y.wr,{})]})]}),Y=function(e,t,s){return[...e.parts].map((e,n)=>[`${e.id}_${n}`,C(e,t,s)]).filter(([e,t])=>void 0!==t)}({parts:h.sim.chip},()=>{p.current({action:"updateChip"})},h.controls.visualizationParameters),q=new k.wG,G=(0,r.jsx)(B.Z,{className:"_parts_panel",header:(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{children:[(0,r.jsx)(n.x6,{id:"C7rK3y"})," ",h.controls.chipName]}),Q]}),children:h.sim.invalid?(0,r.jsx)(n.x6,{id:"RFMyN+"}):""!=h.controls.chipName&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(k.ZB.Provider,{value:q,children:(0,r.jsx)(k.vl,{sim:h.sim,toggle:u.toggle,setInputValid:z,hideInternal:h.controls.usingBuiltin})}),Y.length>0&&(0,r.jsx)(B.p,{summary:(0,r.jsx)(n.x6,{id:"q3JCcX"}),open:!0,children:(0,r.jsx)("main",{children:Y.map(([e,t])=>t)})})]})}),ee=(0,r.jsx)(D.B,{runner:Z,disabled:h.sim.invalid,prefix:h.controls.tests.length>1?(0,r.jsx)("select",{value:h.controls.testName,onChange:({target:{value:e}})=>{u.loadTest(e)},"data-testid":"test-picker",children:h.controls.tests.map(e=>(0,r.jsx)("option",{value:e,children:e},e))}):(0,r.jsx)(r.Fragment,{}),tst:[j,f,h.controls.span],cmp:[g,v],out:[b,_],setPath:$,speed:h.config.speed,onSpeedChange:e=>{p.current({action:"updateConfig",payload:{speed:e}})}});return(0,r.jsx)(r.Fragment,{children:(0,r.jsxs)("div",{className:"Page ChipPage grid",children:[U,G,ee]})})},M=_}}]);
"use strict";(globalThis.webpackChunk_nand2tetris_web=globalThis.webpackChunk_nand2tetris_web||[]).push([[911],{3911:(e,t,n)=>{n.r(t),n.d(t,{Compiler:()=>U,default:()=>M});var r=n(6458),s=n(8256),a=n(4544),i=n(910),o=n(1916),c=n(5874),l=n(3977),u=n(9563);const m='Jack <: Base {\n    Root := Class\n\n    whitespace = (lineComment | comment | space)\n\n    class = "class" whitespace+\n    Class = class jackIdentifier OpenBrace ClassVarDec* SubroutineDec* CloseBrace\n\n    type = ("int" | "char" | "boolean" | jackIdentifier) whitespace+\n\n    classVarType = ("static" | "field") whitespace+\n    ClassVarDec = classVarType type jackIdentifier TrailingIdentifier* Semi\n    TrailingIdentifier = Comma jackIdentifier\n\n    void = "void" whitespace+\n    returnType = (type | void) \n    subroutineType = ("constructor" | "function" | "method") whitespace+\n    SubroutineDec = subroutineType returnType jackIdentifier OpenParen ParameterList CloseParen SubroutineBody\n\n\n    Parameter = type jackIdentifier\n    Parameters = Parameter TrailingParameter*\n    TrailingParameter = Comma Parameter\n    ParameterList = Parameters?\n\n    SubroutineBody = OpenBrace VarDec* Statement* CloseBrace\n\n    var = "var" whitespace+\n    VarDec = var type jackIdentifier TrailingIdentifier* Semi\n\n    Statement = LetStatement | IfStatement | WhileStatement | DoStatement | ReturnStatement\n\n    arrayAccessStart = jackIdentifier openSquare\n    ArrayAccess = arrayAccessStart Expression CloseSquare\n\n    let = "let" whitespace+\n    LetTarget = ArrayAccess | jackIdentifier\n    LetStatement = let LetTarget Equal Expression Semi\n\n    IfStatement = "if" OpenParen Expression CloseParen OpenBrace Statement* CloseBrace ElseBlock?\n    ElseBlock = "else" OpenBrace Statement* CloseBrace\n\n    WhileStatement = "while" OpenParen Expression CloseParen OpenBrace Statement* CloseBrace\n\n    do = "do" whitespace+\n    DoStatement = do SubroutineCall Semi\n\n    return = "return"\n    returnWithSpace = "return" whitespace+\n    ReturnStatement = EmptyReturn | ReturnValue\n    EmptyReturn = return Semi\n    ReturnValue = returnWithSpace Expression Semi\n\n    op = "+" | "-" | "*" | "/" | "&" | "|" | "<" | ">" | "="\n    ExpressionPart = op Term\n    Expression = Term ExpressionPart*\n\n    integerConstant = digit+\n    stringConstant = doubleQuote (~doubleQuote ~newline any)* doubleQuote\n    keywordConstant = "true" | "false" | "null" | "this"\n\n    GroupedExpression = OpenParen Expression CloseParen\n\n    unaryOp = "-" | "~"\n    UnaryExpression = unaryOp Term\n\n    Term = integerConstant | stringConstant | keywordConstant | SubroutineCall  | ArrayAccess | jackIdentifier | GroupedExpression | UnaryExpression\n\n    compoundIdentifier = jackIdentifier dot jackIdentifier\n    SubroutineName = compoundIdentifier | jackIdentifier\n    SubroutineCall = SubroutineName OpenParen ExpressionList CloseParen\n\n    ExpressionList = Expressions?\n    Expressions = Expression TrailingExpression*\n    TrailingExpression = Comma Expression\n\n    jackIdentifier = letter (alnum | underscore)*\n}',p=new Set(["int","boolean","char"]);const d=(0,u.qN)(m,l.lN),h=d.extendSemantics(l.JE);function f(e){return e.children.map((e=>e.statement))}h.addAttribute("Root",{Root(e){return this.class}}),h.addAttribute("class",{Class:(e,t,n,r,s,a)=>({name:{value:t.sourceString,span:(0,l.Ln)(t.source)},varDecs:r.children.map((e=>e.classVarDec)),subroutines:s.children.map((e=>e.subroutineDec))})}),h.addAttribute("classVarDec",{ClassVarDec:(e,t,n,r,s)=>({varType:e.sourceString.trim(),type:{value:t.sourceString.trim(),span:(0,l.Ln)(t.source)},names:[n.sourceString,...r.children.map((e=>e.child(1).sourceString))]})}),h.addAttribute("subroutineDec",{SubroutineDec:(e,t,n,r,s,a,i)=>({type:e.sourceString.trim(),returnType:{value:t.sourceString.trim(),span:(0,l.Ln)(t.source)},name:{value:n.sourceString,span:(0,l.Ln)(n.source)},parameters:s.parameterList,body:i.subroutineBody})}),h.addAttribute("parameter",{Parameter:(e,t)=>({type:{value:e.sourceString.trim(),span:(0,l.Ln)(e.source)},name:t.sourceString})}),h.addAttribute("parameterList",{ParameterList:e=>e.child(0)?.parameters??[]}),h.addAttribute("parameters",{Parameters:(e,t)=>[e.parameter,...t.children.map((e=>e.child(1).parameter))]}),h.addAttribute("subroutineBody",{SubroutineBody:(e,t,n,r)=>({varDecs:t.children.map((e=>e.varDec)),statements:f(n)})}),h.addAttribute("varDec",{VarDec:(e,t,n,r,s)=>({type:{value:t.sourceString.trim(),span:(0,l.Ln)(t.source)},names:[n.sourceString,...r.children.map((e=>e.child(1).sourceString))]})}),h.addAttribute("statement",{LetStatement(e,t,n,r,s){return"variable"==t.term.termType?{statementType:"letStatement",name:{value:t.term.name,span:t.term.span},value:r.expression,span:(0,l.Ln)(this.source)}:{statementType:"letStatement",name:t.term.name,arrayIndex:t.term.index,value:r.expression,span:(0,l.Ln)(this.source)}},IfStatement:(e,t,n,r,s,a,i,o)=>({statementType:"ifStatement",condition:n.expression,body:f(a),else:o.child(0)?.else??[]}),WhileStatement:(e,t,n,r,s,a,i)=>({statementType:"whileStatement",condition:n.expression,body:f(a)}),DoStatement:(e,t,n)=>({statementType:"doStatement",call:t.term}),EmptyReturn(e,t){return{statementType:"returnStatement",span:(0,l.Ln)(this.source)}},ReturnValue(e,t,n){return{statementType:"returnStatement",value:t.expression,span:(0,l.Ln)(this.source)}}}),h.addAttribute("else",{ElseBlock:(e,t,n,r)=>f(n)}),h.addAttribute("term",{integerConstant:e=>({termType:"numericLiteral",value:Number(e.sourceString)}),stringConstant(e,t,n){return{termType:"stringLiteral",value:this.sourceString.slice(1,-1)}},keywordConstant(e){return{termType:"keywordLiteral",value:this.sourceString}},SubroutineCall(e,t,n,r){return{termType:"subroutineCall",name:{value:e.sourceString,span:(0,l.Ln)(e.source)},parameters:n.expressionList,span:(0,l.Ln)(this.source)}},ArrayAccess(e,t,n){const r=e.child(0);return{termType:"arrayAccess",name:{value:r.sourceString,span:(0,l.Ln)(r.source)},index:t.expression,span:(0,l.Ln)(this.source)}},jackIdentifier(e,t){return{termType:"variable",name:`${e.sourceString}${t.sourceString}`,span:(0,l.Ln)(this.source)}},GroupedExpression:(e,t,n)=>({termType:"groupedExpression",expression:t.expression}),UnaryExpression:(e,t)=>({termType:"unaryExpression",op:e.sourceString,term:t.term})}),h.addAttribute("expressionList",{ExpressionList:e=>e.child(0)?.expressions??[]}),h.addAttribute("expressions",{Expressions:(e,t)=>[e.expression,...t.children.map((e=>e.child(1).expression))]}),h.addAttribute("expression",{Expression:(e,t)=>({nodeType:"expression",term:e.term,rest:t.children.map((e=>e.expressionPart))})}),h.addAttribute("expressionPart",{ExpressionPart:(e,t)=>({op:e.sourceString,term:t.term})});const y={parser:d,grammar:m,semantics:h,parse:(0,l.Q5)(d,h,(e=>e.class))};var g=n(2548);class S{id;hasReturn=!1;children=[];static count=0;constructor(){this.id=S.count,S.count+=1}alwaysReturns(){const e=new Set;return function t(n){if(n.hasReturn)return!0;if(0===n.children.length)return!1;e.add(n);for(const r of n.children)if(!e.has(r)&&!t(r))return!1;return!0}(this)}getLeafs(){const e=new Set,t=new Set;return function n(r){if(0===r.children.length)e.add(r);else{t.add(r);for(const e of r.children)t.has(e)||n(e)}}(this),Array.from(e)}}function b(e,t,n){const r=new S;n.children.push(r),n=r;const s=x(e.body,t),a=x(e.else,t);if((0,c.ys)(s))return s;if((0,c.ys)(a))return a;const i=(0,c.oA)(s),o=(0,c.oA)(a);n.children.push(i,o);const l=i.getLeafs().concat(o.getLeafs());n=new S;for(const c of l)c.children.push(n);return(0,c.Ok)(n)}function v(e,t,n){const r=new S;n.children.push(r),n=r;const s=x(e.body,t);if((0,c.ys)(s))return s;const a=(0,c.oA)(s);for(const o of a.getLeafs())o.children.push(n);const i=new S;return n.children.push(a,i),n=i,(0,c.Ok)(n)}function x(e,t){const n=new S;let r,s=n;for(const a of e)switch(a.statementType){case"letStatement":case"doStatement":break;case"returnStatement":if("void"!=t&&void 0==a.value)return(0,c._)((0,l.$5)("A non void subroutine must return a value",a.span));s.hasReturn=!0;break;case"ifStatement":if(r=b(a,t,s),(0,c.ys)(r))return r;s=(0,c.oA)(r);break;case"whileStatement":if(r=v(a,t,s),(0,c.ys)(r))return r;s=(0,c.oA)(r)}return(0,c.Ok)(n)}function A(e){const t=x(e.body.statements,e.returnType.value);return(0,c.ys)(t)?t:(0,c.oA)(t).alwaysReturns()?(0,c.Ok)():(0,c._)((0,l.$5)(`Subroutine ${e.name.value}: not all code paths return a value`,e.name.span))}const C=new Set(["Sys","Screen","Output","Keyboard","String","Array","Memory","Math"]);function E(e){return C.has(e)}function T(e){return void 0!=e.message}function w(e){return e.charAt(0).toUpperCase()+e.slice(1)}function L(e){const t=new Set;for(const n of e.subroutines){if(t.has(n.name.value))return(0,c._)((0,l.$5)(`Subroutine ${n.name.value} already declared`,n.name.span));t.add(n.name.value);const e=A(n);if((0,c.ys)(e))return e}return(0,c.Ok)()}const N={"+":"add","-":"sub","*":"call Math.multiply 2","/":"call Math.divide 2","&":"and","|":"or","<":"lt",">":"gt","=":"eq"},I={"-":"neg","~":"not"};class _{instructions=[];globalSymbolTable={};localSymbolTable={};className="";classes={};labelNum=0;fieldNum=0;staticNum=0;localNum=0;get output(){return Array.from(this.instructions)}varData(e){return this.localSymbolTable[e]||this.globalSymbolTable[e]}var(e){let t,n;"string"==typeof e?t=e:"string"==typeof e.name?(t=e.name,n=e.span):(t=e.name.value,n=e.name.span);const r=this.varData(t);if(!r)throw(0,l.$5)(`Undeclared variable ${t}`,n);return`${r.segment} ${r.index}`}write(...e){this.instructions.push(...e)}getLabel(){const e=`L${this.labelNum}`;return this.labelNum+=1,e}compile(e,t){this.className=e.name.value,this.classes=t??{};for(const n of e.varDecs)this.compileClassVarDec(n);for(const n of e.subroutines)this.compileSubroutineDec(n);return(0,c.Ok)(this.instructions.map((e=>e.startsWith("function")||e.startsWith("label")?e:"    ".concat(e))).join("\n"))}validateType(e,t){var n;if(n=e,!(p.has(n)||E(e)||this.classes[e]))throw(0,l.$5)(`Unknown type ${e}`,t)}validateReturnType(e,t){"void"!=e&&this.validateType(e,t)}compileClassVarDec(e){this.validateType(e.type.value,e.type.span);for(const t of e.names)"field"==e.varType?(this.globalSymbolTable[t]={type:e.type.value,segment:"this",index:this.fieldNum},this.fieldNum+=1):(this.globalSymbolTable[t]={type:e.type.value,segment:"static",index:this.staticNum},this.staticNum+=1)}compileVarDec(e){this.validateType(e.type.value,e.type.span);for(const t of e.names)this.localSymbolTable[t]={type:e.type.value,segment:"local",index:this.localNum},this.localNum+=1}registerArgs(e,t=!1){let n=0;for(const r of e)this.validateType(r.type.value,r.type.span),this.localSymbolTable[r.name]={type:r.type.value,segment:"argument",index:n+(t?1:0)},n+=1}compileSubroutineDec(e){switch(this.validateReturnType(e.returnType.value,e.returnType.span),e.type){case"method":this.compileMethod(e);break;case"constructor":this.compileConstructor(e);break;case"function":this.compileFunction(e)}}compileSubroutineStart(e,t=!1){this.localSymbolTable={},this.localNum=0,this.registerArgs(e.parameters,t);const n=e.body.varDecs.map((e=>e.names.length)).reduce(((e,t)=>e+t),0);this.write(`function ${this.className}.${e.name.value} ${n}`);for(const r of e.body.varDecs)this.compileVarDec(r)}compileFunction(e){this.compileSubroutineStart(e),this.compileStatements(e.body.statements)}compileMethod(e){this.compileSubroutineStart(e,!0),this.write("push argument 0","pop pointer 0"),this.compileStatements(e.body.statements)}compileConstructor(e){this.compileSubroutineStart(e),this.write(`push constant ${this.fieldNum}`,"call Memory.alloc 1","pop pointer 0"),this.compileStatements(e.body.statements)}compileExpression(e){this.compileTerm(e.term);for(const t of e.rest)this.compileTerm(t.term),this.compileOp(t.op)}compileOp(e){this.write(N[e])}compileTerm(e){switch(e.termType){case"numericLiteral":this.write(`push constant ${e.value}`);break;case"stringLiteral":this.compileStringLiteral(e.value);break;case"variable":this.write(`push ${this.var(e)}`);break;case"keywordLiteral":this.compileKeywordLiteral(e.value);break;case"subroutineCall":this.compileSubroutineCall(e);break;case"arrayAccess":this.compileExpression(e.index),this.write(`push ${this.var(e)}`,"add","pop pointer 1","push that 0");break;case"groupedExpression":this.compileExpression(e.expression);break;case"unaryExpression":this.compileTerm(e.term),this.write(I[e.op])}}validateArgNum(e,t,n){const r=n.parameters.length;if(t!=r)throw(0,l.$5)(`${e} expected ${t} arguments, got ${r}`,n.span)}validateSubroutineCall(e,t,n,r){const s=g.P[`${e}.${t}`];if(!s){if(E(e))throw(0,l.$5)(`Class ${e} doesn't contain a subroutine ${t}`,n.span);if(this.classes[e]){for(const s of this.classes[e].subroutines)if(s.name.value==t){if("method"==s.type&&!r)throw(0,l.$5)(`Method ${e}.${t} was called as a function/constructor`,n.name.span);if("method"!=s.type&&r)throw(0,l.$5)(`${w(s.name.value)} ${e}.${t} was called as a method`,n.name.span);return void this.validateArgNum(`${e}.${t}`,s.parameters.length,n)}throw(0,l.$5)(`Class ${e} doesn't contain a function/constructor ${t}`,n.name.span)}throw(0,l.$5)(`Class ${e} doesn't exist`,n.name.span)}if("method"==s.type&&!r)throw(0,l.$5)(`Method ${e}.${t} was called as a function/constructor`,n.name.span);if("method"!=s.type&&r)throw(0,l.$5)(`${w(s.type)} ${e}.${t} was called as a method`,n.name.span);this.validateArgNum(`${e}.${t}`,r?s.nArgs-1:s.nArgs,n)}classifySubroutineCall(e){let t,n="",r="";if(e.name.value.includes(".")){const[s,a]=e.name.value.split(".",2);r=a;const i=this.varData(s);i?(t=this.var(s),n=i.type):n=s}else t="pointer 0",n=this.className,r=e.name.value;return this.validateSubroutineCall(n,r,e,void 0!=t),{className:n,subroutineName:r,object:t}}compileSubroutineCall(e){const t=this.classifySubroutineCall(e);t.object&&this.write(`push ${t.object}`);for(const n of e.parameters)this.compileExpression(n);this.write(`call ${t.className}.${t.subroutineName} ${e.parameters.length+(t.object?1:0)}`)}compileStringLiteral(e){this.write(`push constant ${e.length}`,"call String.new 1");for(let t=0;t<e.length;t++)this.write(`push constant ${e.charCodeAt(t)}`,"call String.appendChar 2")}compileKeywordLiteral(e){switch(e){case"true":this.write("push constant 1");break;case"false":case"null":this.write("push constant 0");break;case"this":this.write("push pointer 0")}}compileStatements(e){for(const t of e)this.compileStatement(t)}compileStatement(e){switch(e.statementType){case"doStatement":this.compileDoStatement(e);break;case"ifStatement":this.compileIf(e);break;case"letStatement":this.compileLet(e);break;case"returnStatement":this.compileReturn(e);break;case"whileStatement":this.compileWhile(e)}}compileReturn(e){e.value?this.compileExpression(e.value):this.write("push constant 0"),this.write("return")}compileLet(e){e.arrayIndex?(this.compileExpression(e.arrayIndex),this.write(`push ${this.var(e)}`,"add"),this.compileExpression(e.value),this.write("pop temp 0","pop pointer 1","push temp 0","pop that 0")):(this.compileExpression(e.value),this.write(`pop ${this.var(e)}`))}compileDoStatement(e){this.compileSubroutineCall(e.call),this.write("pop temp 0")}compileIf(e){const t=this.getLabel(),n=this.getLabel();this.compileExpression(e.condition),this.write("not",`if-goto ${n}`),this.compileStatements(e.body),this.write(`goto ${t}`,`label ${n}`),this.compileStatements(e.else),this.write(`label ${t}`)}compileWhile(e){const t=this.getLabel(),n=this.getLabel();this.write(`label ${t}`),this.compileExpression(e.condition),this.write("not",`if-goto ${n}`),this.compileStatements(e.body),this.write(`goto ${t}`,`label ${n}`)}}var O=n(8878),j=n(8177);function k(e,t){let n;return{initialState:{files:{},compiled:{},selected:""},reducers:{setFs(e,t){e.fs=t},reset(e){e.files={}},setFile(e,{name:t,content:n}){e.files[t]=n,this.compile(e)},setFiles(e,t){e.files=t,this.compile(e)},compile(e){const t=function(e){const t={};for(const[a,i]of Object.entries(e)){const e=y.parse(i);if((0,c.ys)(e))t[a]=(0,c._)(e);else{const n=(0,c.Ok)(e),r=L(n);t[a]=n.name.value==a?(0,c.ys)(r)?(0,c._)(r):n:(0,l.$5)(`Class name ${n.name.value} doesn't match file name ${a}`,n.name.span)}}const n=Object.fromEntries(Object.entries(t).filter((([e,t])=>!T(t)))),r={};for(const[a,i]of Object.entries(t))if(T(i))r[a]=i;else try{const e=(new _).compile(i,n);(0,c.ys)(e)?r[a]=(0,c._)(e):r[a]=(0,c.Ok)(e)}catch(s){r[a]=s}return r}(e.files);e.compiled={};for(const[n,r]of Object.entries(t))e.compiled[n]="string"===typeof r?{valid:!0,vm:r}:{valid:!1,error:r}},writeCompiled(e){if(Object.values(e.compiled).every((e=>e.valid)))for(const[t,r]of Object.entries(e.compiled))r.vm&&n?.writeFile(`${t}.vm`,r.vm)},setSelected(e,t){e.selected=t}},actions:{async loadProject(e){this.reset(),n=e,t.current({action:"setFs",payload:n});const r={};for(const t of(await n.scandir("/")).filter((e=>e.isFile()&&e.name.endsWith(".jack"))))r[t.name.replace(".jack","")]=await n.readFile(t.name);this.loadFiles(r)},async loadFiles(e){t.current({action:"setFiles",payload:e}),Object.entries(e).length>0&&t.current({action:"setSelected",payload:Object.keys(e)[0]})},async writeFile(e,r){r??=function(e){return`class ${e} {\n\n}\n`}(e),t.current({action:"setFile",payload:{name:e,content:r}}),n&&await n.writeFile(`${e}.jack`,r)},async reset(){n=void 0,t.current({action:"reset"})},async compile(){t.current({action:"writeCompiled"})}}}}var $=n(8330),R=n(3508),D=n(2675),P=n(1384),F=n(3499),B=n(8029),G=n(4280),V=n(782);const U=()=>{const{setStatus:e}=(0,O.useContext)(i.L),{tracking:t,toolStates:n,setTitle:c}=(0,O.useContext)(B.BR),{state:l,dispatch:u,actions:m}=function(){const{setStatus:e}=(0,O.useContext)(i.L),t=(0,O.useRef)((()=>{})),{initialState:n,reducers:r,actions:s}=(0,O.useMemo)((()=>k(0,t)),[e,t]),[a,o]=(0,j.A)(r,n);return t.current=o,{state:a,dispatch:t,actions:s}}(),[p,d]=(0,O.useState)(0),h=(0,O.useRef)(null);(0,O.useEffect)((()=>{c(n.compiler.title)})),(0,O.useEffect)((()=>{n.compiler.fs&&m.loadProject(n.compiler.fs)}),[m,n.compiler.fs]);(0,O.useEffect)((()=>{(()=>{const t=l.compiled[l.selected];var n,r;t&&e(t.valid?"":null!==(n=null===(r=t.error)||void 0===r?void 0:r.message)&&void 0!==n?n:"")})()}),[l.selected,l.files]);const f=(0,O.useCallback)((e=>{u.current({action:"setSelected",payload:e}),t.trackEvent("tab","change",e)}),[t]);(0,O.useEffect)((()=>{d(Object.keys(l.files).indexOf(l.selected))}),[l.selected]);const y=()=>0==Object.keys(l.files).length||Object.keys(l.files).map((e=>l.compiled[e].valid)).reduce(((e,t)=>e&&t),!0),g=(0,R.s)(),S=(0,V.jsx)(q,{title:"Create New File",buttonText:"Create",dialog:g,isValid:e=>{var t;return null!==(t=(null===e||void 0===e?void 0:e.match(/^[a-zA-Z_][a-zA-Z0-9_]*$/))&&!Object.keys(l.files).includes(e))&&void 0!==t&&t},onExit:async e=>{e&&(await m.writeFile(e),f(e))}});return(0,V.jsxs)("div",{className:"Page CompilerPage grid",children:[(0,V.jsx)($.N_,{ref:h,to:F.Ay.vm.href,style:{display:"none"}}),S,(0,V.jsx)(G.Z,{className:"code",header:(0,V.jsxs)(V.Fragment,{children:[(0,V.jsx)("div",{children:(0,V.jsx)(r.x6,{id:"wdxz7K"})}),(0,V.jsxs)("div",{className:"flex row flex-1",children:[(0,V.jsx)("button",{"data-tooltip":s.Ru._({id:"FZeS2z"}),"data-placement":"right",className:"flex-0",onClick:async()=>{const t=await(0,o.EH)(),r=new a.Q2(new o.Ik(t));n.compiler.setFs(r),n.compiler.setCompiled(!1),n.compiler.setTitle(`${t.name} / *.jack`),e(""),m.loadProject(r)},children:"\ud83d\udcc2"}),(0,V.jsx)(X,{}),(0,V.jsx)("button",{"data-tooltip":s.Ru._({id:"oXeVWH"}),"data-placement":"right",className:"flex-0",onClick:()=>{l.fs?g.open():e("No project folder loaded")},children:"+"}),(0,V.jsx)(X,{}),(0,V.jsx)("button",{className:"flex-0","data-tooltip":"Compile all the opened Jack files","data-placement":"bottom",onClick:()=>{y()&&(m.compile(),n.compiler.setCompiled(!0),e("Compiled successfully"))},disabled:!y(),children:"Compile"}),(0,V.jsx)(X,{}),(0,V.jsx)("button",{className:"flex-0",disabled:!n.compiler.compiled,"data-tooltip":s.Ru._({id:"1/5eLk"}),"data-placement":"bottom",onClick:()=>{var e,t;n.vm.setTitle(null===(e=n.compiler.title)||void 0===e?void 0:e.replace("jack","vm")),n.vm.setFiles((()=>{const e=[];for(const n of Object.keys(l.files)){var t;let r=null!==(t=l.compiled[n].vm)&&void 0!==t?t:"";r=`// Compiled ${n}.jack:\n`.concat(r),e.push({name:n,content:r})}return e})()),null===(t=h.current)||void 0===t||t.click()},children:"Run"})]})]}),children:(0,V.jsx)(P.w,{tabIndex:{value:p,set:d},children:Object.keys(l.files).map((e=>(0,V.jsx)(P.o,{title:`${e}.jack`,onSelect:()=>f(e),style:{backgroundColor:l.compiled[e].valid?void 0:"#ffaaaa"},children:(0,V.jsx)(D.K,{value:l.files[e],onChange:t=>{n.compiler.setCompiled(!1),m.writeFile(e,t)},error:l.compiled[e].error,language:"jack"})},e)))})})]})},M=U;function X(){return(0,V.jsx)("div",{style:{width:"0.25vw"}})}const q=({title:e,buttonText:t,dialog:n,isValid:s,onExit:a})=>{const[i,o]=(0,O.useState)();return(0,V.jsx)("dialog",{open:n.isOpen,children:(0,V.jsxs)("article",{children:[(0,V.jsxs)("header",{children:[(0,V.jsx)(r.x6,{id:"pDgeaz",values:{title:e}}),(0,V.jsx)("a",{className:"close",href:"#root",onClick:e=>{e.preventDefault(),a(),n.close()}})]}),(0,V.jsxs)("main",{children:[(0,V.jsxs)("div",{className:"flex row",children:[(0,V.jsx)("input",{value:i,onChange:e=>o(e.target.value)}),(0,V.jsx)("span",{children:".jack"})]}),(0,V.jsx)("button",{disabled:!s(null!==i&&void 0!==i?i:""),onClick:()=>{n.close(),o(""),a(i)},children:t})]})]})})}},2675:(e,t,n)=>{n.d(t,{K:()=>u});var r=n(6458),s=n(8878),a=n(8029),i=n(782);let o=(...e)=>(0,i.jsx)(i.Fragment,{});const c=({error:e})=>e?(0,i.jsxs)("details",{className:"ErrorPanel",open:!0,children:[(0,i.jsx)("summary",{role:"button",className:"secondary",children:(0,i.jsx)(r.x6,{id:"1tSpqV"})}),(0,i.jsx)("pre",{children:(0,i.jsx)("code",{children:null===e||void 0===e?void 0:e.message})})]}):(0,i.jsx)(i.Fragment,{}),l=({value:e,onChange:t,language:n,disabled:r=!1})=>{const[a,o]=(0,s.useState)(e);return(0,i.jsx)("textarea",{"data-testid":`editor-${n}`,disabled:r,value:a,onChange:e=>{var n;const r=null===(n=e.target)||void 0===n?void 0:n.value;o(r),t(r)}})},u=({className:e="",style:t={},disabled:r=!1,value:u,error:m,onChange:p,onCursorPositionChange:d,grammar:h,language:f,highlight:y,highlightType:g="highlight",customDecorations:S=[],dynamicHeight:b=!1,alwaysRecenter:v=!0,lineNumberTransform:x})=>{const{monaco:A}=(0,s.useContext)(a.BR),[C,E]=(0,s.useState)(!1);return(0,s.useEffect)((()=>{(async()=>{A.canUse&&A.wants&&!C&&(o=(await Promise.all([n.e(983),n.e(535),n.e(965)]).then(n.bind(n,8965))).Monaco,E(!0))})()}),[A,C,E]),(0,i.jsx)("div",{className:`Editor ${b?"dynamic-height":""} ${e}`,style:t,children:A.canUse&&A.wants&&C?(0,i.jsx)(o,{value:u,onChange:p,onCursorPositionChange:d,language:f,error:m,disabled:r,highlight:y,highlightType:g,customDecorations:S,dynamicHeight:b,alwaysRecenter:v,lineNumberTransform:x}):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(l,{value:u,onChange:p,language:f,disabled:r}),(0,i.jsx)(c,{error:m})]})})}},4280:(e,t,n)=>{n.d(t,{Z:()=>s,p:()=>a});var r=n(782);const s=e=>{var t;return(0,r.jsxs)("article",{className:["panel",null!==(t=e.className)&&void 0!==t?t:""].join(" "),children:[e.header&&(0,r.jsx)("header",{children:e.header}),(0,r.jsx)("main",{children:e.children}),e.footer&&(0,r.jsx)("footer",{children:e.footer})]})},a=e=>{var t;return(0,r.jsxs)("details",{className:null!==(t=e.className)&&void 0!==t?t:"",open:e.open,style:e.style,children:[(0,r.jsx)("summary",{children:(0,r.jsx)("div",{className:"flex row align-baseline",children:e.summary})}),e.children]})}},1384:(e,t,n)=>{n.d(t,{o:()=>a,w:()=>i});var r=n(8878),s=n(782);const a=e=>{const t=(0,r.useId)(),n=`tab-${t}`,a=`panel-${t}`;return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{role:"tab",id:n,"aria-controls":a,style:e.style,children:(0,s.jsxs)("label",{children:[e.title,(0,s.jsx)("input",{type:"radio",name:e.parent,"aria-controls":a,value:n,checked:e.checked,onChange:t=>{var n;return 1==t.target.checked&&(null===(n=e.onSelect)||void 0===n?void 0:n.call(e))}})]})}),(0,s.jsx)("div",{role:"tabpanel",id:a,"aria-labelledby":n,children:e.children})]})},i=e=>{var t,n,a,i;const o=(0,r.useId)(),[c,l]=(0,r.useState)(0),u=null!==(t=null===(n=e.tabIndex)||void 0===n?void 0:n.value)&&void 0!==t?t:c,m=null!==(a=null===(i=e.tabIndex)||void 0===i?void 0:i.set)&&void 0!==a?a:l;return(0,s.jsx)("section",{role:"tablist",style:{"--tab-count":e.children.length},children:r.Children.map(e.children,((e,t)=>(0,r.cloneElement)(e,{checked:t===u,parent:o,idx:t,onSelect:()=>{var n,r;m(t),null===(n=e.props)||void 0===n||null===(r=n.onSelect)||void 0===r||r.call(n)}})))})}},8177:(e,t,n)=>{n.d(t,{A:()=>a,b:()=>i});var r=n(3263),s=n(8878);function a(e,t){return(0,s.useReducer)(((t,n)=>(0,r.jM)(t,(t=>{e[n.action](t,n.payload)}))),t)}function i(e){const[t,n]=(0,s.useState)(e);return(0,s.useEffect)((()=>{n(e)}),[e]),[t,n]}},3977:(e,t,n)=>{n.d(t,{JE:()=>o,$5:()=>l,lN:()=>i,Q5:()=>u,Ln:()=>m});var r=n(5874),s=n(9563),a=n(7844);const i={Base:(0,s.qN)('\nBase {\n  Root = Value*\n\n  At = at\n  Bang = bang\n  Bar = bar\n  CloseAngle = closeAngle\n  CloseBrace = closeBrace\n  CloseParen = closeParen\n  CloseSquare = closeSquare\n  Comma = comma\n  Dollar = dollar\n  Dot = dot\n  DoubleQuote = doubleQuote\n  Equal = equal\n  OpenAngle = openAngle\n  OpenBrace = openBrace\n  OpenParen = openParen\n  OpenSquare = openSquare\n  Percent = percent\n  Semi = semi\n  Underscore = underscore\n\n  at = "@"\n  bang = "!"\n  bar = "|"\n  closeAngle = ">"\n  closeBrace = "}"\n  closeParen = ")"\n  closeSquare = "]"\n  comma = ","\n  dollar = "$"\n  dot = "."\n  doubleQuote = "\\""\n  equal = "="\n  minus = "-"\n  newline = "\\r"? "\\n"\n  openAngle = "<"\n  openBrace = "{"\n  openParen = "("\n  openSquare = "["\n  percent = "%"\n  semi = ";"\n  underscore = "_"\n\n  Value = identifier | number | boolean\n\n  boolean = true | false\n  True = true\n  False = false\n  true = "true"\n  false = "false"\n\n  Name = identifier\n  identifier = (letter|underscore|dot|dollar) (alnum|underscore|dot|dollar)*\n\n  Number = number\n  number = hexNumber | decNumber | binNumber\n  binNumber = ("%B") ("0"|"1")+\n  hexNumber = ("%X") hexDigit+\n  decNumber = ("%D")? (wholeDec | realDec)\n  wholeDec = minus? digit+\n  realDec = minus? digit* "." digit+\n\n  String = DoubleQuote (~doubleQuote any)* doubleQuote\n  \n  spaces := (lineComment | comment | space)*\n  commentStart = "/*"\n  commentEnd = "*/"\n  comment = commentStart (~commentEnd any)* commentEnd\n  lineCommentStart = "//"\n  lineComment = lineCommentStart (~"\\n" any)*\n\n  List<elem, sep> = NonemptyListOf<elem, sep> sep?\n  EmptyList<elem, sep> = EmptyList<elem, sep> sep?\n}')},o=i.Base.createSemantics();o.extendOperation("asIteration",{List:(e,t)=>e.asIteration()}),o.addAttribute("value",{decNumber:(e,t)=>(0,a.ZR)(t.sourceString),wholeDec:(e,t)=>(0,a.ZR)(t.sourceString),binNumber:(e,t)=>(0,a.Yp)(t.sourceString),hexNumber:(e,t)=>(0,a.l8)(t.sourceString),Number:e=>e.value,Name:e=>e.name,identifier(e,t){return this.sourceString}}),o.addAttribute("name",{identifier(e,t){return this.sourceString},Name(e){return this.child(0)?.name}}),o.addAttribute("String",{String:(e,t,n)=>t.sourceString});const c="HDL statement has a syntax error";function l(e,t){const n=e.match(/Line \d+, col \d+: (?<message>.*)/),r=n?.groups?.message?n.groups.message:e;return{message:`${void 0!=t?.line?`Line ${t.line}: `:""}${r}`,span:t}}function u(e,t,n=(({root:e})=>e)){return function(s){try{const a=e.match(s);if(a.succeeded()){const e=t(a),s=n(e);return(0,r.Ok)(s)}return(0,r._)(l(a.shortMessage??c,m(a.getInterval())))}catch(a){return(0,r._)(a)}}}function m(e){return{start:e.startIdx,end:e.endIdx,line:e.getLineAndColumn().lineNum}}},7844:(e,t,n)=>{n.d(t,{FN:()=>d,Yp:()=>l,ZR:()=>c,_Q:()=>u,ad:()=>h,e5:()=>p,l8:()=>o,uh:()=>m,xu:()=>f});const r=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F"];function s(e){return r[e]??"X"}function a(e){switch(e){case 0:return"0000";case 1:return"0001";case 2:return"0010";case 3:return"0011";case 4:return"0100";case 5:return"0101";case 6:return"0110";case 7:return"0111";case 8:return"1000";case 9:return"1001";case 10:return"1010";case 11:return"1011";case 12:return"1100";case 13:return"1101";case 14:return"1110";case 15:return"1111";default:return"erro"}}function i(e,t){return 65535&parseInt(e.replace(/[^\d a-f A-F +-.]/g,""),t)}function o(e){return i(e,16)}function c(e){return i(e,10)}function l(e){return i(e.replaceAll(" ",""),2)}function u(e){return e.toUpperCase().includes("X")?o(e):c(e)}function m(e){return`0x${s((61440&e)>>12)}${s((3840&e)>>8)}${s((240&e)>>4)}${s(15&e)}`}function p(e,t=16){return`${a((61440&e)>>12)}${a((3840&e)>>8)}${a((240&e)>>4)}${a(15&e)}`.substring(16-t)}function d(e){return 32768===(e&=65535)?"-32768":32768&e?`-${e=1+~e&32767}`:`${e}`}function h(e){return`${e&=65535}`}function f(e,t){let n=~((e&=65535)&(t&=65535));return n&=65535,n}},2548:(e,t,n)=>{n.d(t,{P:()=>i});var r=n(270),s=n(8032);function a(e,t){const n=[];for(let r=0;r<t;r++)n.push(e.get(e.SP-t+r));return n}const i={"Math.multiply":{func:(e,t)=>{const[n,r]=a(e,2);return n*r&65535},nArgs:2,type:"function"},"Math.divide":{func:(e,t)=>{const[n,s]=a(e,2);return 0==s?(t.sys.error(r.X.DIVIDE_BY_ZERO),0):65535&Math.floor(n/s)},nArgs:2,type:"function"},"Math.min":{func:(e,t)=>{const[n,r]=a(e,2);return 65535&Math.min(n,r)},nArgs:2,type:"function"},"Math.max":{func:(e,t)=>{const[n,r]=a(e,2);return 65535&Math.max(n,r)},nArgs:2,type:"function"},"Math.sqrt":{func:(e,t)=>{const[n]=a(e,1);return n<0?(t.sys.error(r.X.SQRT_NEG),0):65535&Math.floor(Math.sqrt(n))},nArgs:1,type:"function"},"Math.abs":{func:(e,t)=>{const[n]=a(e,1);return 65535&Math.abs(n)},nArgs:1,type:"function"},"Screen.clearScreen":{func:(e,t)=>(t.screen.clear(),0),nArgs:0,type:"function"},"Screen.setColor":{func:(e,t)=>{const[n]=a(e,1);return t.screen.color=0!==n,0},nArgs:1,type:"function"},"Screen.drawPixel":{func:(e,t)=>{const[n,r]=a(e,2);return t.screen.drawPixel(n,r),0},nArgs:2,type:"function"},"Screen.drawLine":{func:(e,t)=>{const[n,r,s,i]=a(e,4);return t.screen.drawLine(n,r,s,i),0},nArgs:4,type:"function"},"Screen.drawRectangle":{func:(e,t)=>{const[n,r,s,i]=a(e,4);return t.screen.drawRect(n,r,s,i),0},nArgs:4,type:"function"},"Screen.drawCircle":{func:(e,t)=>{const[n,r,s]=a(e,3);return t.screen.drawCircle(n,r,s),0},nArgs:3,type:"function"},"Memory.peek":{func:(e,t)=>{const[n]=a(e,1);return e.get(n)},nArgs:1,type:"function"},"Memory.poke":{func:(e,t)=>{const[n,r]=a(e,2);return e.set(n,r),0},nArgs:2,type:"function"},"Memory.alloc":{func:(e,t)=>{const[n]=a(e,1);return t.memory.alloc(n)},nArgs:1,type:"function"},"Memory.deAlloc":{func:(e,t)=>{const[n]=a(e,1);return t.memory.deAlloc(n),0},nArgs:1,type:"function"},"Array.new":{func:(e,t)=>{const[n]=a(e,1);return n<=0?(t.sys.error(r.X.ARRAY_SIZE_NOT_POSITIVE),0):t.memory.alloc(n)},nArgs:1,type:"constructor"},"Array.dispose":{func:(e,t)=>{const[n]=a(e,1);return t.memory.deAlloc(n),0},nArgs:1,type:"method"},"String.new":{func:(e,t)=>{const[n]=a(e,1);return t.string.new(n)},nArgs:1,type:"constructor"},"String.dispose":{func:(e,t)=>{const[n]=a(e,1);return t.string.dispose(n),0},nArgs:1,type:"method"},"String.length":{func:(e,t)=>{const[n]=a(e,1);return t.string.length(n)},nArgs:1,type:"method"},"String.charAt":{func:(e,t)=>{const[n,r]=a(e,2);return t.string.charAt(n,r)},nArgs:2,type:"method"},"String.setCharAt":{func:(e,t)=>{const[n,r,s]=a(e,3);return t.string.setCharAt(n,r,s),0},nArgs:3,type:"method"},"String.appendChar":{func:(e,t)=>{const[n,r]=a(e,2);return t.string.appendChar(n,r)},nArgs:2,type:"method"},"String.eraseLastChar":{func:(e,t)=>{const[n]=a(e,1);return t.string.eraseLastChar(n),0},nArgs:1,type:"method"},"String.intValue":{func:(e,t)=>{const[n]=a(e,1);return t.string.intValue(n)},nArgs:1,type:"method"},"String.setInt":{func:(e,t)=>{const[n,r]=a(e,2);return t.string.setInt(n,r),0},nArgs:2,type:"method"},"String.backSpace":{func:(e,t)=>s.G_,nArgs:0,type:"function"},"String.doubleQuote":{func:(e,t)=>s.MD,nArgs:0,type:"function"},"String.newLine":{func:(e,t)=>s.qK,nArgs:0,type:"function"},"Output.moveCursor":{func:(e,t)=>{const[n,r]=a(e,2);return t.output.moveCursor(n,r),0},nArgs:2,type:"function"},"Output.printChar":{func:(e,t)=>{const[n]=a(e,1);return t.output.printChar(n),0},nArgs:1,type:"function"},"Output.printString":{func:(e,t)=>{const[n]=a(e,1);return t.output.printString(n),0},nArgs:1,type:"function"},"Output.printInt":{func:(e,t)=>{const[n]=a(e,1);return t.output.printInt(n),0},nArgs:1,type:"function"},"Output.println":{func:(e,t)=>(t.output.println(),0),nArgs:0,type:"function"},"Output.backSpace":{func:(e,t)=>(t.output.backspace(),0),nArgs:0,type:"function"},"Keyboard.keyPressed":{func:(e,t)=>t.keyboard.keyPressed(),nArgs:0,type:"function"},"Keyboard.readChar":{func:(e,t)=>(t.keyboard.readChar(),0),nArgs:0,type:"function"},"Keyboard.readLine":{func:(e,t)=>{const[n]=a(e,1);return t.keyboard.readLine(n),0},nArgs:1,type:"function"},"Keyboard.readInt":{func:(e,t)=>{const[n]=a(e,1);return t.keyboard.readInt(n),0},nArgs:1,type:"function"},"Sys.halt":{func:(e,t)=>(t.sys.halt(),0),nArgs:0,type:"function"},"Sys.error":{func:(e,t)=>{const[n]=a(e,1);return t.sys.error(n),0},nArgs:1,type:"function"},"Sys.wait":{func:(e,t)=>{const[n]=a(e,1);return t.sys.wait(n),0},nArgs:1,type:"function"}}},270:(e,t,n)=>{var r;function s(e){return Object.values(r).includes(e)}n.d(t,{U:()=>s,X:()=>r}),function(e){e[e.SYS_WAIT_DURATION_NOT_POSITIVE=1]="SYS_WAIT_DURATION_NOT_POSITIVE",e[e.ARRAY_SIZE_NOT_POSITIVE=2]="ARRAY_SIZE_NOT_POSITIVE",e[e.DIVIDE_BY_ZERO=3]="DIVIDE_BY_ZERO",e[e.SQRT_NEG=4]="SQRT_NEG",e[e.ALLOC_SIZE_NOT_POSITIVE=5]="ALLOC_SIZE_NOT_POSITIVE",e[e.HEAP_OVERFLOW=6]="HEAP_OVERFLOW",e[e.ILLEGAL_PIXEL_COORD=7]="ILLEGAL_PIXEL_COORD",e[e.ILLEGAL_LINE_COORD=8]="ILLEGAL_LINE_COORD",e[e.ILLEGAL_RECT_COORD=9]="ILLEGAL_RECT_COORD",e[e.ILLEGAL_CENTER_COORD=12]="ILLEGAL_CENTER_COORD",e[e.ILLEGAL_RADIUS=13]="ILLEGAL_RADIUS",e[e.STRING_LENGTH_NEG=14]="STRING_LENGTH_NEG",e[e.GET_CHAR_INDEX_OUT_OF_BOUNDS=15]="GET_CHAR_INDEX_OUT_OF_BOUNDS",e[e.SET_CHAR_INDEX_OUT_OF_BOUNDS=16]="SET_CHAR_INDEX_OUT_OF_BOUNDS",e[e.STRING_FULL=17]="STRING_FULL",e[e.STRING_EMPTY=18]="STRING_EMPTY",e[e.STRING_INSUFFICIENT_CAPACITY=19]="STRING_INSUFFICIENT_CAPACITY",e[e.ILLEGAL_CURSOR_LOCATION=20]="ILLEGAL_CURSOR_LOCATION"}(r||(r={}))},8032:(e,t,n)=>{n.d(t,{Fz:()=>l,G_:()=>a,MD:()=>i,eY:()=>c,qK:()=>s});var r=n(270);const s=128,a=129,i=34;function o(e){return e-48}function c(e){return e.toString().split("").map((e=>Number(e)+48))}class l{memory;os;constructor(e,t){this.memory=e,this.os=t}new(e){e<=0&&this.os.sys.error(r.X.STRING_LENGTH_NEG);const t=this.os.memory.alloc(e+2);return this.os.sys.halted?0:(this.memory.set(t,e),this.memory.set(t+1,0),t)}dispose(e){this.os.memory.deAlloc(e)}maxLength(e){return this.memory.get(e)}length(e){return this.memory.get(e+1)}setLength(e,t){this.memory.set(e+1,t)}charAt(e,t){return t<0||t>=this.length(e)?(this.os.sys.error(r.X.GET_CHAR_INDEX_OUT_OF_BOUNDS),0):this.memory.get(e+t+2)}setCharAt(e,t,n){t<0||t>=this.length(e)?this.os.sys.error(r.X.SET_CHAR_INDEX_OUT_OF_BOUNDS):this.memory.set(e+t+2,n)}appendChar(e,t){const n=this.length(e);return n==this.maxLength(e)?(this.os.sys.error(r.X.STRING_FULL),0):(this.setLength(e,n+1),this.setCharAt(e,n,t),e)}eraseLastChar(e){const t=this.length(e);0!=t?this.setLength(e,t-1):this.os.sys.error(r.X.STRING_EMPTY)}intValue(e){const t=[];for(let r=0;r<this.length(e)&&((n=this.charAt(e,r))>=48&&n<=57);r++)t.push(o(this.charAt(e,r)));var n;return t.reduce(((e,t)=>10*e+t),0)}setInt(e,t){const n=c(t);if(n.length>this.maxLength(e))this.os.sys.error(r.X.STRING_INSUFFICIENT_CAPACITY);else{this.setLength(e,0);for(const t of n)this.appendChar(e,t)}}}}}]);